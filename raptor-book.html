<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd" />
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es" >
<head>
  <title>Recursive Regexp Raptor</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="subtitle" content="La Guia Para Construir Un Motor Regexp" />
  <meta name="author" content="nasciiboy" />
  <meta name="licence" content="GNU FDL v1.3" />
  <meta name="date" content="2016" />
  <meta name="keywords" content="regex,regexp,c-prog,algorithm" />
  <link rel="stylesheet" type="text/css" href="worg-data/worg.css" />
</head>

<body>
<div id="toc">
  <p>index</p>
  <div id="toc-contents">
  <ul>
  <li><a class="h2" href="#Introduccion" >Introduccion</a></li>
    <ul>
    <li><a class="h3" href="#Sobre-el-libro...-y-otras-cosas" >Sobre el libro... y otras cosas</a></li>
      <ul>
      <li><a class="h4" href="#otras-cosas" >otras cosas</a></li>
      <li><a class="h4" href="#Como-leer-el-libro" >Como leer el libro</a></li>
      </ul>
    </ul>
  <li><a class="h2" href="#RegExp" >RegExp</a></li>
    <ul>
    <li><a class="h3" href="#Sintaxis-RegExp" >Sintaxis RegExp</a></li>
      <ul>
      <li><a class="h4" href="#Caracter" >Caracter</a></li>
      <li><a class="h4" href="#Conjunto" >Conjunto</a></li>
      <li><a class="h4" href="#Rangos" >Rangos</a></li>
      <li><a class="h4" href="#Conjunto-inverso" >Conjunto inverso</a></li>
      <li><a class="h4" href="#Punto" >Punto</a></li>
      <li><a class="h4" href="#Cuantificación" >Cuantificación</a></li>
      <li><a class="h4" href="#Alternación" >Alternación</a></li>
      <li><a class="h4" href="#Agrupación" >Agrupación</a></li>
      <li><a class="h4" href="#Metacaracteres" >Metacaracteres</a></li>
      <li><a class="h4" href="#Modiicadores" >Modiicadores</a></li>
      </ul>
    </ul>
  <li><a class="h2" href="#Regexp3-(ASCII)" >Regexp3 (ASCII)</a></li>
    <ul>
    <li><a class="h3" href="#Herramientas" >Herramientas</a></li>
    <li><a class="h3" href="#Mr.-Raptor" >Mr. Raptor</a></li>
    <li><a class="h3" href="#El-truco" >El truco</a></li>
    <li><a class="h3" href="#La-Sintaxis" >La Sintaxis</a></li>
    <li><a class="h3" href="#El-algoritmo" >El algoritmo</a></li>
      <ul>
      <li><a class="h4" href="#Como-interpretar-la-regexp" >Como interpretar la regexp</a></li>
      <li><a class="h4" href="#Pseudocodigo" >Pseudocodigo</a></li>
      <li><a class="h4" href="#Diagrama" >Diagrama</a></li>
      </ul>
    <li><a class="h3" href="#codigo" >codigo</a></li>
      <ul>
      <li><a class="h4" href="#interfaz" >interfaz</a></li>
      <li><a class="h4" href="#constructores" >constructores</a></li>
      <li><a class="h4" href="#PATH" ><code>PATH</code></a></li>
      <li><a class="h4" href="#SIMPLE-&amp;-GROUP" ><code>SIMPLE</code> &amp; <code>GROUP</code></a></li>
      <li><a class="h4" href="#HOOK" ><code>HOOK</code></a></li>
        <ul>
        <li><a class="h5" href="#Refactorizacion" >Refactorizacion</a></li>
        </ul>
      <li><a class="h4" href="#match" ><code>match</code></a></li>
      <li><a class="h4" href="#loops" >loops</a></li>
      <li><a class="h4" href="#SET-&amp;-META-&amp;-POINT" ><code>SET</code> &amp; <code>META</code> &amp; <code>POINT</code></a></li>
      <li><a class="h4" href="#mods" >mods</a></li>
      <li><a class="h4" href="#CATCH" ><code>CATCH</code></a></li>
      <li><a class="h4" href="#backreferences" >backreferences</a></li>
      <li><a class="h4" href="#Stand-Alone-Complex" >Stand Alone Complex</a></li>
      </ul>
    </ul>
  <li><a class="h2" href="#Regexp3-(UTF-8)" >Regexp3 (UTF-8)</a></li>
    <ul>
    <li><a class="h3" href="#utf-8" >utf-8</a></li>
    <li><a class="h3" href="#codigo" >codigo</a></li>
    <li><a class="h3" href="#xx.*yy" >xx.*yy</a></li>
    </ul>
  <li><a class="h2" href="#Regexp4" >Regexp4</a></li>
    <ul>
    <li><a class="h3" href="#El-raptor-necesita-un-mapa" >El raptor necesita un mapa</a></li>
    <li><a class="h3" href="#Lista-de-instrucciones" >Lista de instrucciones</a></li>
    <li><a class="h3" href="#showTable" >showTable</a></li>
    <li><a class="h3" href="#interprete" >interprete</a></li>
    <li><a class="h3" href="#goodbye-cruel-regexp" >goodbye cruel regexp</a></li>
    </ul>
  <li><a class="h2" href="#fuentes" >fuentes</a></li>
  </ul>
  </div>
</div>

<h1>Recursive Regexp Raptor</h1>
<div class="hBody-1" >
<blockquote>
<p>«La conciencia es el patron que se forma cuando apredemos a mirar hacia atras de nosotros mismos, incluso antes de nuestra propia existencia.»</p>
</blockquote>
</div>
<h2 id="Introduccion" >Introduccion</h2>
<div class="hBody-2" >
<p>Al igual que muchos de mis predecesores, quede fascinado por la utilidad de las expresiones regulares.</p>
<p>Probablemente no hayas encontrado informacion sobre como construir un motor de expresiones regulares (ni sobre su funcionamiento) o la disponible se enfoque solamente en fundamentos matematicos, para los cuales el autor no muestra un metodo para transladarlos al mundo real (<em>codigo</em>).</p>
<p>Has acudido al codigo de alguna implementacion en busca de conocimiento practico?  Y... encotraste codigo rebuscado y mistico repartido en infinidad de ficheros, llenos de macros, guiones bajos y variables cripticas.</p>
<p>Pues bien, este libro va de construir un motor de expresiones regulares paso a paso, con mucho codigo y poca teoria. Nada de cerraduras de Kleene, NFA o DFA. Principalmente por que el autor no tiene ni idea de matematicas y su conocimiento se limita a un par de libros de programacion en lenguaje C/C++... ¯\_(ツ)_/¯</p>
<p>El autor de este libro reconoce que este precedente no genera mucha expectativa, pero confia plenamente en la simplesa de su implementacion, fundamentada en cientos de horas frente a un par de monitores.</p>
<p>Para afrontar la construccion de este particular motor de expreciones regulares escrito en lenguaje C, se asume que tienes conocimientos intermedios de programacion, particularmente con algun lenguaje basado en C y que dispones de las siguientes herramientas:</p>
<ul>
<li>
<p>Un buen compilador de C (C99) (<em>GNU GCC</em> o <em>LLVM</em>).</p>
</li>
<li>
<p><em>GNU Emacs</em> o algun simple &#34;editor&#34; de texto.</p>
</li>
<li>
<p>Un terminal con un interprete de comandos (como bash) o un entrorno que te permita enviar ordenes al compilador, ejecutar programas y ver su salida.</p>
</li>
<li>
<p>Buena musica! Programar sin musica no vale la pena!</p>
</li>
</ul>
</div>
<h3 id="Sobre-el-libro...-y-otras-cosas" >Sobre el libro... y otras cosas</h3>
<div class="hBody-3" >
<p>El libro se divide en cuatro secciones:</p>
<ul>
<li>
<p><a href="#RegExp" >RegExp</a> expone una breve explicacion de lo que son las expresiones regulares y su sintaxis.</p>
</li>
<li>
<p><a href="#Regexp3-(ASCII)" >Regexp3 (ASCII)</a> muestra como imprementar un motor de expresiones regulares basado en el sistema de codificacion de caracteres <span class="acronym" >ASCII</span>.</p>
</li>
<li>
<p><a href="#Regexp3-(UTF-8)" >Regexp3 (UTF-8)</a> toma el codigo e ideas expuestas en <a href="#Regexp3-(ASCII)" >Regexp3 (ASCII)</a> agregando algunas utilidades basicas para manejar la codificacion de caracteres <span class="acronym" >UTF-8</span></p>
</li>
<li>
<p>Finalmente la seccion <a href="#Regexp4" >Regexp4</a> se centra en mejorar el desempeño del motor implementando una <q>tabla de instrucciones</q>, se modifican elementos de la sintaxis y se agregan nuevas caracteristicas.</p>
</li>
</ul>
</div>
<h4 id="otras-cosas" >otras cosas</h4>
<div class="hBody-4" >
<p>Este libro asi como todo el codigo que en el aparece esta cubierto por licencias con derechos de izquierda (Copyleft).</p>
<p>Para el libro se utiliza la licencia GNU FDL version 1.3.</p>
<p>Para el codigo se utiliza la licencia GNU GPL version 3.</p>
<p>El libro deberia estar acompañado por copias de ambas licencias, en caso contrario puede optener una copia desde <a href="https://www.gnu.org/licenses/fdl-1.3.html" >https://www.gnu.org/licenses/fdl-1.3.html</a> y <a href="https://www.gnu.org/licenses/gpl.html" >https://www.gnu.org/licenses/gpl.html</a></p>
<p>En esencia para el codigo fuente tienes:</p>
<ul>
<li>
<p>la libertad para utilizar el software para cualquier proposito,</p>
</li>
<li>
<p>la libertad para modificar el software para que se adapte a tus necesidades,</p>
</li>
<li>
<p>la libertad para compartir el software con tus amigos y vecinos, y</p>
</li>
<li>
<p>la libertad para compartir los cambios que tu hagas.</p>
</li>
</ul>
<p>Estas libertades se aplican tambien al libro. Puedes copiar y redistribuir el trabajo, con o sin modificaciones y de forma comercial o no comercial.</p>
<p>Todo aquel que obtenga una copia de este material tiene derecho a conservar las mismas condiciones de uso, es decir, tanto el original como las versiones modificadas tendran la misma licencia.</p>
<p>El codigo de este libro se encuentra alojado en <a href="https://github.com/nasciiboy/raptor-book" >https://github.com/nasciiboy/raptor-book</a>, bajo el sistema de control de versiones <code class="command" >git</code>.</p>
<p>Puedes clonar el repositorio con el comando:</p>
<pre class="code" ><code class="chroma" >git clone https://github.com/nasciiboy/raptor-book.git
</code></pre>
<p>Cualquier duda o contrubucion sera bien resivida en el correo electronico <a href="mailto:nasciiboy@gmail.com" >mailto:nasciiboy@gmail.com</a>.</p>
<p>El codigo fuente del manual esta escrito con un lenguaje de marcas ligeras aun en desorrollo llamado <a href="https://github.com/nasciiboy/morg/" >morg</a>. Adicionalmente se ofrece una version en formato html.</p>
</div>
<h4 id="Como-leer-el-libro" >Como leer el libro</h4>
<div class="hBody-4" >
<p><em>Si, en este libro no hay ningun acento</em> (y probablemente tenga una terrible ortografia y/o redaccion). El autor considera que la mejor forma de leer cualquier documento es en formato de texto plano (dentro de <em>Emacs</em>) pues permite entre otras cosas:</p>
<ul>
<li>
<p>Preservar el material atraves de los tiempos</p>
</li>
<li>
<p>Facilita la difucion. No cuenta con ningun ridiculo sistema de &#34;proteccion&#34;</p>
</li>
<li>
<p>Adaptarlo a diversos formatos con el minimo esfuerzo</p>
</li>
<li>
<p>Realizar busquedas eficientes. Punto donde los acentos son un inconveniente</p>
</li>
<li>
<p>La interaccion directa con la interfaz humano-maquina mas eficiente, el teclado</p>
</li>
</ul>
<p>Respecto al codigo, en cada seccion se agregan funcionalidades de forma incremental y cada seccion depende de la anterior. Por lo general se presenta todo el codigo necesario al inicio del tema, para luego examinar los puntos relevantes.</p>
<p>Dentro del codigo no se incluye ningun comentario que explique la finalidad de ninguna declaracion. Supuestamente cuando se escribe codigo con una estructura razonable, nombres descriptivos y que puede leerse de forma descendente, no es necesaria ninguna aclaracion. Obviamente, se presupone que el codigo aqui expuesto cumple estos requisitos...</p>
<p>Actualmente la libreria sigue en desarrollo en dos repositorios</p>
<p><a href="https://github.com/nasciiboy/RecursiveRegexpRaptor" >https://github.com/nasciiboy/RecursiveRegexpRaptor</a> alias Regexp3. El punto de partida de la libreria. Es interesante ver los cambios entre cada version en particular el codigo inicial.</p>
<p>Para optener una copia del repositorio</p>
<pre class="code" ><code class="chroma" >git clone https://github.com/nasciiboy/RecursiveRegexpRaptor.git
</code></pre>
<p><a href="https://github.com/nasciiboy/RecursiveRegexpRaptor-4" >https://github.com/nasciiboy/RecursiveRegexpRaptor-4</a> alias Regexp4. En su base contiene a Regexp3, con la diferencia de ser mas eficiente respecto al consumo de CPU.</p>
<p>Para optener una copia del repositorio</p>
<pre class="code" ><code class="chroma" >git clone https://github.com/nasciiboy/RecursiveRegexpRaptor-4.git
</code></pre>
<p>Al momento de escribir estas lineas, el codigo de este libro y el del repositorio difieren de forma evidente. En la practica, cada modificacion por minuscula que sea, obliga a revisar todo el codigo del libro, ajustar explicaciones y realizar nuevas pruebas. Ya que el motor cumple su mision perfectamente y el codigo es coherente con sigo mismo, la construccion de <em>regexp3</em> cubre hasta el commit <code>e6f7c7f5ee916fb25a4b6931e6fb4fb6b142188a</code>.</p>
<p>Como programadores, nuestro codigo refleja el nivel de conocimiento, experiencia, creencias, manias, dedicacion y otros tantos aspectos inherentes al aleatorio recorrido que transitamos. Aun no considero que el motor este concluido, pese a esto, es mi mayor orgullo como programador, espero que sea de utilidad y puedas aprender algun nuevo truco.</p>
<p>Al terminar este manual, tendras un motor regexp tan potente como para implementar un editor de flujos similar a <code class="command" >sed</code>, aun asi, date una vuelta por el repositorio para ver si he mejorado el codigo o despues de revisar por enesima ocacion alguna funcion he perdido el rumbo.</p>
<p>Si te consideras intrepido, pasa de esto y ve directamente al repo!</p>
<p><b>Happy Hacking!</b></p>
</div>
<h2 id="RegExp" >RegExp</h2>
<div class="hBody-2" >
<p>Una Expresion regular es una secuencia de caracteres que define un patron de busqueda. Son mejor conocidas por las contracciones <em>RegExp</em>, <em>RegEx</em> y <em>RE</em> del original <q>Regular Expressions</q> en ingles. La aplicacion principal de las <em>RegExp</em> es localizar patrones para filtrar informacion, validar datos y manipular texto.</p>
<p>Se originaron en 1956, cuando el matematico <em>Stephen Kleene</em> describio los <em>lenguajes regulares</em> utilizando su propia notacion matematica llamada <em>conjuntos regulares</em>.</p>
<p>En 1968, <em>Ken Thompson</em> pionero de Unix publico el articulo <q>Regular Expression Search Algorith</q> que contenia la descripcion tecnica de un compilador de expresiones regulares junto con codigo en Algol-60, mas tarde, implementaria por vez primera en un programa informatico el uso de expresiones regulares con la notacion de Kleene, especificamente en el editor de texto <code class="command" >QED</code>. El objetivo era que el usuario pudiese hacer comparacion de patrones avanzados en archivos de texto. En 1969 esta capacidad fue incorporada al editor <code class="command" >ed</code> (creacion de Thompson), en forma del comando <code>g/re/p</code> que proviene de «globally/regular expresion/print» y significa «<em>g</em>lobally search a <em>r</em>egular <em>e</em>xpression and <em>p</em>rint» (has una busqueda global para las lineas que coincidan con la expresion regular e imprimelas).</p>
<p>El comando <code>g/re/p</code> dio como resultado el programa independiente <code class="command" >grep</code> (tambien obra de Thompson), lanzado en la cuarta edicion de Unix en 1973. Sin embargo, grep no tenia una implementacion completa de expresiones regulares, no fue hasta el año 1979, en la septima edicion de Unix que el programa <code class="command" >egrep</code> (extended grep) (creacion de <em>Alfred Aho</em>) logro traducir cualquier expresion regular a su correspondiente algoritmo DFA.</p>
<p>Alrededor de la misma epoca en la que Thompson desarrollo <code class="command" >QED</code>, un grupo de investigadores, puso en marcha una herramienta basada en Expresiones Regulares, en esta ocacion su funcion fue el analisis lexico en el diseño de compiladores.</p>
<p>En la decada de los 70&#39;s muchas variaciones de las regexp implementadas en Unix se incorporaron a programas como <code class="command" >vi</code>, <code class="command" >lex</code>, <code class="command" >sed</code>, <code class="command" >awk</code>, <code class="command" >expr</code>, <code class="command" >emacs</code>, etc.</p>
<p>En la decada de los 80&#39;s, las expresiones regulares mas complejas aparecieron en el lenguaje de programacio <em>Perl</em>, derivadas de la biblioteca <em>regexp</em> de <em>Henry Spencer</em> (1986).</p>
<p>Inevitablemente la Jihad RegExp se extendio a la mayoria de lenguajes de programacion, shell&#39;s, bases de datos, servidores web, editores de texto, navegadores de ficheros y un variado numero de programas en forma de pequeñas utilidades.</p>
</div>
<h3 id="Sintaxis-RegExp" >Sintaxis RegExp</h3>
<div class="hBody-3" >
<p>Las RegExp estan formadas por una serie de constructores que pueden convinarse libremente entre si. Como no podria ser de otra forma, los constructores no son mas que una serie de caracteres (numeros, letras o signos de puntuacion) a los que se atribuye un comportaminto especifico.</p>
<p>La sintaxis de los constructores puede variar de un motor/programa/lenguaje a otro, sin embargo por lo general se siguen las siguientes convenciones:</p>
</div>
<h4 id="Caracter" >Caracter</h4>
<div class="hBody-4" >
<p>Se consideran caracteres todos los numeros, letras o signos de puntuacion cuyo unico significado es la coincidencia con el propio caracter.</p>
<p>Dentro del motor su evaluacion es secuencial. Es decir, un patron compuesto unicamente por caracteres solo puede coincidir si cada uno de sus elementos esta precente en el texto de busqueda, de forma secuencial. En terminos simples esto significa que cualquier palabra esta conformada por sus constructores <em>caracter</em>, por ejemplo:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;palabra&#34;</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;p&#39;</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;a&#39;</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;l&#39;</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;a&#39;</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;b&#39;</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;r&#39;</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;a&#39;</span>
</code></pre>
<p>De forma explicita, el patron de busqueda <code>palabra</code> dice al motor lo siguiente: Busca el constructor de tipo caracter <code>p</code>, si lo encuentras avanza una posicion dentro del texto de busqueda y comparalo con el constructor de tipo caracater <code>a</code>, si lo encuentras avanza una posicion dentro del texto de busqueda y compararlo con el constructor de tipo caracter <code>l</code>, ..., si llegas hasta el ultimo constructor tipo caracter (ultima <code>a</code>) el patron ha sido localizado, de otra forma no hay coincidencia.</p>
</div>
<h4 id="Conjunto" >Conjunto</h4>
<div class="hBody-4" >
<p>El constructor <em>Conjunto</em> permite agrupar una serie de constructores (por lo general de <q>tipo caracter</q>) para compararlos con una posicion especifica del texto de busqueda.</p>
<p>Los constructores se delimitan dentro de los signos <q>especiales</q> <code>[</code> y <code>]</code>.</p>
<p>La expresion:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;199[56789]&#34;</span>
</code></pre>
<p>le indica lo siguiente al motor: Busca el constructor de tipo caracter <code>1</code>, si lo encuentras avanza una posicion dentro del texto de busqueda y comparalo con el constructor que de tipo caracter <code>9</code>, si lo encuentras avanza una posicion dentro del texto de busqueda y compararlo con el constructor de tipo caracter <code>9</code>, si lo encuentras avanza una posicion dentro del texto de busqueda y comparalo con alguno de los constructores de tipo caracter <code>5</code>, <code>6</code>, <code>7</code>, <code>8</code> o <code>9</code>, Si el caracter del texto coincide con alguno de estos, se ha encontrado el patron, de otro modo la busqueda ha fallado.</p>
<p>Es decir el patron <code>199[56789]</code> coincide con las siguientes cadenas de caracteres: <q><code>1995</code></q>, <q><code>1996</code></q>, <q><code>1997</code></q>, <q><code>1998</code></q> o <q><code>1999</code></q></p>
</div>
<h4 id="Rangos" >Rangos</h4>
<div class="hBody-4" >
<p>Un conjunto agrupa una serie de constructores caracter, pues bien, cuando los miembros de dicho conjunto forman una secuencia alfabetica entre <code>a</code> y <code>z</code>, entre <code>A</code> y <code>Z</code>) o entre <code>0</code> y <code>9</code>, es posible abreviar dicha secuencia, uniendo el elemento inicial con el elemento final de la secuencia mediante el signo &#39;-&#39;, por ejemplo la exprecion</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;199[56789]&#34;</span>
</code></pre>
<p>es equivalente a la exprecion:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;199[5-9]&#34;</span>
</code></pre>
<p>la exprecion</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;Unidad-[ABCDEFGHIJK]&#34;</span>
</code></pre>
<p>es equivalente a</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;Unidad-[A-K]&#34;</span>
</code></pre>
<p>el signo <code>-</code> no tiene efecto fuera del constructor agrupacion, por lo que se interpreta como un simple caracter <code>-</code></p>
</div>
<h4 id="Conjunto-inverso" >Conjunto inverso</h4>
<div class="hBody-4" >
<p>La utlima facilidad que proporciona el constructor conjunto consiste en coincidir solo si ninguno de sus elementos esta precente en el texto de busqueda, es decir, <em>invierte</em> el resultado de la busqueda. La forma de indicar al motor este comportamiento es colocar el signo <code>^</code> como primer elemento del constructor conjunto. Por ejemplo la expresion</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;&lt;[^&gt;]&gt;&#34;</span>
</code></pre>
<p>Es util para localizar <em>etiquetas</em> de un solo caracter, como: <code>&lt;A&gt;</code>, <code>&lt;B&gt;</code>, <code>&lt;C&gt;</code>, <code>&lt;D&gt;</code>, <code>&lt;E&gt;</code>, etc.</p>
</div>
<h4 id="Punto" >Punto</h4>
<div class="hBody-4" >
<p>El constructor punto representado por el signo <code>.</code> se utiliza para realizar una coincidencia con cualquier caracter presente en el texto de busqueda.</p>
<p>Por lo general se suele excluir el caracter <code>\n</code> (salto de linea). la razon de este comportamiento es solamente por practicidad aunque conceptualmente no existe un motivo para ello.</p>
<p>El constructor punto no tiene efecto dentro de un conjunto, en su lugar se evalua como <em>el caracter</em> <code>.</code>. No tiene sentido que un conjunto coincida con cualquier caracter.</p>
</div>
<h4 id="Cuantificación" >Cuantificación</h4>
<div class="hBody-4" >
<p>Por defecto, el motor asume que un constructor ha de estar presente almenos una vez, no obstante es posible especificar cuantas veces consecutivas puede aparecer un constructor. Para esto se hace uso de los <em>cuantificadores</em> que mas que un <q>constructor</q>, <em>son una caracteristica de un constructor</em>.</p>
<p>Los cuantificadores se colocan justo al final del constructor al que han de aplicarse.</p>
<p>El constructor alternacion, que veremos mas adelante no es compatible con los cuantificadores.</p>
<dl>
<dt><code>?</code></dt>
<dd>
<p>El constructor puede aparecer cero o una vez. Por ejemplo, <code>ob?scuro</code> se corresponde con <code>oscuro</code> y <code>obscuro</code>.</p>
</dd>
<dt><code>+</code></dt>
<dd>
<p>El elemento debe aparecer al menos una vez. Por ejemplo, <code>ho+la</code> describe el patron infinito <code>hola</code>, <code>hoola</code>, <code>hooola</code>, <code>hoooola</code>, ...,</p>
</dd>
<dt><code>*</code></dt>
<dd>
<p>El elemento puede aparecer cero, una, o más veces. Por ejemplo, <code>0*42</code> se corresponde con <code>42</code>, <code>042</code>, <code>0042</code>, <code>00042</code>, ...,</p>
</dd>
<dt><code>{n}</code></dt>
<dd>
<p>El elemento debe aparecer exactamente <span class="math" >n</span> veces. Por ejemplo <code>[0-9]{3}</code> se corresponden con cualquier cifra de tres digitos como <code>007</code>, <code>747</code>, <code>777</code>, ...,</p>
</dd>
<dt><code>{a,b}</code></dt>
<dd>
<p>El elemento debe aparecer un minimo de <span class="math" >a</span> veces y un maximo de <span class="math" >b</span> veces.</p>
</dd>
<dt><code>{a,}</code></dt>
<dd>
<p>El elemento debe aparecer al menos <span class="math" >a</span> veces.</p>
</dd>
</dl>
</div>
<h4 id="Alternación" >Alternación</h4>
<div class="hBody-4" >
<p>Como ya vimos la agrupacion permite la busqueda de mas de un constructor caracter para una posicion especifica. El constructor alternacion se comporta de forma identica, solo que en lugar de manejar constructores caracter, maneja expreciones delimitadas una de otra por el signo <code>|</code>:</p>
<pre class="code" ><code class="chroma" ><span class="n">exp1</span><span class="o">|</span><span class="n">exp2</span><span class="o">|</span><span class="n">exp3</span><span class="o">|</span><span class="p">...</span>
</code></pre>
<p>en este caso el termino <em>exprecion</em> se refiere a una RegExp en si.</p>
<p>La busqueda de expresiones se realiza de forma secuencial, de izquierda a derecha hasta localizar alguna expresion o hasta agotar las alternativas. Por ejemplo</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;Raptor|T Rex|Triceratops&#34;</span>
</code></pre>
<p>genera los patrones de busqueda <code>Raptor</code>, <code>T Rex</code> y <code>Triceratops</code></p>
<p>Como ya se menciono en el apartado anterior, los cuantificadores no se aplican a este constructor. Para cuantificar las arternativas deben encontrarse dentro de una agrupacion.</p>
</div>
<h4 id="Agrupación" >Agrupación</h4>
<div class="hBody-4" >
<p>Una agrupacion permite definir el ámbito y la precedencia de los demás constructores. Las agrupaciones se delimitan dentro de las signos <code>(</code> y <code>)</code>. Por ejemplo:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;(p|m)adre&#34;</span>
</code></pre>
<p>es equivalente a</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;padre|madre&#34;</span>
</code></pre>
<p>y</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;(des)?amor&#34;</span>
</code></pre>
<p>se corresponde con <code>amor</code> y con <code>desamor</code>.</p>
</div>
<h4 id="Metacaracteres" >Metacaracteres</h4>
<div class="hBody-4" >
<p>Para el motor los signos <code>.</code>, <code>(</code>, <code>)</code>, <code>|</code>, <code>[</code>, <code>]</code>, <code>+</code>, <code>?</code>, <code>{</code>, <code>}</code>, ..., etc. tiene un significado especial, ya sea como delimitadores, como cuantificadores o como constructores.</p>
<p>Como hacer para buscar estos signos como simples caracteres?</p>
<p>Podriamos colocarlos detro de un conjuto de caracteres, asi:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;[()|+]&#34;</span>
</code></pre>
<p>... pero existen casos complejos como:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;[]]&#34;</span>
</code></pre>
<p>cual signo <code>]</code>, marca el limite del conjunto?</p>
<p>Para evitar casos ambiguos se hace uso del constructor <em>metacaracter</em> que despoja de su significado <em>especial</em> a los signos antes mencionados.</p>
<p>El constructor metacaracter suele estar formado por dos signos, el signo que indica que se trata de un metacaracter y el signo al que se aplica. Por lo general el signo utilizado como indicador es <code>\</code>.</p>
<p>Ahora podemos solucionar el ejemplo anterior, pasaria a ser:</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;[\]]&#34;</span>
</code></pre>
<p>que ocurre si se aplica <code>\</code> a un caracter sin significado especial, por ejemplo, a <code>d</code>?</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;\d&#34;</span>
</code></pre>
<p>existen dos posibilidades:</p>
<ol class="num" >
<li>
<p>El motor interpreta <code>d</code> como un caracter (como la haria por defecto).</p>
</li>
<li>
<p>El motor otorga un significado especial al caracter, como podria ser la busqueda de un patron especifico, en cuyo caso, el significado puede variar de una implementacion a otra.</p>
</li>
</ol>
<p>Cuando el caso es el segundo, la mayoria de los motores cosidera que el metacaracer <code>\d</code> (digit) equivalente al colocar conjunto <code>[0-9]</code>.</p>
<p>Aqui una lista de los significados comunes de algunos metacaracters</p>
<ul>
<li>
<p><code>\d</code> ==&gt; <code>[0-9]</code></p>
</li>
<li>
<p><code>\D</code> ==&gt; <code>[^0-9]</code></p>
</li>
<li>
<p><code>\a</code> ==&gt; <code>[a-bA-B]</code></p>
</li>
<li>
<p><code>\A</code> ==&gt; <code>[^a-bA-B]</code></p>
</li>
<li>
<p><code>\w</code> ==&gt; <code>[a-bA-B0-9]</code></p>
</li>
<li>
<p><code>\W</code> ==&gt; <code>[^a-bA-B0-9]</code></p>
</li>
<li>
<p><code>\s</code> ==&gt; <code>[ \t-\r]</code></p>
</li>
<li>
<p><code>\S</code> ==&gt; <code>[^ \t-\r]</code></p>
</li>
</ul>
<p>Finalmente, podemos utilizar metacaracteres para representar signos (<span class="acronym" >ASCII</span>) no impribibles como pueden ser nueva linea (<code>\n</code>), tabulador (<code>\t</code>), retroceso (<code>\b</code>), campana (<code>\a</code>), etc.</p>
</div>
<h4 id="Modiicadores" >Modiicadores</h4>
<div class="hBody-4" >
<p>Aunque no se definen como tal, los modificadores son una forma de alterar el comportamiento del motor al momento de efectuar la busqueda de un patron.</p>
<p>Pongamos como ejemplo los dos modificadores mas comunes:</p>
<dl>
<dt><code>^</code></dt>
<dd>
<p>colocar este signo <em>al inicio</em> de la expresion le indica al motor: la busqueda solo sera valida si el patron se encuentra al inicio del texto.</p>
</dd>
<dt><code>$</code></dt>
<dd>
<p>colocar este signo <em>al final</em> de la expresion le indica al motor: la busqueda solo sera valida si el patron se encuentra al final del texto.</p>
</dd>
</dl>
<p>ambos modificadores pueden combinarse dentro de la expresion, indicando: la busqueda sera valida si el patron inicia el la posicion inicial del texto y finaliza en la ultima posicion.</p>
<p>Los modificadores al igual que los metacaracteres dependen unicamente de lo que especifique cada implementacion.</p>
</div>
<h2 id="Regexp3-(ASCII)" >Regexp3 (ASCII)</h2>
<h3 id="Herramientas" >Herramientas</h3>
<div class="hBody-3" >
<p>Asi que, te has decidido a leer este libro y tienes la suficiente experiencia como para escribir, compilar y ejecutar un programa en C.</p>
<p>No voy a decirte el sistema bajo el que deberias programar, tampoco si es mejor utilizar un editor, un IDE o Emacs, ni cual compilador, shell o mapeo de teclado sea el mas apropiado. Seguramente has elegido tus herramientas tras una profunda reflexion, luego de evaluar todas las posibilidades y no por que alguien te impuso su uso...</p>
<p>No obstante y solamente por motivos informativos, te presento la configuracion que utilizo y el porque:</p>
<ul>
<li>
<p>Como sistema operativo <em>GNU</em> con <em>Linux</em>. No fue hasta que llegue a la distribucion <em>Debian</em>, que conoci lo que era la informatica, lo util de los repositorios de software y la existencia del movimiento <em>software libre</em>.</p>
</li>
<li>
<p>Como entorno de escritorio grafico <em>Gnome Shell</em>. Es simple, sobrio, bonito y eficaz.</p>
</li>
<li>
<p>Donde hay un prompt hay felicidad! No hay mejor herramienta para interactuar con el sistema, que una terminal.</p>
<p>En particular me gusta el emulador de terminal <em>tilix</em>. Tiene pestañas multiples, va a tono con Gnome y pueden desabilitarse el menu y la barra de despalazamiento, para ocupar la pantalla completa sin distracciones, ademas la configuracion del teclado es muy flexible.</p>
</li>
<li>
<p>Quien hace aparecer el prompt es <em>fish</em>, un interpre de comandos con colorines y un sistema de autocompletado fantastico!</p>
</li>
<li>
<p>Para compilar programas C, <em>GCC</em> el compilador de <span class="acronym" >GNU</span>. Ademas suelo pedir una segunda opinion al compilador <em>clang</em> (LLVM).</p>
</li>
<li>
<p>Como sistema de control de versiones <em>git</em>. Conocer los comandos basicos es mas que suficiente.</p>
</li>
<li>
<p>Los sonidos del mundo son muy aburridos. <em>moc</em> (Music On Console) se encarga del amenizar el ambiente con buena musica.</p>
</li>
<li>
<p>La pieza sobre la que gira mi flujo de trabajo se llama <em>GNU Emacs</em>, un interprete de Emacs Lisp, que tambien suele utilizarse como editor de texto (risas). En serio no compliques tu vida con molestos IDEs llenos de botones, menus y mierdas graficas. Todo es mejor en texto plano!</p>
</li>
<li>
<p>Finalmente utilizo el mapeo de teclado <em>programmer dvorak</em> con una ligera modificacion (los dos control, mayus, @ y \) y una configuracion de al menos dos monitores.</p>
</li>
</ul>
</div>
<h3 id="Mr.-Raptor" >Mr. Raptor</h3>
<div class="hBody-3" >
<blockquote>
<p>Disponer del codigo fuente de un programa no garantiza que seamos capaces de compreder su funcionamiento. Si para entender un proyecto es necesario asistir a su construccion y tener presente todos su detalles ocultos, probablemente cuando los desarrolles pasen a otro proyecto nadie este dispuesto (o sea capaz) de continuar con el desarrollo.</p>
<p>Por ello no es suficiente disponer del codigo, ademas, debe ser simple y directo, para que otros sean capaces de comprender su funcionamiento.</p>
<p>El primer paso para lograr este objetivo es dar nombres claros y concisos</p>
</blockquote>
<p>De donde surge el nombre del motor?</p>
<p>La primer version funcional simplemente se llamaba <span class="file" >regexp</span>. Pese a ser un nombre conciso, ya no estaba disponible, lo cual me obligo a ser un poco mas creativo.</p>
<p>El nombre debia destacar las cualidades del proyecto. Si el motor sobresale en algun aspecto es por no tener un manejo explicito de memoria, en su lugar, optiene memoria llamando a funciones y llamando a funciones de forma recursiva... ya esta, <em>RE²</em> (Recursive Regexp), un momento, nooohhh! google ya utiliza este nombre para su motor RegExp <em>RE2</em>, bueno, otra caracteristica tendra... el codigo es compacto, si, es tan compacto que ha de ser ridiculamente eficiente, lo cual lo hace ridiculamente veloz, veloz, veloz, rapido, Raptor, <em>Recursive Regexp Raptor</em>, je, que creativo, no puede ser RE³ o lo asociaran con google, su alias sera <em>regexp3</em> (es mas comodo escribir <code>#include &#34;regexp3.h&#34;</code> que <code>#include &#34;RecursiveRegexpRaptor.h&#34;</code>, ademas, deja clara su funcion y tiene una longitud similar al de otras librerias de C como <code>stdlib</code>, <code>stdio</code> o <code>ctype</code>).</p>
<p>Una ves desvelado el misterio demos paso a la construccion.</p>
</div>
<h3 id="El-truco" >El truco</h3>
<div class="hBody-3" >
<p>He tratado de mantener el codigo lo mas simple y compacto posible, centrando la atencion en los puntos importantes. En la practica esto repercute en tres puntos a cosiderar:</p>
<ul>
<li>
<p>No se utiliza la sintaxis regexp estadar, tampoco la que maneja Perl. En su lugar se opta por la que es mas facil de programar e interpretar.</p>
</li>
<li>
<p>El motor asume que la expresion que resive tiene una sintaxis correcta.</p>
<p>En la practica es igual de complejo constuir una programa encargado solo de verificar y mostrar los errores de sintaxis, a uno que simplemente busca la exprecion. Sin demasiado esfuerzo, se opta por la segunda opcion, ademas, se esta contruyendo un motor RegExp <b>en C</b>, si los datos de entrada son inapropiados, lo minimo que merece el programador es un ciclo de ejecucion infinito.</p>
</li>
<li>
<p>El manejo de memoria no se realiza de forma explicita, en su lugar se acude a la recursividad.</p>
</li>
</ul>
<p>En cualquer punto podras ser capas de reforsar el codigo si asi lo deseas. Sin embargo te recomiendo esperar hasta que el programa realice todas las funciones que necesites.</p>
</div>
<h3 id="La-Sintaxis" >La Sintaxis</h3>
<div class="hBody-3" >
<p>La version final de <code>regexp3</code> (ASCII) soporta los siguientes constructores:</p>
<ul>
<li>
<p>Alternacion <code>|</code></p>
</li>
<li>
<p>Agrupacion <code>()</code>. Para &#34;capturar&#34; la coincidencia del patron dentro de la la cadena de texto, se utiliza <code></code></p>
</li>
<li>
<p>Los cuantificadores son</p>
<ul>
<li>
<p><code>?</code> cero o una vez</p>
</li>
<li>
<p><code>+</code> una o mas veces</p>
</li>
<li>
<p><code>*</code> cero o mas veces</p>
</li>
<li>
<p><code>{n}</code> <span class="math" >n</span> veces</p>
</li>
<li>
<p><code>{n,}</code> al menos <span class="math" >n</span> veces</p>
</li>
<li>
<p><code>{a,b}</code> un rango de veces</p>
</li>
</ul>
</li>
<li>
<p>Los conjuntos <code>[]</code>.</p>
<ul>
<li>
<p>Para negar un conjunto el primer elemento debe ser <code>^</code></p>
</li>
</ul>
</li>
<li>
<p>Lon rangos se especifican con el signo <code>-</code> y son validos fuera de un conjunto, el decir <code>-</code> es un signo especial para el motor. Si queremos despojarlo de su significado tenemos que incluirlo en un metacaracter <code>:-</code>.</p>
</li>
<li>
<p>Punto <code>.</code>. Un punto dentro de un conjunto, no pierde su significado. Para buscar el caracter <code>.</code> debemos incluirlo en un metacaracter <code>:.</code>.</p>
</li>
<li>
<p>El metacaracter se conforma de dos caracteres el signo <code>:</code> y el metacaracter.</p>
</li>
<li>
<p>Los modificadores de comportamiento se aplican de forma global o local y se especifican con el signo <code>#</code> seguido por los modificadores.</p>
<p>Para modificar el comportamiento <em>global</em> de la exprecion, el modificador se coloca al inicio de la exprecion antes de cualquier constructor.</p>
<p>Para modificar el comportamiento de un constructor en especifico <code>#</code> se coloca al final del constructor. Si se aplica un cuantificador al constructor, el modificador debe especificarse despues de este.</p>
</li>
</ul>
</div>
<h3 id="El-algoritmo" >El algoritmo</h3>
<h4 id="Como-interpretar-la-regexp" >Como interpretar la regexp</h4>
<div class="hBody-4" >
<p>Una expresion regular es una serie de instrucciones detalladas no ambiguas, que describen un patron de busqueda a un interprete (motor) de expresiones regulares.</p>
<p>El patron de la regexp sigue una <a href="#Sintaxis-RegExp" >sintaxis</a> donde la unidad fundamental se llama constructor. Estas unidades cual si fuesen bloques de construccion pueden conbinarse y agruparse para formar un patron de busqueda mas complejo segun las reglas y posicion de cada constructor.</p>
<p>En principio, un motor regexp solo necesita dos datos de entrada: la regexp y una cadena de texto sobre la cual efectuar la busqueda del patron.</p>
<p>Una vez el motor tiene estos dos datos, debe <em>optener</em> el primer constructor de la regexp y comparar todas sus combinaciones posibles en la cadena, tomando como posicion de referencia el primer caracter de la cadena.</p>
<p>Si todas las combinaciones fallan, el motor mueve la posicion de referencia al segundo caracter de la cadena y de nuevo prueba todas las combinaciones del primer constructor. Si el primer constructor coincide con la cadena el motor avanza atraves de regexp y cadena, optiene el siguiente constructor y lo compara con la nueva posicion de la cadena. Si el constructor no coincide, el motor vuelve al ultimo recorrido completo e intenta (si existe) una combinacion diferente. De lo contrario, intentara nuevamente con el primer constructor en la siguiente posicion de la cadena.</p>
<p>Si se llega al final de la cadena sin antes agotar los constructores signica que el patron de busqueda no esta precente.</p>
<p>Si se agotan los contructores el motor informara que existe una coincidencia.</p>
<p>Es importante resaltar que el avance tanto en la exprecion como en la cadena se realiza de izquierda a derecha. Esto proboca que el motor regrese la coincidencia en la cadena mas a la izquierda de la combinacion de constructores en la regexp mas a la izquierda.</p>
<p>Resumiento los puntos claves de los parrafos anteriores:</p>
<ol class="num" >
<li>
<p>Se analiza el texto y la regexp de izquierda a derecha.</p>
</li>
<li>
<p>Se optiene el primer constructor de la regexp y se prueban todas sus combinaciones en la posicion actual de la cadena.</p>
</li>
<li>
<p>Si el patron del constructor coincide con la cadena, se avanza atraves de regexp y cadena.</p>
</li>
<li>
<p>Si el patron del constructor no se encuenta en la cadena, el motor vuelve al ultimo recorrido completo e intenta otra ruta.</p>
</li>
<li>
<p>Si no hay otra ruta el motor avanza una posicion en la cadena e intenta con la regexp apartir del primer constructor</p>
</li>
<li>
<p>Si se agotan los constructores tenemos una coincidencia.</p>
</li>
<li>
<p>Si se agota la cadena no tenemos ninguna coincidencia.</p>
</li>
</ol>
<p>El <em>punto dos</em>, da a entender que un constructor tiene varias combinaciones posibles. A saber los constructores son <em>agrupacion</em>, <em>alternacion</em>, <em>conjunto</em>, <em>rango</em>, <em>punto</em>, <em>metacaracter</em> y <em>caracter</em>. Analicemos cada constructor.</p>
<p>Una <em>agrupacion</em> contiene un numero indeterminado de combinaciones posibles, ya que puede <q>agrupar</q> a cualquier otro constructor, incluso otras agrupaciones.</p>
<p>Una <em>alternacion</em> permite recorrer multiples <em>rutas</em> de ejecucion hasta que alguna coincida, cada una de estas &#34;rutas&#34; puede estar formada por expreciones de complejidad arbitraria.</p>
<p>Los <em>conjuntos</em> solo pueden contener <em>rangos</em>, <em>metacaracteres</em> y <em>caracteres</em>.</p>
<p><em>caracteres</em>, <em>metacaracteres</em> y <em>punto</em> no pueden contener a ningun otro constructor.</p>
<p>El <em>caracter</em> solo tiene una combinacion posible, el mismo. El <em>punto</em> puede coincidir con cualquier caracter. Un <em>conjunto</em> puede coincidir con un caracter que este dentro de su conjunto de elementos y la coincidencia de un <em>metacaracter</em> depende de la implementacion de cada motor.</p>
<p>La conclusion es: si el constructor es distinto de <em>caracter</em> tendremos que probar todas sus posibles combinaciones.</p>
<p>El <em>tercer punto</em> dice que el motor avanza atravez de regexp y cadena, es decir, si el constructor coincide con <span class="math" >n</span> caracteres de la cadena, el siguiente constructor se compara <span class="math" >n</span> caracteres despues de la comparacion anterior.</p>
<p>Imaginemos que tenemos un ciclo de busqueda donde los constructores y la cadena se corresponden correctamente:</p>
<div class="example-block" >
<pre class="example" >cadena      0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQ...
            ▲       ▲▲     ▲▲         ▲▲     ▲
            │Α     Ω││Α   Ω││Α       Ω││Α   Ω│
constructor [ cons1 ][cons2][  cons3  ][cons4]...
</pre>
</div>
<p><code>Α</code> (Alfa) señala el punto inicial de la cadena donde se compara el constructor y <code>Ω</code> (Omega) señala los <span class="math" >n</span> caracteres que abarca la (posible) coincidencia.</p>
<p>Puede observarse, que cada constructor es independiente uno de otro, es el motor quien se encarga de coordinar la posicion de la cadena donde se compara un constructor en especifico. El recorrido atravez de ambos, como indica el <em>punto uno</em> siempre se realiza de izquierda a derecha.</p>
<p>El <em>punto cuatro</em> dice que si la comparacion falla, el motor vuelve al ultimo recorrido completo e intenta <em>otra ruta</em>. Esto da a entender que el motor lleva un registro de la posicion en la cadena y el numero de constructor que se utiliza para cada comparacion e incluso que el motor debe conocer la existencia de distintas rutas de ejecucion. Veamos detenidamente este punto.</p>
<p>Si tenemos una serie de constructores de tipo caracter</p>
<div class="example-block" >
<pre class="example" >cadena      0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQ...
            ▲▲▲▲▲△
            ││││││
constructor 01234x6789
</pre>
</div>
<p>y la coincidencia del ultimo constructor falla (<code>x</code> != <code>5</code>) cual seria la ultima ruta de ejecucion completa? Correcto, niguna. En esta exprecion (<code>01234x6789</code>) regresar al constructor anterior <code>4</code> <q><em>la ultima ruta completa</em></q> no tiene sentido, pues para completar la ruta, el constructor tipo caracter <code>x</code> ha de coincidir, es decir, en esta expresion no existe otra ruta de ejecucion posible.</p>
<p>Veamos otro caso:</p>
<div class="example-block" >
<pre class="example" >cadena      0123x56789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQ...
            ▲▲▲▲△
            │││││
constructor 0││3│
             ││ │
             ││[456789]
            (12)
</pre>
</div>
<p>la regexp es <code>0(12)[456789]</code>, ¿cual seria la ultima ruta de ejecucion completa? Correcto, niguna. Al igual que la exprecion anterior solo existe <em>una ruta</em> de ejecucion... porque? un conjunto contiene multiples elementos posibles de coincidencia, no multiples rutas de ejecucion. Si ninguno de sus elementos coincide no hay un punto al cual regresar, esto mismo aplica a las agrupaciones.</p>
<p>Entoces? el unico constructor que permite multiples rutas de ejecucion es la <em>alternacion</em>.</p>
<p>Cuando el motor &#34;ve&#34; una exprecion del tipo <code>1234x|12345</code>, se dice a si mismo: uhh, tengo un par de rutas <code>1234x</code> y <code>12345</code>, debo almacerar la posicion inicial e intertar con la primer ruta, si esta falla restaurar la posicion inicial e intentar con la segunda ruta..</p>
<p>la primer ruta de ejecucion sera</p>
<div class="example-block" >
<pre class="example" >cadena      0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQ...
            ▲▲▲▲▲△
            ││││││
constructor 01234x
</pre>
</div>
<p>el patron falla al comparar el quinto constructor caracter (dentro del constructor alternacion). Luego el motor prueba con la segunda ruta de ejecucion</p>
<div class="example-block" >
<pre class="example" >cadena      0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQ...
            ▲▲▲▲▲▲
            ││││││
constructor 012345
</pre>
</div>
<p>en esta ocacion, todos los constructores miembro del constructor alternacion coinciden, luego entonces, al no existir mas constructores en la exprecion <code>1234x|12345</code> el motor informa la coincidecia.</p>
<p>Esto implica que el motor optiene los constructores de la exprecion <code>1234x|12345</code> de la siguiente forma</p>
<div class="example-block" >
<pre class="example" >regexp          &#34;1234x|12345&#34;

constructor:     1234x|12345       tipo: alternacion
almacenar posicion de inicio

generar          RUTA1 y comparar con la posicion de inicio
constructor:     1                 tipo: caracter
constructor:      2                tipo: caracter
constructor:       3               tipo: caracter
constructor:        4              tipo: caracter
constructor:         x             tipo: caracter

si la primer ruta falla
generar                RUTA2 y comparar con la posicion de inicio
constructor:           1           tipo: caracter
constructor:            2          tipo: caracter
constructor:             3         tipo: caracter
constructor:              4        tipo: caracter
constructor:               5       tipo: caracter
</pre>
</div>
<p>(｀_´)ง un momento, dices que la exprecion</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;abc&#34;</span>
</code></pre>
<p>para el motor es</p>
<div class="example-block" >
<pre class="example" >[Constructor][Constructor][Constructor]
</pre>
</div>
<p>que</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;a[bcdefghi]c&#34;</span>
</code></pre>
<p>para el motor es</p>
<div class="example-block" >
<pre class="example" >[Constructor][Constructor][Constructor]
</pre>
</div>
<p>que</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;(a[bcdefghi])c&#34;</span>
</code></pre>
<p>es</p>
<div class="example-block" >
<pre class="example" >(     a            [bcdefghi]       )     c
[           Constructor             ][Constructor]
[Constructor][     Constructor      ]
</pre>
</div>
<p>y que</p>
<pre class="code" ><code class="chroma" ><span class="sa"></span><span class="s">&#34;(a[12345]|c[12345])|e&#34;</span>
</code></pre>
<p>es</p>
<div class="example-block" >
<pre class="example" >[          Constructor           ]
========RutaA=======|====RutaB====
[   Constructor    ] [Constructor]
=RutaA1= | =RutaA2=
  ...       ...
</pre>
</div>
<p>Eso es correcto! En primer lugar el motor debe identificar los constructores <em>de primer nivel</em> (por llamarlos de algun modo) y luego, si es el caso optener constructores apartir de estos</p>
<p>Como puede observarse en el ultimo ejemplo, si tenemos una alternacion de primer nivel, la exprecion completa es el constructor, ademas la alternacion es el unico constructor que puede generar distintas rutas de ejecucion</p>
<p>Se debe tener en cuenta que siempre existe almenos una ruta de ejecucion, <em>la regexp en si</em>, por lo que se podria considerar que en todas las expresiones tenemos una alternacion de una sola ruta... y, el motor solo ve las alternaciones cuando se encuentran en el primer nivel, en decir, no estan dentro de una agrupacion. Por tanto la primer accion del motor es comprobar si existe mas de una ruta de ejecucion o lo que es lo mismo, averiguar si el primer constructor es una alternacion.</p>
<p>(º-°)ง espera, como puede el motor coordinar el avance entre los constructores de primer nivel y sus componentes, si los tienen?</p>
<p>Sencillo, los constructores miembro desconocen el nivel al que pertenecen, el motor realiza una nueva busqueda con los constructores miembros a partir de un punto concreto en la cadena como si fuesen una exprecion autonoma, como se mostro anteriormente</p>
<div class="example-block" >
<pre class="example" >cadena      0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQabcde...
            ▲           ▲▲           ▲▲           ▲
            │Inicio  Fin││Inicio  Fin││Inicio  Fin│
            [Constructor][Constructor][Constructor]...
</pre>
</div>
<p>si hay una coincidencia el motor informa el resultado y su longitud a quien solicite la consulta.  Veremos este mecanismo en la codificacion del motor.</p>
</div>
<h4 id="Pseudocodigo" >Pseudocodigo</h4>
<div class="hBody-4" >
<ol class="num" >
<li>
<p>El motor recibe la regexp y la cadena de caracteres</p>
</li>
<li>
<p>Un bucle recorre la cadena de izquierda a derecha, un caracter a la vez.</p>
</li>
<li>
<p>Realizamos una busqueda del patron en la posicion actual de la cadena</p>
<ol class="alpha" >
<li>
<p>Un bucle recorre la regexp de izquierda a derecha opteniendo los constructores</p>
<ol class="num" >
<li>
<p>Si el constructor es de tipo alternacion almacenamos la posicion de inicio en la cadena y recorremos las rutas</p>
</li>
<li>
<p>Si el constructor es de tipo agrupacion recorremos sus constructores miembro</p>
</li>
<li>
<p>El resto de constructores pueden buscarse directamente en la cadena</p>
</li>
</ol>
</li>
<li>
<p>Comparamos el constructor</p>
<ol class="num" >
<li>
<p>si hay coincidencia, movemos la cadena las <span class="math" >n</span> posiciones que abarca el patron y pasamos a la siguiente iteracion</p>
</li>
<li>
<p>Si no hay coincidencia la ruta termina con fallo. Pasamos a la sugiente ruta</p>
</li>
<li>
<p>Si no hay mas rutas la busqueda terimina con fallo.</p>
</li>
</ol>
</li>
<li>
<p>Si llegamos al final del bucle hay una coincidencia</p>
</li>
</ol>
</li>
<li>
<p>Si llegamos al final de la cadena (sin agotar los constructores) no hay coincidencia</p>
</li>
</ol>
</div>
<h4 id="Diagrama" >Diagrama</h4>
<div class="hBody-4" >
<div class="art-block" >
<pre class="art" >    ┌──────┐
    │inicio│
    └──────┘
        │◀───────────────────────────────────┐
        ▼                                    │
┌────────────────┐                           │
│bucle por cadena│                           │
└────────────────┘                           │
        │                                    │
        ▼                                    │
 ┌─────────────┐  no   ┌─────────────┐       │
&lt;│fin de cadena│&gt;────▶&lt;│buscar regexp│&gt;──────┘
 └─────────────┘       └─────────────┘  no coincide
        │ si                  │ coincide
        ▼                     ▼
┌────────────────┐    ┌────────────────┐
│informar: no    │    │informar:       │
│hay coincidencia│    │hay coincidencia│
└────────────────┘    └────────────────┘
        │                     │
        │◀────────────────────┘
        ▼
      ┌───┐
      │fin│
      └───┘
</pre>
</div>
<p>En esta version de <code>buscar regexp</code> todos los constructores se optienen por una sola funcion:</p>
<div class="art-block" >
<pre class="art" >                                                            ┌───────────────────────────────┐
┏━━━━━━━━━━━━━┓                                             ▼                               │
┃buscar regexp┃                                   ┌───────────────────┐                     │
┗━━━━━━━━━━━━━┛                                   │Optener constructor│                     │
                                                  └───────────────────┘                     │
                                                            │                               │
                                                            ▼                               │
                                                    ┌───────────────┐  no  ┌─────────────┐  │
                                                   &lt;│hay constructor│&gt;────▶│terminar: la │  │
                                                    └───────────────┘      │ruta coincide│  │
                                                            │ si           └─────────────┘  │
                              ┌──────────┬────────┬─────────┼───────────┬──────────┐        │
                              ▼          ▼        ▼         ▼           ▼          ▼        │
                        ┌───────────┐┌────────┐┌─────┐┌────────────┐┌────────┐┌──────────┐  │
                        │alternacion││conjunto││punto││metacaracter││caracter││agrupacion│  │
                        └───────────┘└────────┘└─────┘└────────────┘└────────┘└──────────┘  │
                              │          │        │         │           │          │        │
                              ▼          └────────┴─────────┼───────────┘          └────────┤
                       ┌──────────────────┐                 │                               │
            ┌──────────│ guardar posicion │                 ▼               no              │
            │          └──────────────────┘       ┌──────────────────┐   coincide           │
            │          ┌──────────────────┐      &lt;│buscar constructor│&gt;─────────┐           │
            ▼◀─────────│restaurar posicion│◀──┐   └──────────────────┘          │           │
     ┌───────────────┐ └──────────────────┘   │             │ coincide          │           │
     │recorrer rutas │                        │             ▼                   ▼           │
     └───────────────┘                        │    ┌──────────────────┐ ┌────────────────┐  │
            │                                 │    │avanzar por cadena│ │terminar, ruta  │  │
            ▼                                 │    └──────────────────┘ │sin coincidencia│  │
        ┌────────┐   si     ┌─────────────┐   │             │           └────────────────┘  │
       &lt;│hay ruta│&gt;───────▶&lt;│buscar regexp│&gt;──┘             └───────────────────────────────┘
        └────────┘          └─────────────┘ no coincide
            │ no           coincide │
            ▼                       ▼
┌─────────────────────────┐ ┌─────────────┐
│terminar sin coincidencia│ │terminar, la │
└─────────────────────────┘ │ruta coincide│
                            └─────────────┘
</pre>
</div>
<p>bonito diseño (funciona!), aun asi buscar el constructor <em>alternacion</em> en cada bucle atravez de la regexp es un desperdicio de recursos, <em>el constructor alternacion solo es visible (al motor</em> si esta fuera de cualquier otro constructor). En la practica, eso siginifica estar fuera del constructor agrupacion.</p>
<div class="art-block" >
<pre class="art" >              ┌──────────────────┐
              │ guardar posicion │                                 ┏━━━━━━━━━━━━━┓
              └──────────────────┘                                 ┃buscar regexp┃
         ┌────────────▶│                                           ┗━━━━━━━━━━━━━┛
         │             ▼
         │      ┌───────────────┐
         │      │recorrer rutas │
         │      └───────────────┘
         │             │                         ┌─────────────────────────────────┐
         │             ▼                         ▼                                 │
         │         ┌────────┐   si     ┌───────────────────┐                       │
         │        &lt;│hay ruta│&gt;────────▶│obtener constructor│                       │
         │         └────────┘          └───────────────────┘                       │
         │             │ no                      │                                 │
         │             ▼                         ▼                                 │
         │ ┌─────────────────────────┐   ┌───────────────┐  no  ┌─────────────┐    │
         │ │terminar sin coincidencia│  &lt;│hay constructor│&gt;────▶│terminar: la │    │
         │ └─────────────────────────┘   └───────────────┘      │ruta coincide│    │
         │                                       │ si           └─────────────┘    │
         │                    ┌────────┬─────────┼───────────┬──────────┐          │
         │                    ▼        ▼         ▼           ▼          ▼          │
┌──────────────────┐      ┌────────┐┌─────┐┌────────────┐┌────────┐┌──────────┐    │
│restaurar posicion│      │conjunto││punto││metacaracter││caracter││agrupacion│    │
└──────────────────┘      └────────┘└─────┘└────────────┘└────────┘└──────────┘    │
         ▲                    │        │         │           │          │          │
         │                    └────────┴─────────┼───────────┘          │          │
         │                                       ▼                      ▼          │
 ┌────────────────┐    no coincide     ┌──────────────────┐      ┌─────────────┐   │
 │terminar: ruta  │◀────────┬─────────&lt;│buscar constructor│&gt;  ┌─&lt;│buscar regexp│&gt;  │
 │sin coincidencia│         │          └──────────────────┘   │  └─────────────┘   │
 └────────────────┘         │                    │ coincide   │         │          │
                            └──────────────────┈┈│┈┈──────────┘         │ coincide │
                                                 ▼                      │          │
                                        ┌──────────────────┐            └──────────┤
                                        │avanzar por cadena│                       │
                                        └──────────────────┘                       │
                                                 │                                 │
                                                 └─────────────────────────────────┘
</pre>
</div>
</div>
<h3 id="codigo" >codigo</h3>
<h4 id="interfaz" >interfaz</h4>
<div class="hBody-4" >
<p>En el lenguaje de programacion C, las funciones dividen un programa extenso en pequeños fragmentos que realizan tareas concretas y dan la posibilidad de construir sobre lo que otros ya han hecho (... eso suena a <em>sotfware libre</em>).</p>
<p>En esencia y segun los gurus del mundo de la programacion, una buena funcion debe cumplir almenos estos principios</p>
<ul>
<li>
<p>debe hacer una sola cosa</p>
</li>
<li>
<p>tener un nombre que describa su funcion</p>
</li>
<li>
<p>no necesitar mas de tres tres argumentos, de preferencia ninguno.</p>
</li>
</ul>
<p>en realidad la lista es mas extensa y detallada (lo suficiente como para escribir un libro), almenos interare seguir estas normas en la medida de lo posible, que tampoco es que existan muchos ejemplos de buen gusto en lo que a programar en lenguaje C se refiere...</p>
<p>Para cumplir el primer punto debemos preguntarnos ¿Que es lo que hace un motor regexp?</p>
<ul>
<li>
<p>Buscar la coincidencia de un patron en una cadena.</p>
</li>
<li>
<p>Mostrar el fragmento de la cadena que corresponda al patron.</p>
</li>
<li>
<p>Localizar todas las coincidencias de un patron.</p>
</li>
<li>
<p>Capturar todas las coincidencias.</p>
</li>
<li>
<p>Mostrar las coincidencias</p>
</li>
<li>
<p>Permitir modificar las coincidencias</p>
</li>
</ul>
<p>Compactar todas estas tareas en una sola funcion, no es prudente (eso no evita que algunas implementaciones lo intenten). <em>Recursive Regexp Raptor</em> hereda una interfaz que ha sobrevidido sin cambio alguno durante miles de millones de años</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">);</span>
</code></pre>
<p>Lo que intenta transmitir el prototipo de funcion es:</p>
<p>Hola, soy un motor de expreciones regulares, me llamo <em>Recursive Regexp Raptor</em> pero tu puedes llamarme <code>regexp3</code>, para invocarme tienes que darme una regexp en forma de cadena de caracteres (argumento <code>re</code>) y una cadena de caracteres donde buscar el patron (argumento <code>txt</code>). Con mis habilidades de raptor descubrire cuantas veces se encuetra el patron en la cadena y te informare de esto regresando el conteo de coincidencias, si no hay coincidencias regreso 0 (cero).</p>
<p>Podriamos decir que cumple las tres reglas</p>
<ul>
<li>
<p>Hace una cosa, contabilizar las coincidencias del patron.</p>
</li>
<li>
<p>tiene un nombre descriptivo... bueno el nombre no es muy explicito que digamos, pero almenos tiene la palabra regexp.</p>
</li>
<li>
<p>no necesita mas de 3 parametros (2 &lt; 3).</p>
</li>
</ul>
<p>El resto de la interfaz, esta relacionado con el manejo y la manipulacion de capturas. Se veran a su debido tiempo segun avance el desarrollo del motor, por el momento nos centraremos en el metodo para optener los constructores de la exprecion.</p>
</div>
<h4 id="constructores" >constructores</h4>
<div class="hBody-4" >
<p>Es una lastima no poder conectarnos directamente a la maquina y transmitirle los algotirmos mentales de cada problema que hemos resuelto. Peor aun, tenemos serias deficiencias para transmitir dichas soluciones de forma detallada, coherente y no ambigua, que es precisamente en lo que consiste la programacion.</p>
<p>Mientras esperamos la llegada de la <a href="https://es.wikipedia.org/wiki/Singularidad_tecnol%C3%B3gica" >singularidad</a> y con la poca habilidad expresiva que poseeo hare lo posible para plasmar un procedimiento logico de codificacion, alla vamos!</p>
<p>La regexp tiene una sintaxis bien definida que nos ayuda a identificar el tipo, patron y alcance de cada constructor. Una vez se ha identificado el constructor es necesario almacenar sus caracteristicas de forma conveniente.</p>
<p>Para nuestra fortuna, C nos permite manejar un grupo de variables relacionadas (las caracteristicas) como una unidad, en lugar de como entidades dispersas. Este tipo de dato compuesto por datos de tipos diversos, recive el nombre de estructura (<code>struct</code>)</p>
<pre class="code" ><code class="chroma" ><span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<p>De momento, la estructura que almacena la informacion de nuestra regexp solo necita dos datos:</p>
<ol class="num" >
<li>
<p>El contenido (instruciones) del constructor.</p>
<p>El motor recive la regexp en formato cadena de caracteres. A medida que analiza la cadena debe marcar el <em>alcance</em> de cada constructor, es decir, el punto de inicio (<code>char *ptr</code>) y su longutid (<code>int len</code>).</p>
</li>
<li>
<p>Un identificador del tipo de constructor que estamos manejando (<code>enum TYPE type</code>)</p>
</li>
</ol>
<p>Cada elemento de la enumeracion <code>TYPE</code> se corresponde con un constructor:</p>
<ul>
<li>
<p><code>PATH</code> para el constructor <em>alternacion</em>.</p>
<p>El motor puede utilizara este identificador a modo de comodin para una expresion sin analizar, ya que cualquier expresion puede considerarse como una alternacion de una sola ruta.</p>
</li>
<li>
<p><code>GROUP</code> para el constructor agrupacion</p>
</li>
<li>
<p><code>HOOK</code>. En la mayoria de implementaciones regexp, cuando una agrupacion coincide con un fragmento de la cadena, el motor debe almacenar una referenecia a dicho fragmento. En nuestra implementacion la captura de una agrupacion debe indicarse explicitamente.</p>
<p>segun el traductor <code>HOOK</code> significa gancho y se ofrece como una opcion para traducir <q>captura</q> o <q>pesca</q>.</p>
</li>
<li>
<p><code>BACKREF</code>. <em>Backreference</em> (retroreferencia o referencia anterior)</p>
<p>Una vez se ha realizado la captura de una seccion de la cadena, con este constructor podemos solicitar la coincidencia de dicha seccion, en una posicicion mas adelante en la cadena</p>
</li>
<li>
<p><code>SET</code> para conjunto de caracteres</p>
</li>
<li>
<p><code>RANGEAB</code> un rango de caracteres.</p>
<p>En realidad este no es un constructor, pero ya que un rango de caracteres posee una estructura especifica, hacemos uso de un idintificador a modo de facilidad.</p>
<p>Una ventaja de esta aproximacion es permitir el uso de rangos fuera de un conjunto.</p>
</li>
<li>
<p><code>META</code> para metacaracter</p>
</li>
<li>
<p><code>POINT</code> para punto</p>
</li>
<li>
<p><code>SIMPLE</code> para caracter.</p>
<p>Dada la estructura del tipo <code>RE</code> y la naturaleza de este constructor, es posible tratar una secuencia de constructores caracter como una simple cadena de caracteres.</p>
</li>
</ul>
<p>Si analizamos el <a href="#Diagrama" >diagrama de flujo</a>, es evidente que la complejidad del problema se concentra en optener los constructores mas que en el recorrido atraves de la cadena. Vamos a concentrarnos en ese aspecto, lo primero sera poder optener el constructor alternacion, los caracteres y las agrupaciones, en ese orden.</p>
<p>Luego podremos realizar busquedas sencillas en una posicicion especifica de la cadena, mas tarde la busqueda se extendera por toda la longitud de la cadena.</p>
<p>Las palabras <q>recorrido</q>, <q>ruta</q>, <q>caminar</q> o <q>segmento</q> son habituales cuando se explica el funcionamiento de un motor regexp. En nuestra implementacion Los nombres de variables y funciones adoptaran esta tematica simpre que sea apropiado.</p>
<p>Con esto en mente y simplificando (mucho) el diagrama</p>
<div class="art-block" >
<pre class="art" >             ┌───────┐
             │regexp3│
             └───┬───┘
                 │◀──────────────────────────────┐
                 ▼                               │
              ┌──────┐                           │
              │walker│                           │
              └──┬───┘                           │
                 │                               │
                 ▼                               │
             ┌────────┐                          │
             │trekking│                          │
             └───┬────┘                          │
  ┌──────┬───────┼─────┬──────┬───────┬──────┐   │
  ▼      ▼       ▼     ▼      ▼       ▼      ▼   │
┌───┐┌───────┐┌────┐┌─────┐┌──────┐┌─────┐┌────┐ │
│SET││RANGEAB││META││POINT││SIMPLE││GROUP││HOOK│ │
└───┘└───────┘└────┘└─────┘└──────┘└─────┘└────┘ │
  └──────┴───────┼─────┴──────┘       └──────┴───┘
                 ▼
              ┌─────┐
              │match│
              └─────┘
</pre>
</div>
<p>La funcion <code>regexp3</code> es la interfaz disponible al usuario. Se encargara de recivir, inicializar los datos, y realizar consultas de coindencia en cada posicion de la cadena.</p>
<p>La funcion <code>walker</code> (caminante) recive la regexp, optiene y recorre cada ruta de ejecucion. Si alguna ruta coincide retorna verdadero, en caso contrario retorna falso</p>
<p>La funcion <code>trekking</code> (senderista) optiene los constructores de una ruta. Segun el tipo del constructor se realiza una consulta a <code>match</code> para buscar un patron directamente en la cadena, o a <code>walker</code> para generar nuevas subrutas de ejecucion y luego optener sus constructores.  <code>trekking</code> devuelve verdadero si todos los constructores coinciden, de lo contrario devuelve falso.</p>
</div>
<h4 id="PATH" ><code>PATH</code></h4>
<div class="hBody-4" >
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE  1
</span><span class="cp">#define FALSE 0
</span><span class="cp"></span>
<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walker</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">cutPath</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span>  <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span>  <span class="n">deep</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;|&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Esta es la primer version de nuestro motor, la unica caracteristica que posee es optener las rutas de ejecucion de la exprecion que recive. Coloca el codigo anterior dentro de un fichero al que deberas llamar <span class="file" >regexp3.h</span>, luego crea un fichero de nombre <span class="file" >test.c</span> y coloca lo siguiente</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&#34;regexp3.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
  <span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ruta1|ruta2|ruta3&#34;</span> <span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>en este fichero aplicaremos diversas pruebas al motor para verificar el correcto funcionamiento de cada caracteristica que vallamos agregando.</p>
<p>Compila el codigo con el siguiete comando</p>
<pre class="code" ><code class="chroma" >gcc -Wall test.c
</code></pre>
<p>y ejecuta la prueba con</p>
<pre class="code" ><code class="chroma" >./a.out
</code></pre>
<p>el resultado de la exprecion <code>&#34;ruta1|ruta2|ruta3&#34;</code> es el siguiente</p>
<pre class="srci" ><code class="sh" ><span class="out" >walker INIT          &gt;&gt;ruta1|ruta2|ruta3&lt;&lt;
walker PATH          &gt;&gt;ruta1&lt;&lt;
walker PATH          &gt;&gt;ruta2&lt;&lt;
walker PATH          &gt;&gt;ruta3&lt;&lt;
</span></code></pre>
<p>Antes de realizar nada <code>walker</code> muestra la regexp inicial, luego, optiene y despliega de izquierda a derecha las rutas de ejecucion de la expresion.</p>
<p>Vamos con la explicacion del codigo en <span class="file" >regexp3.h</span></p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;   // ➊</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;  // ➋</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE  1      </span><span class="c1">// ➌
</span><span class="c1"></span><span class="cp">#define FALSE 0      </span><span class="c1">// ➍
</span><span class="c1"></span>
<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>  <span class="c1">// ➎
</span><span class="c1"></span>
<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>          <span class="c1">// ➏
</span><span class="c1"></span>  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>                    <span class="c1">// ➐
</span><span class="c1"></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>  <span class="c1">// ➑
</span><span class="c1"></span></code></pre>
<p>se utiliza <code>stdio</code> para mostrar la informacon ➊, <code>string</code> ➋ para optener la longitud de la cadena que contiene la regexp.</p>
<p>C, por defecto no tiene constantes que definan verdadero o falso. Reparamos esta carencia mediante las constantes de macro <code>TRUE</code> ➌ (veradero) y <code>FALSE</code> ➍ (falso).</p>
<p>Luego con la enumeracion <code>TYPE</code> generamos constantes que representan los diversos tipos de constructor ➎.</p>
<p>La estructura <code>RE</code> ➏ sera el contenedor de los constructores.</p>
<p>En C, antes de utilizar una funcion tenemos que escribir su definicion, o declarar un prototipo de funcion y realizar la definicion mas adelante. Se opta por declarar los prototipos para que la lectura del codigo fluya de forma descendente ➐➑ segun se van utilizando las funciones.</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>             <span class="c1">// ➊
</span><span class="c1"></span>  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>             <span class="c1">// ➋
</span><span class="c1"></span>  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>   <span class="c1">// ➌
</span><span class="c1"></span>  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>           <span class="c1">// ➍
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">);</span>         <span class="c1">// ➎
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p><code>regexp3</code> la funcion principal del motor, solicita una instancia de la estructura <code>RE</code> y apropiadamente la llama <code>rexp</code> (Regular EXPresion) ➊.</p>
<p>Inicializamos el contenedor <code>rexp</code> con los datos que contiene <code>char *re</code>:</p>
<ol class="num" >
<li>
<p>El inicio de la expresion apunta al inicio de la cadena ➋.</p>
</li>
<li>
<p>La longitud de la expresion es la longitud de la cadena ➌.</p>
</li>
<li>
<p>Ya que toda regexp sin importar la cantidad y tipos de constructores que la conforman contiene almenos una ruta de ejecucion, asignamos el tipo (generico) <code>PATH</code> ➍.</p>
</li>
</ol>
<p>La funcion termina devolviendo el valor de la consulta a <code>walker</code>, quien de momento se limita a recorrer, generar y mostrar las rutas de ejecucion de la exprecion ➎.</p>
<p>Es importante resaltar que <em>ninguna funcion modifica ni la exprecion, ni la cadena de busqueda</em>. El recorrido, comparacion y generacion de constructores siempre se realiza mediante referencias a puntos en la cadena de entrada y en la cadena de la regexp, el unico <q>defecto</q> de este enfoque, es un eficiente manejo de recursos... je!.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>                                                      <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>      <span class="c1">// ➋
</span><span class="c1"></span>  <span class="k">while</span><span class="p">(</span> <span class="n">cutPath</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>                                     <span class="c1">// ➌
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>  <span class="c1">// ➍
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>                                                         <span class="c1">// ➎
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p><code>walker</code> debe optener (y mas adelante buscar) las rutas de ejecucion, lo cual logra con un bucle <code>while</code> y la fucion <code>cutPath</code> ➌.</p>
<p>En lenguaje comun, la funcion dice: tomo una regexp (<code>rexp</code>), la corto en secciones <code>PATH</code> (<code>cutPath</code>), una a la vez, cada seccion se almacena en el contenedor <code>track</code> ➊, para comprobar que el resultado es correcto se muestra su contenido ➍. Este ciclo continua hasta agotar la regexp (<code>while</code>). Si el ciclo termina sin la coincidencia de ninguna ruta, la regexp (como conjunto) no coincide ➎.</p>
<p>La funcion auxiliar <code>cutPath</code> se encarga de cortar la ruta <em>mas a la izquierda</em> de una expresion. Si solo hay una ruta, el corte abarca la expresion entera.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>  <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>                     <span class="c1">// ➋
</span><span class="c1"></span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>  <span class="c1">// ➌
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span>  <span class="n">deep</span><span class="o">++</span><span class="p">;</span>          <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span>  <span class="n">deep</span><span class="o">--</span><span class="p">;</span>          <span class="c1">// ➎
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;|&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>     <span class="c1">// ➏
</span><span class="c1"></span>      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>                <span class="c1">// ➐
</span><span class="c1"></span>      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>            <span class="c1">// ➑
</span><span class="c1"></span>      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>            <span class="c1">// ➒
</span><span class="c1"></span>      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>             <span class="c1">// ➓
</span><span class="c1"></span>  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                     <span class="c1">// ⓫
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Antes de realizar nada debemos comprobar que la regexp tiene algo que cortar, o dicho de otra manera, tiene una longitud mayor a cero ➊. Podemos configurar el codigo de 2 maneras:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">){</span>
    <span class="c1">// acciones
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>o</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="c1">// acciones
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>ambas son validas, elijo la segunda, por que el codigo final tiene dos lineas y un nivel de anidamiento menos. En cuanto a la comprobacion de la segunda opcion <code>==</code> y no <code>&lt;=</code>, se debe a que supongo (remarcando <em>supongo</em>) que <code>==</code> es mas eficiente que <code>&lt;=</code>, ademas, nunca deberia presentarse un caso en el cual la expresion tenga longitud negativa, o no? digo, como un miembro de la raza mas desarrollada de este pequeño planeta azul podria cometer un error al codificar algo tan sencillo... (¬‿¬)!</p>
<p>Realizamos un ciclo que recorre la exprecion en busca del operador <code>|</code> ➏, si se encuentra fuera de una agrupacion ➍➎ tenemos nuestra ruta. Recordemos que el operador <code>(</code> abre una agrupacion y <code>)</code> la cierra, a si mismo, una agrupacion puede agrupar otras agrupaciones, es decir, existen distintos niveles de anidamiento o &#34;profundidad&#34;. Nuestra funcion solo se interesa en las rutas de primer nivel (<code>deep == 0</code>).</p>
<p>Ahora, independientemente del punto donde este (o no) el operador <code>|</code>, la seccion (<code>track</code>) inicia donde inicia la regexp (<code>rexp</code>), tiene la misma longitud (a menos que el ciclo demuestre lo contrario) y se asume que sean del mismo tipo (<code>PATH</code>).</p>
<p>asi, en lugar de tener</p>
<pre class="code" ><code class="chroma" ><span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
<span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
<span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>
</code></pre>
<p>tenemos <code>*track = *rexp</code> ➋.</p>
<p>Si encontramos el operador <code>|</code>, se modifica la longitud de la seccion ➐ a la vez que se &#34;corta&#34; de la expresion ➐➑, el <code>+ 1</code> es para descartar el signo <code>|</code>, pues una vez optenemos el constructor, este deja de tener utilidad.</p>
<div class="example-block" >
<pre class="example" >cutPath llamada uno
expresion  &#34;ruta1|ruta2|ruta3&#34;
seccion    &#34;ruta1&#34;
retono     TRUE

cutPath llamada dos
expresion        &#34;ruta2|ruta3&#34;
seccion          &#34;ruta2&#34;
retono     TRUE

cutPath llamada tres
expresion              &#34;ruta3&#34;
seccion                &#34;ruta3&#34;
retono     TRUE

cutPath llamada cuatro
expresion                    &#34;&#34;
seccion
retono     FALSE
</pre>
</div>
<p>como muestra el ejemplo, en la tercer llamada a <code>cutPath</code>, la seccion es igual a la expresion. El corte deja el punto de inicio de la exprecion en la ultima posicion ➓ con una longitud de cero caracteres ⓫.</p>
</div>
<h4 id="SIMPLE-&amp;-GROUP" ><code>SIMPLE</code> &amp; <code>GROUP</code></h4>
<div class="hBody-4" >
<p>Al igual que en la seccion anterior el codigo se presenta al inicio. Es recomendable que antes de pasar a la explicacion lo analices por tu cuenta, identifiques las diferencias con la ultima version e incluso lo modifiques y sigas tu propia ruta de desarrollo.</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE  1
</span><span class="cp">#define FALSE 0
</span><span class="cp"></span>
<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span>  <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">strnchr</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">cutPath</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">GROUP</span>  <span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking GROUP&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SIMPLE</span> <span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking SIMPLE&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span>  <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span>  <span class="n">deep</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;|&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">){</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">GROUP</span><span class="p">;</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SIMPLE</span><span class="p">;</span>

  <span class="kt">char</span> <span class="o">*</span><span class="n">point</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">point</span> <span class="o">=</span> <span class="n">strnchr</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">))</span> <span class="p">)</span>
    <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">point</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>

  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">strnchr</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">];</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="n">chr</span> <span class="p">)</span> <span class="k">return</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>compila y ejecuta la prueba nuevamente:</p>
<pre class="code" ><code class="chroma" >gcc -Wall test.c <span class="o">&amp;&amp;</span> ./a.out
</code></pre>
<p>la expresion <code>&#34;ruta1|ruta2|ruta3&#34;</code> produce esta salida</p>
<pre class="srci" ><code class="sh" ><span class="out" >walker   INIT        &gt;&gt;ruta1|ruta2|ruta3&lt;&lt;
walker   PATH        &gt;&gt;ruta1&lt;&lt;
trekking SIMPLE      &gt;&gt;ruta1&lt;&lt;
walker   PATH        &gt;&gt;ruta2&lt;&lt;
trekking SIMPLE      &gt;&gt;ruta2&lt;&lt;
walker   PATH        &gt;&gt;ruta3&lt;&lt;
trekking SIMPLE      &gt;&gt;ruta3&lt;&lt;
</span></code></pre>
<p>La diferencia con la version anterior radica en que ahora somos capaces de identificar cadenas de caracteres de tipo <code>SIMPLE</code> (uno o mas constructores caracter).</p>
<p>Veamos el resultado de enviar una prueva con un par de agrupaciones. En el fichero <span class="file" >test.c</span> modifica la funcion principal para que diga lo siguiente:</p>
<pre class="code" ><code class="chroma" ><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
  <span class="c1">// regexp3( &#34;&#34;, &#34;ruta1|ruta2|ruta3&#34; );
</span><span class="c1"></span>  <span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)|A(B|C)&#34;</span> <span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>tras compilar y realizar la prueba, obtenemos:</p>
<pre class="srci" ><code class="" ><span class="out" >walker   init        &gt;&gt;a(b|c)|A(B|C)&lt;&lt;
walker   PATH        &gt;&gt;a(b|c)&lt;&lt;         ➊
trekking SIMPLE      &gt;&gt;a&lt;&lt;              ➋
trekking GROUP       &gt;&gt;b|c&lt;&lt;            ➌
walker   init        &gt;&gt;b|c&lt;&lt;            ➍
walker   PATH        &gt;&gt;b&lt;&lt;              ➎
trekking SIMPLE      &gt;&gt;b&lt;&lt;              ➏
walker   PATH        &gt;&gt;c&lt;&lt;              ➐
trekking SIMPLE      &gt;&gt;c&lt;&lt;              ➑
walker   PATH        &gt;&gt;A(B|C)&lt;&lt;         ➒
trekking SIMPLE      &gt;&gt;A&lt;&lt;
trekking GROUP       &gt;&gt;B|C&lt;&lt;
walker   init        &gt;&gt;B|C&lt;&lt;
walker   PATH        &gt;&gt;B&lt;&lt;
trekking SIMPLE      &gt;&gt;B&lt;&lt;
walker   PATH        &gt;&gt;C&lt;&lt;
trekking SIMPLE      &gt;&gt;C&lt;&lt;
</span></code></pre>
<p>lo que el motor esta haciendo es optener la primer ruta de ejecucion <code>a(b|c)</code> ➊, luego se encuentra con el constructor <code>SIMPLE</code> <code>a</code> ➋, A continuacion optiene la aprupacion <code>(b|c)</code> ➌ y se envia a <code>walker</code> ➍ que optiene posibles rutas ejecucion ➎➐. Envia las rutas de la agrupacion a <code>trekking</code> y este optiene los constructores caracter correspondientes a las rutas <code>b</code> y <code>c</code> ➏➑. Esto concluye el recorrido por el primer constructor de tipo ruta de <q>primer nivel</q></p>
<p>Ya que el siguiente constructor tiene la misma estructura <code>A(B|C)</code> ➒, las acciones siguen el mismo orden.</p>
<p>Quiza la anterior explicacion no sea suficiente para visualizar el recorrido atraves de la expresion, asi que aqui esta la informacion con un formato mas explicito (espero):</p>
<div class="example-block" >
<pre class="example" >walker   init        &gt;&gt;a(b|c)|A(B|C)&lt;&lt;   ┌──▶ walker inicial
walker   PATH        &gt;&gt;a(b|c)&lt;&lt;          ├─┬▶ walker primer ruta
trekking SIMPLE      &gt;&gt;a&lt;&lt;               │ ├──&gt; primer constructor : caracter
trekking GROUP         &gt;&gt;b|c&lt;&lt;           │ └─┬&gt; segundo constructor: agrupacion
walker   init          &gt;&gt;b|c&lt;&lt;           │   ├──▶ walker recursivo
walker   PATH          &gt;&gt;b&lt;&lt;             │   ├─┬▶ walker primer ruta
trekking SIMPLE        &gt;&gt;b&lt;&lt;             │   │ └──&gt; primer constructor : caracter
walker   PATH            &gt;&gt;c&lt;&lt;           │   └─┬▶ walker segunda ruta
trekking SIMPLE          &gt;&gt;c&lt;&lt;           │     └──&gt; primer constructor : caracter
walker   PATH               &gt;&gt;A(B|C)&lt;&lt;   └─┬▶ walker segunda ruta
trekking SIMPLE             &gt;&gt;A&lt;&lt;          ├──&gt; primer constructor : caracter
trekking GROUP                &gt;&gt;B|C&lt;&lt;      └─┬&gt; segundo constructor: agrupacion
walker   init                 &gt;&gt;B|C&lt;&lt;        ├──▶ walker recursivo
walker   PATH                 &gt;&gt;B&lt;&lt;          ├─┬▶ walker primer ruta
trekking SIMPLE               &gt;&gt;B&lt;&lt;          │ └──&gt; primer constructor : caracter
walker   PATH                   &gt;&gt;C&lt;&lt;        └─┬▶ walker segunda ruta
trekking SIMPLE                 &gt;&gt;C&lt;&lt;          └──&gt; primer constructor : caracter
</pre>
</div>
<p>apliquemos una prueba distinta</p>
<pre class="code" ><code class="chroma" ><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
  <span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span> <span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>optenemos</p>
<div class="example-block" >
<pre class="example" >walker   init        &gt;&gt;(a(b|c)|A(B|C))|1234(ea|eb|ec)&lt;&lt;    ┌──▶ walker inicial
walker   PATH        &gt;&gt;(a(b|c)|A(B|C))&lt;&lt;                   ├─┬▶ walker primer ruta
trekking GROUP        &gt;&gt;a(b|c)|A(B|C)&lt;&lt;                    │ └─┬&gt; primer constructor: agrupacion
walker   init         &gt;&gt;a(b|c)|A(B|C)&lt;&lt;                    │   ├──▶ walker recursivo
walker   PATH         &gt;&gt;a(b|c)&lt;&lt;                           │   ├─┬▶ walker primer ruta
trekking SIMPLE       &gt;&gt;a&lt;&lt;                                │   │ ├──&gt; primer constructor : caracter
trekking GROUP          &gt;&gt;b|c&lt;&lt;                            │   │ └─┬&gt; segundo constructor: agrupacion
walker   init           &gt;&gt;b|c&lt;&lt;                            │   │   ├──▶ walker recursivo
walker   PATH           &gt;&gt;b&lt;&lt;                              │   │   ├─┬▶ walker primer ruta
trekking SIMPLE         &gt;&gt;b&lt;&lt;                              │   │   │ └──&gt; primer constructor : caracter
walker   PATH             &gt;&gt;c&lt;&lt;                            │   │   └─┬▶ walker segunda ruta
trekking SIMPLE           &gt;&gt;c&lt;&lt;                            │   │     └──&gt; primer constructor : caracter
walker   PATH                &gt;&gt;A(B|C)&lt;&lt;                    │   └─┬▶ walker segunda ruta
trekking SIMPLE              &gt;&gt;A&lt;&lt;                         │     ├──&gt; primer constructor : caracter
trekking GROUP                 &gt;&gt;B|C&lt;&lt;                     │     └─┬&gt; segundo constructor: agrupacion
walker   init                  &gt;&gt;B|C&lt;&lt;                     │       ├──▶ walker recursivo
walker   PATH                  &gt;&gt;B&lt;&lt;                       │       ├─┬▶ walker primer ruta
trekking SIMPLE                &gt;&gt;B&lt;&lt;                       │       │ └──&gt; primer constructor : caracter
walker   PATH                    &gt;&gt;C&lt;&lt;                     │       └─┬▶ walker segunda ruta
trekking SIMPLE                  &gt;&gt;C&lt;&lt;                     │         └──&gt; primer constructor : caracter
walker   PATH                        &gt;&gt;1234(ea|eb|ec)&lt;&lt;    └─┬▶ walker segunda ruta
trekking SIMPLE                      &gt;&gt;1234&lt;&lt;                ├──&gt; primer constructor : caracter
trekking GROUP                            &gt;&gt;ea|eb|ec&lt;&lt;       └─┬&gt; segundo constructor: agrupacion
walker   init                             &gt;&gt;ea|eb|ec&lt;&lt;         ├──▶ walker recursivo
walker   PATH                             &gt;&gt;ea&lt;&lt;               ├─┬▶ walker primer ruta
trekking SIMPLE                           &gt;&gt;ea&lt;&lt;               │ └──&gt; primer constructor : caracter
walker   PATH                                &gt;&gt;eb&lt;&lt;            ├─┬▶ walker segunda ruta
trekking SIMPLE                              &gt;&gt;eb&lt;&lt;            │ └──&gt; primer constructor : caracter
walker   PATH                                   &gt;&gt;ec&lt;&lt;         └─┬▶ walker tercer ruta
trekking SIMPLE                                 &gt;&gt;ec&lt;&lt;           └──&gt; primer constructor : caracter
</pre>
</div>
<p><em>Magnifico</em>, un poco de codigo y algo de recursividad parecen poder reducir cualquier exprecion con tres tipos distintos de constructores: rutas, agrupaciones y carateres. Ejecuta algunas pruebas mas, por ejemplo:</p>
<pre class="code" ><code class="chroma" ><span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;((a(b|c)|A(B|C))|1234(ea|eb|ec))|PATH2|PATH3|(((a(b|c)|A(B|C))|1234(ea|eb|ec))|PATH4B)|PATH5&#34;</span> <span class="p">);</span>
</code></pre>
<p>no olvides que el motor espera que la sintaxis sea correcta, especialmente para las agrupaciones. Los operadores de apertura y cierre <code>(</code> y <code>)</code> tambien deben estar emparejados en el orden correcto.</p>
<p>Sin mas demora e ignorando los nuevos prototipos de funcion, el primer cambio ocurre en <code>walker</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">cutPath</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span>  <span class="err">➊</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>ahora cada ruta se envia a <code>trekking</code> ➊ con la mision de averiguar si la ruta se encuentra o no, apartir de la posicion actual de la cadena.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>     <span class="c1">// ➊
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">GROUP</span>  <span class="p">){</span>        <span class="c1">// ➋
</span><span class="c1"></span>      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking GROUP&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>  <span class="c1">// ➌
</span><span class="c1"></span>      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>                  <span class="c1">// ➍
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SIMPLE</span> <span class="p">){</span>  <span class="c1">// ➎
</span><span class="c1"></span>      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking SIMPLE&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span> <span class="c1">// ➏
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>                          <span class="c1">// ➐
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p><code>trekking</code> puede resumirse de esta forma:</p>
<ol class="num" >
<li>
<p>se resive una ruta de ejecucion,</p>
</li>
<li>
<p>se optienen y evalunan los constructores de la ruta ➊</p>
</li>
<li>
<p>si todos los constructores coinciden, significa que la ruta coincide <code>TRUE</code> ➐.</p>
</li>
</ol>
<p>Cuando el constructor optenido es de tipo agrupacion (<code>GROUP</code>) ➋ lo enviamos a <code>walker</code> ➌, pues existe la posibilidad de que la agrupacion contenga un constructor tipo <code>PATH</code>.</p>
<p>Cuando el constructor optenido es de tipo caracter (<code>SIMPLE</code>) ➎ se puede evaluar directamente si coincide o no con la cadena, cosa que haremos mas adelante, mientras tanto es suficiente con desplegar el contenido y tipo de ambos segmentos ➍➏.</p>
<p>Si examinas <code>trekking</code>, podras ver que sigue el mismo esquema que <code>walker</code>:</p>
<pre class="code" ><code class="chroma" ><span class="n">retorno</span> <span class="nf">funcion</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">cortarRexpAlmacetarEnTrack</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">){</span>
    <span class="c1">// acciones
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">retorno</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>con dos pequeñas diferencias:</p>
<ul>
<li>
<p>En <code>trekking</code> la expresion coincide si todos los constructores coinciden, mientras que en <code>walker</code> la expresion no coincide si ningun constructor coincide.</p>
</li>
<li>
<p>En <code>trekking</code> la expresion (<code>rexp</code>) es un puntero de la estructura <code>RE</code>, en <code>walker</code> la expresion es una copia.</p>
</li>
</ul>
<p>Ademas, seguimos este esquema por varios y convenientes motivos:</p>
<ol class="num" >
<li>
<p>Para opteren los elementos de una expresion, lo minimo necesario, es: la expresion (<code>rexp</code>), el codigo que extraiga los elementos en orden (bucle y funcion) y un contenedor para almacenar el elemento en turno (<code>track</code>).</p>
</li>
<li>
<p>Cuando llamamos a una funcion, podemos considerar a sus parametros como memoria <q>gratuita</q> libre de gestion, es decir, no necesitamos hacer una peticion explicita de memoria, como tampoco encargarnos de su liberacion.</p>
<p>Este hecho es particularmente relevante cuando la solucion se implementa de manera recursiva, ya que dispondremos de tantas instancias de una variable como sean necesarias... mientras el hardware aguante, claro esta.</p>
</li>
<li>
<p>Interpretamos la regexp como una sucesion de elementos, que contienen (o no) otros elementos. Sumar esta aproximacion, al primer y segundo punto, mas <i>la forma</i> de la funcion, es practicamente una invitacion para implementar el codigo de forma recursiva.</p>
</li>
</ol>
<p>(⌐□ل͜□) Desde luego, todo es tannn evidente...</p>
<p>Nop, siendo honesto, solo lo fue tras un monton de pruebas y cambios, supongo que un libro es analogo a una pelicula o un album de musica, pues, detras del resultado final hay mucho material descartado, solo la mejor toma ve la luz. Si encuentras este material un producto de serie <em>b</em> o <em>z</em> imagina lo malo que es el borrador.</p>
<p>Continuemos con el codigo. <code>trekking</code> utiliza una funcion auxiliar llamada <code>tracker</code> para cortar el constructor mas a la izquierda de la exprecion <code>rexp</code> y almacenarlo dentro de <code>track</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>  <span class="c1">// 🅐
</span><span class="c1"></span>
  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>                     <span class="c1">// 🅑
</span><span class="c1"></span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">){</span>        <span class="c1">// 🅒
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>    <span class="c1">// 🅓
</span><span class="c1"></span>      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>                <span class="c1">// 🅔
</span><span class="c1"></span>        <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">GROUP</span><span class="p">;</span>          <span class="c1">// 🅕
</span><span class="c1"></span>        <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>                 <span class="c1">// 🅖
</span><span class="c1"></span>        <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>      <span class="c1">// 🅗
</span><span class="c1"></span>        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>          <span class="c1">// 🅘
</span><span class="c1"></span>        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>          <span class="c1">// 🅙
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>                  <span class="c1">// 🅚
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SIMPLE</span><span class="p">;</span>               <span class="c1">// 🅛
</span><span class="c1"></span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">point</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">point</span> <span class="o">=</span> <span class="n">strnchr</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">))</span> <span class="p">)</span> <span class="c1">// 🅜
</span><span class="c1"></span>    <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">point</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>  <span class="c1">// 🅝
</span><span class="c1"></span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>           <span class="c1">// 🅞
</span><span class="c1"></span>  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>           <span class="c1">// 🅟
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>                        <span class="c1">// 🅠
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>La funcion inicia comprobando si aun hay algo que cortar 🅐, si no es asi regresamos <code>FALSE</code>.</p>
<p>Luego hacemos una copia del contenido de <code>rexp</code> en <code>track</code> 🅑. El segmento a optener (en este momento) solo puede ser de tipo <code>GROUP</code> 🅕 o <code>SIMPLE</code> 🅚.</p>
<p>En el primer caso, si la exprecion inicia con el operador <code>(</code> 🅒 realizamos un recorrido atraves de la expresion 🅓 hasta localizar el operador de cierre <code>)</code> correspondiente 🅔, asignamos el tipo <code>GROUP</code> 🅕, establecemos la longitud del segmento 🅖🅗, cortamos la expresion dejando la posicion de inicio luego del operador de cierre 🅘🅙 (el +1) y finalmente regeresamos <code>TRUE</code> 🅚.</p>
<p>Habras notado que en 🅖 se realiza un <code>++</code> antes de opteren la longitud del segmento, su cometido es eliminar el operador de apertura <code>(</code> del segmento, por su parte, la operacion 🅗 tambien descarta el operador de cierre <code>)</code>.</p>
<p>En el segundo caso, si no no encontramos un operador de interes al inicio de la expresion, significa que el constructor mas a la izquierda es de tipo caracter 🅛. En esta situacion debemos averiguar la longitud del segmento 🅝, es decir, realizar una busqueda atraves de la expresion intentando encontrar un operador que señale el inicio de un constructor distinto 🅜. Una ves establecida la longitud del segmento, esta debe restarse de la longitud de la expresion 🅞🅟. Finalmente, para mantener vivo el bucle por la expresion, regresamos <code>TRUE</code> 🅠.</p>
<p>Observa que para este caso, si no se encuentra ningun operador, el segmento <code>track</code> tendra la misma longitud que la expresion (🅑).</p>
<p>Por cierto, hace falta explicar la funcion <code>strnchr</code>. La libreria estandar <code>&lt;string.h&gt;</code> incluye una funcion llamada <code>strchr</code> su labor es localizar la primer ocurrencia de un caracter dentro de una cadena de caracteres y regresar un puntero con su ubicacion. No es conveniente utilizar <code>strchr</code> puesto que necesitamos mantener un rango de busqueda limitado a los <span class="math" >n</span> caracteres que corresponden a la longitud de nuestra expresion. Ya que en la libreria estandar no hay una funcion que realice lo que desamos, implementamos nuestra propia version.</p>
<p>Hasta ahora, visualmente nuestro codigo (quiza) seria asi:</p>
<div class="art-block" >
<pre class="art" >┏━━━━━━━━━━━┓                   ▸ regexp llama a walker.
┃           ┃
┃  regexp3  ┃                   ▸ walker optiene las rutas y las envia a trekking
┃           ┃
┗━━━━━━━━━━━┛                   ▸ trekking optiene los constructores
   ┃  ▲      GROUP                - si el tipo es GROUP lo envia a walker
   ┃  ┃  ┏━━━━━━━━━━━━┓           - si el tipo es SIMPLE no hay nada mas que hacer
   ▼  ┃  ▼            ┃
┏━━━━━━━━━━━┓   ┏━━━━━━━━━━━┓
┃           ┃◀━━┃           ┃
┃  walker   ┃   ┃ trekking  ┃━━▶ SIMPLE
┃           ┃━━▶┃           ┃
┗━━━━━━━━━━━┛   ┗━━━━━━━━━━━┛
</pre>
</div>
<p>( ͡° ͜ʖ ͡°)ง? y si dentro de una agrupacion no existieran rutas seria posible que <code>trekking</code> presindiera de la llamada a <code>walker</code>?</p>
<p>Exelente pregunta, en tal caso <code>trekking</code> podria hacerse cargo de optener los constructores dentro de la agrupacion de forma recursiva y el resultado seguiria siendo correcto, es mas si no existiese ninguna ruta <code>regexp3</code> podria consultar directamente a <code>trekking</code> sin pasar por <code>walker</code> pero tendriamos que implementar una nueva funcion, ehhmm, por ejemplo llamada <code>isPath</code> para poder averiguar si en la expresion existen rutas o no.</p>
<p>Visualmente el nuevo modelo seria algo asi:</p>
<div class="art-block" >
<pre class="art" >┏━━━━━━━━━━━┓    ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃           ┃    ▼    ┏━━━━━━━━━━━┓  no            ┃
┃  regexp3  ┃━━━━━━━━▶┃  isPath   ┃━━━━━┓          ┃
┃           ┃         ┗━━━━━━━━━━━┛     ┃          ┃
┗━━━━━━━━━━━┛ CONSULTA      ┃ si        ┃          ┃
   ▲     ▲                  ┃           ┃          ┃
   ┃     ┃                  ▼           ┃          ┃
   ┃     ┃             ┏━━━━━━━━━━━┓    ▼    ┏━━━━━━━━━━━┓
   ┃     ┃             ┃           ┃━━━━━━━━▶┃           ┃
   ┃     ┗━━━━━━━━━━━━━┃  walker   ┃         ┃ trekking  ┃━━▶ SIMPLE
   ┃                   ┃           ┃◀━━━┳━━━━┃           ┃
   ┃    RESPUESTA      ┗━━━━━━━━━━━┛    ┃    ┗━━━━━━━━━━━┛
   ┃                                    ┃
   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
</pre>
</div>
<p><code>isPath</code> seria asi</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">isPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="o">:</span> <span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>en esencia es una version reducida de la actual <code>walker</code>. Si seguimos este esquema cuando existan 2 o mas rutas tendremos que hacer una llamada adicional (primero a <code>isPath</code> y luego a <code>walker</code>), sin mencionar que incementaria la complejidad/cantidad de codigo para resolver un problema ya resuelto. La unica razon para seguir este esquema es generar un registro eficiente del orden de evaluacion de los constructores, pero eso, mi estimado lector, sera implementado en la ultima seccion del libro.</p>
</div>
<h4 id="HOOK" ><code>HOOK</code></h4>
<div class="hBody-4" >
<p>Nuestro motor tendra la capacidad de almacenar el patron que se corresponda con el contenido de una agrupacion, sin embargo, en muchos (si no es que en la mayoria de los) casos, no se desea que el motor genere una captura cada vez que aparece una agrupacion. Por ello crearemos una variante del constructor <code>GROUP</code> de nombre <code>HOOK</code> (anzuelo).</p>
<p>El &#34;nuevo&#34; costructor es identico en comportamiento y estructura a una agrupacion, con dos ligeras deferencias</p>
<ol class="num" >
<li>
<p>utilizaremos los operadores <code>&lt;</code> y <code>&gt;</code> en lugar de <code>(</code> y <code>)</code></p>
</li>
<li>
<p>servira para indicarle explicitamente al motor que deseamos generar una captura.</p>
</li>
</ol>
<p>En esta seccion no implementaremos la funcionalidad de captura, nos limitaremos a agregar el codigo necesario para que el motor pueda identificar el nuevo constructor.</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE  1
</span><span class="cp">#define FALSE 0
</span><span class="cp"></span>
<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span>  <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">trackerPoint</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">cutPath</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">GROUP</span>  <span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking GROUP&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">HOOK</span>  <span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking HOOK&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SIMPLE</span> <span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking SIMPLE&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cutPath</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;|&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">){</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">GROUP</span><span class="p">;</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span> <span class="p">){</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">HOOK</span><span class="p">;</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SIMPLE</span><span class="p">;</span>

  <span class="kt">char</span> <span class="o">*</span><span class="n">point</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">point</span> <span class="o">=</span> <span class="n">trackerPoint</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;(&lt;&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">))</span> <span class="p">)</span>
    <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">point</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>

  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">trackerPoint</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">pos</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">strchr</span><span class="p">(</span> <span class="n">points</span><span class="p">,</span> <span class="n">track</span><span class="p">[</span> <span class="n">pos</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">track</span> <span class="o">+</span> <span class="n">pos</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>es necesario comprobar que el codigo no altere el comportamiento en la prueba que ya tenemos</p>
<pre class="code" ><code class="chroma" ><span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)|A(B|C)&#34;</span> <span class="p">);</span>
</code></pre>
<p>compila y verifica que no haya cambios... bien? Ahora intenta con</p>
<pre class="code" ><code class="chroma" ><span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a(b|c)|A(B|C)&gt;|1234(ea|eb|ec)&#34;</span> <span class="p">);</span>
</code></pre>
<p>a que funciona!</p>
<p>Aqui el resultado (con ligeras modificaciones para hacerlo mas intuitivo)</p>
<div class="example-block" >
<pre class="example" >walker   init        &gt;&gt;&lt;a(b|c)|A(B|C)&gt;|1234(ea|eb|ec)&lt;&lt;    ┌──▶ walker inicial
walker   PATH        &gt;&gt;&lt;a(b|c)|A(B|C)&gt;&lt;&lt;                   ├─┬▶ walker primer ruta
trekking HOOK         &gt;&gt;a(b|c)|A(B|C)&lt;&lt;                    │ └─┬&gt; primer constructor: captura
walker   init         &gt;&gt;a(b|c)|A(B|C)&lt;&lt;                    │   ├──▶ walker recursivo
walker   PATH         &gt;&gt;a(b|c)&lt;&lt;                           │   ├─┬▶ walker primer ruta
trekking SIMPLE       &gt;&gt;a&lt;&lt;                                │   │ ├──&gt; primer constructor : caracter
trekking GROUP          &gt;&gt;b|c&lt;&lt;                            │   │ └─┬&gt; segundo constructor: agrupacion
walker   init           &gt;&gt;b|c&lt;&lt;                            │   │   ├──▶ walker recursivo
walker   PATH           &gt;&gt;b&lt;&lt;                              │   │   ├─┬▶ walker primer ruta
trekking SIMPLE         &gt;&gt;b&lt;&lt;                              │   │   │ └──&gt; optiene el constructor
walker   PATH             &gt;&gt;c&lt;&lt;                            │   │   └─┬▶ walker segunda ruta
trekking SIMPLE           &gt;&gt;c&lt;&lt;                            │   │     └──&gt; optiene el constructor
walker   PATH                &gt;&gt;A(B|C)&lt;&lt;                    │   └─┬▶ walker segunda ruta
trekking SIMPLE              &gt;&gt;A&lt;&lt;                         │     ├──&gt; primer constructor : caracter
trekking GROUP                 &gt;&gt;B|C&lt;&lt;                     │     └─┬&gt; segundo constructor: agrupacion
walker   init                  &gt;&gt;B|C&lt;&lt;                     │       ├──▶ walker recursivo
walker   PATH                  &gt;&gt;B&lt;&lt;                       │       ├─┬▶ walker primer ruta
trekking SIMPLE                &gt;&gt;B&lt;&lt;                       │       │ └──&gt; optiene el constructor
walker   PATH                    &gt;&gt;C&lt;&lt;                     │       └─┬▶ walker segunda ruta
trekking SIMPLE                  &gt;&gt;C&lt;&lt;                     │         └──&gt; optiene el constructor
walker   PATH                        &gt;&gt;1234(ea|eb|ec)&lt;&lt;    └─┬▶ walker segunda ruta
trekking SIMPLE                      &gt;&gt;1234&lt;&lt;                ├──&gt; primer constructor : caracter
trekking GROUP                            &gt;&gt;ea|eb|ec&lt;&lt;       └─┬&gt; segundo constructor: agrupacion
walker   init                             &gt;&gt;ea|eb|ec&lt;&lt;         ├──▶ walker recursivo
walker   PATH                             &gt;&gt;ea&lt;&lt;               ├─┬▶ walker primer ruta
trekking SIMPLE                           &gt;&gt;ea&lt;&lt;               │ └──&gt; optiene el constructor
walker   PATH                                &gt;&gt;eb&lt;&lt;            ├─┬▶ walker segunda ruta
trekking SIMPLE                              &gt;&gt;eb&lt;&lt;            │ └──&gt; optiene el constructor
walker   PATH                                   &gt;&gt;ec&lt;&lt;         └─┬▶ walker tercer ruta
trekking SIMPLE                                 &gt;&gt;ec&lt;&lt;           └──&gt; optiene el constructor
</pre>
</div>
<p>Vamos pues a examinar el codigo.</p>
<p>El primer y poco interesante cambio se encuentra en <code>trekking</code>, donde agregamos una condicion adicional para evaluar al nuevo constructor. Puedes ver que el codigo es identico al de la condicion <code>GROUP</code>, solamente se a adaptado el mensaje de salida.</p>
<p>Algo mas estimulante sucede en <code>trackByType</code> dentro del bucle <code>for</code></p>
<pre class="code" ><code class="chroma" ><span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;|&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
    <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>En la version anterior, teniamos una secuencia de <code>if</code>s para averiguar si estabamos o no dentro de una agrupacion, en cambio, ahora tenemos un solo <code>switch</code> que realiza la misma funcion en lugar de tener cuatro instrucciones <code>if</code> o <code>if</code>-<code>else</code>, por ejemplo:</p>
<pre class="code" ><code class="chroma" ><span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>
</code></pre>
<p>o</p>
<pre class="code" ><code class="chroma" ><span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
<span class="k">else</span> <span class="nf">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
<span class="k">else</span> <span class="nf">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="err">&#39;</span><span class="p">)</span><span class="err">&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>
<span class="k">else</span> <span class="nf">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>
</code></pre>
<p>Cuando se necesita evaluar el contenido de una variable y actuar segun casos especificos, un <code>switch</code> no solo es mas compacto y agradable a la vista, ademas es mas veloz. Dentro de un switch se realiza una sola evaluacion y luego se <em>salta</em> al caso, es decir el tiempo para realizar un switch es independiente del numero de casos (o eso dicen <a href="https://elbauldelprogramador.com/por-que-un-switch-es-mas-rapido-que-su-homologo-if-then-else/" >aqui</a>)</p>
<p>Siguendo el flujo de modificaciones llegamos a <code>tracker</code>. La estrategia es la misma que en <code>trekking</code>, copiar el codigo para <code>GROUP</code>, ponerlo en la secuencia <code>if</code>-<code>else</code> y modificar operadores y tipo, en fin, nada nuevo...  ¡alto! El nuevo constructor trae con sigo nuevos operadores a identificar, tanto al inicio de su constructor, como al final de un segmento de tipo <code>SIMPLE</code>.</p>
<p>Podemos afrontar la nueva situacion con <code>strnchr</code> + una nueva variable + un par de <code>if</code>s, o modificar la funcion y darle un nombre mas adecuado: <code>trackerPoint</code>.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">trackerPoint</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">pos</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">strchr</span><span class="p">(</span> <span class="n">points</span><span class="p">,</span> <span class="n">track</span><span class="p">[</span> <span class="n">pos</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">track</span> <span class="o">+</span> <span class="n">pos</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>A diferencia de <code>strnchr</code>, <code>trackerPoint</code> no se limita a la busqueda de solo un caracter, la nueva funcion realiza la busqueda de un conjunto de caracteres (en forma de cadena de caracteres).</p>
<p><code>points</code> es el conjuto de puntos (caracteres) a rastrear, <code>track</code> es la region donde se realiza la busqueda y <code>len</code> la longitud de la region. La funcion regresa la posicion de la primer coincidencia o un puntero nulo.</p>
<p>esto es lo que hace:</p>
<ul>
<li>
<p>un bucle recorre la region (<code>track</code>) caracter a caracter,</p>
</li>
<li>
<p>con <code>strchr</code> buscamos el caracter en la cadena de rastreo (<code>points</code>)</p>
</li>
<li>
<p>si hay coincidencia regresamos la posicion actual de la cadena.</p>
</li>
<li>
<p>si termina el ciclo regeresamos un puntero nulo.</p>
</li>
</ul>
</div>
<h5 id="Refactorizacion" >Refactorizacion</h5>
<div class="hBody-5" >
<p>Dentro de <code>tracker</code>, es posible identificar la sintaxis de todos los constructores, empleando instrucciones <code>if</code>-<code>else if</code>-<code>else if</code>-...-<code>else</code>, simpre y cuando, tener un monton de codigo duplicado en una funcion obesa no genere ningun transtorno mental en nuestro ser.</p>
<p>si vamos a <code>tracker</code> podemos ver que</p>
<pre class="code" ><code class="chroma" ><span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;(&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;)&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">GROUP</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>es casi identico a</p>
<pre class="code" ><code class="chroma" ><span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span> <span class="p">)</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">HOOK</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>y similar a</p>
<pre class="code" ><code class="chroma" ><span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
<span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span>  <span class="sa"></span><span class="sc">&#39;|&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>en <code>cutPath</code>.</p>
<p>Tambien se repiten muchas lineas para &#34;recorrer&#34; el contenido de una expresion:</p>
<pre class="code" ><code class="chroma" ><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">len</span><span class="p">;</span>
<span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>
</code></pre>
<p>(&#39;̀-&#39;́)ง Si funciona por que eliminar el codigo duplicado?</p>
<p>Segun los gurus:</p>
<ul>
<li>
<p>mas codigo son mas instrucciones a entender, no para nosotros, si para quien intente averiguar que es lo que estamos haciendo.</p>
</li>
<li>
<p>mas codigo expone al programa a mas puntos de fallo, mas puntos de fallo requieren mas pruebas, mas pruebas requieren mas trabajo, mas trabajo conduce al lado obscuro</p>
</li>
<li>
<p>cualquier modificacion ha de hacerse tantas ocaciones como duplicados existan</p>
</li>
<li>
<p>mayor esfuerzo para mantener coherentes las duplicidades.</p>
</li>
<li>
<p>cuanto mas grande es una funcion mas costosa es su ejecucion, en el caso de nuestro motor que se basa en recursividad el costo es aun mayor</p>
</li>
</ul>
<p>┬┴┬┴┤ (ಠ├┬┴┬┴ en un nuevo ataque de honestidad, eliminar el codigo duplicado fue una labor en la que tarde mas de un mes... Intenta resolver el problema por tu cuenta, despues comparalo con mi solucion:</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE  1
</span><span class="cp">#define FALSE 0
</span><span class="cp"></span>
<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walker</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trekking</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">tracker</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">trackByType</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span><span class="p">,</span> <span class="n">PATH</span> <span class="p">)</span> <span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking GROUP&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOOK</span> <span class="p">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking HOOK&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span>   <span class="o">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking SIMPLE&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cut</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">HOOK</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">GROUP</span>   <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">PATH</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">cut</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">PATH</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span>
        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="o">*</span><span class="n">track</span>       <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span>  <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>   <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p><code>cutPath</code> y el codigo duplicado en <code>tracker</code> se agruparon en una nueva funcion llamada <code>trackByType</code>:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>            <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>                               <span class="c1">// ➋
</span><span class="c1"></span>  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>                           <span class="c1">// ➌
</span><span class="c1"></span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cut</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>                   <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">){</span>                             <span class="c1">// ➎
</span><span class="c1"></span>    <span class="k">case</span> <span class="nl">HOOK</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">GROUP</span>   <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">PATH</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">cut</span> <span class="p">){</span>                                  <span class="c1">// ➏
</span><span class="c1"></span>      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>                           <span class="c1">// ➐
</span><span class="c1"></span>      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>                   <span class="c1">// ➑
</span><span class="c1"></span>      <span class="k">if</span><span class="p">(</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">PATH</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>   <span class="c1">// ➒
</span><span class="c1"></span>      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">);</span>                   <span class="c1">// ➓
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>La funcion inicia de forma habitual, comprobando si la exprecion (no) esta vacia ➊.</p>
<p>Se copia el contenido de la exprecion dentro de la seccion ➋ y se modifica el tipo del constructor ➌.</p>
<p>Luego, inicia el recorrido atraves de la exprecion. Con ayuda de un <code>switch</code> ➍ examinamos el contenido de la posicion actual, en busca de operadores de agrupacion (con o sin captura) para conocer el nivel de anidamiento, segun el operador, se incrementa o decrementa el nivel de anidamiento.</p>
<p>A continuacion con otro <code>switch</code> ➎ establecemos el valor de la variable <code>cut</code>, su mision es servir de señal para realizar o no el corte de la seccion ➏. Asignamos el valor de <code>cut</code> mediente evaluaciones booleanas que dependen del tipo de corte, hasta ahora: <code>HOOK</code>, <code>GROUP</code> y <code>PATH</code>. En los primeros dos casos el corte se realiza cuando el nivel de anidamiento es igual a cero, en el caso de ser un corte tipo <code>PATH</code> ademas debemos estar sobre el operador <code>|</code>.</p>
<p>Si el corte ➏ se lleva a cabo, establecemos la longitud de la seccion ➐, que abarca desda la posicion 0 hasta el caracter previo a la posicion actual.</p>
<p>Echando mano de una nueva funcion de nombre <code>fwrRexp</code> ➑, <em>recorremos</em> la posicion de inicio de la expresion. <code>fwrRexp</code> substituye las sentencias</p>
<pre class="code" ><code class="chroma" ><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
<span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">-=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
</code></pre>
<p>resive como parametros un puntero a la estructura <code>RE</code> y el numero de posiciones que vamos a <em>recorrer</em> el punto de inicio</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>de esta manera la sencencia <code>fwrRexp( rexp, i + 1 );</code> ➑, significa que recorremos el contenido de <code>rexp</code> en <code>i + 1</code> posiciones. El <code>+1</code> es para descartar el operador actual (<code>)</code>, <code>&gt;</code> o <code>|</code>) en la siguiente llamada a <code>cutByType</code>.</p>
<p>Tambiene tenemos una evaluacion que mueve el punto de inicio de la seccion <code>track</code> una posicion si el tipo de corte no es de tipo <code>PATH</code>. Asi descartamos el operador de apertura de los cortes <code>HOOK</code> y <code>GROUP</code></p>
<p>visualmente esto es lo que ocurre en cortes de tipo <code>PATH</code></p>
<div class="art-block" >
<pre class="art" >ab(cdefghijklmnopqrstuv)|AB(CDEFGHIJKLMNOPQRSTUV)  ==&gt; contenido en rexp

▲                      ▲ ▲                      ▲
┃   zona de interez    ┃ ┃   zona de interez    ┃
┃  contenido en track  ┃ ┃  contenido en track  ┃
┗━━━━━━━━━━━━━━━━━━━━━━┛ ┗━━━━━━━━━━━━━━━━━━━━━━┛
                        ▲▲
                       ┏┛┗━┓
                       ┃   ┃
                       i + 1
                         AB(CDEFGHIJKLMNOPQRSTUV)  ==&gt; nuevo contenido en rexp
</pre>
</div>
<p>y esto en cortes de tipo agrupacion</p>
<div class="art-block" >
<pre class="art" >(cdefghijklmnopqrstuv)...
▲▲                  ▲▲▲
┃┃ zona de interez  ┃┃┃
┃┃contenido en track┃┃┃
┃┗━━━━━━━━━━━━━━━━━━┛┃┗━━┓
┃▲                   i + 1 se descarta el signo de cierre
┃┃
┃┗━━┓ se descarta el signo de inicio
0 + 1 == fwrRexp( track, 1 )
</pre>
</div>
<p>Cuando el bucle atravez de la exprecion concluye sin realizar ningun corte, la secccion <code>track</code> abarca toda la regexp <code>rexp</code> y la regexp queda vacia ➓.</p>
<p>pasamos a los cambios en <code>trekking</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking GROUP&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOOK</span> <span class="p">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking HOOK&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span>   <span class="o">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking SIMPLE&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>ehh, no hay mucha diferencia, pasamos de <code>if</code>s en serie a un <code>switch</code> con casos. El cambio mas interesante esta en su funcion auxiliar <code>tracker</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>                                     <span class="c1">// ➊
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>       <span class="c1">// ➋
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>       <span class="c1">// ➌
</span><span class="c1"></span>  <span class="k">default</span> <span class="o">:</span>                                                 <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>                    <span class="c1">// ➎
</span><span class="c1"></span>      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>                             <span class="c1">// ➏
</span><span class="c1"></span>      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span>
        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span> <span class="c1">// ➐
</span><span class="c1"></span>      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>          <span class="c1">// ➑
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Una vez mas, un <code>switch</code> es el protagonista del show. Como haciamos en la version anterior, el tipo de la seccion mas a la izquierda, depende del contenido de la primer posicion en la cadena miembro de <code>rexp</code> ➊. Actuamos segun el operador, para <code>(</code> hacemos un corte <code>GROUP</code> ➋, para <code>&lt;</code> un corte <code>HOOK</code> ➌. El resto ➍ caen bajo un corte de tipo <code>SIMPLE</code> ➐➑, solo debemos averiguar la extension de esta seccion, para lo cual se realiza un recorrido por la expresion ➎, hasta dar con un operador ➏ de interes, de lo contrario la seccion abarca toda la expresion ➑.</p>
<p>Es particularmente relevante utilizar <code>return TRUE</code> en ➐. Un <code>break</code> saldria del <code>switch</code> pero no romperia con la ejecucion del ciclo <code>for</code>, toma nota, sera relevante mas adelante.</p>
<p>✌(ﾟ∀ﾟ)✌ nada mal, un <code>for</code> + <code>switch</code> para substituir dos funciones <code>trackerPoint</code> y <code>strchr</code>, encima el codigo paso de tener 138 lineas a 123, 15 lineas menos en las que podemos implementar todo tipo de alocadas funcionalidades...</p>
<p>Antes de pasar a otra cosa, aqui tenemos la funcion <code>trackByLen</code> que nos sirve para cortar las secciones por longitud (y tipo)</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="o">*</span><span class="n">track</span>       <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span>  <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>   <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre>
<p>reducir su funcionamiento es sencillo: copiar todo el contenido de <code>rexp</code> a <code>track</code>, modificar el tipo, longitud y recorrer <code>rexp</code> <span class="math" >n</span> posiciones.</p>
<p>Como siempre verificamos que la prueba optenga el mismo resultado. En la siguiente seccion activaremos pruebas que no requieran ver linea a linea lo la informacion que sale de motor.</p>
</div>
<h4 id="match" ><code>match</code></h4>
<div class="hBody-4" >
<p>( ︶︿︶) ... ... ... veamos, las secciones anteriores mostraron como optener algunos constructores de la regexp, uno a uno de forma consecutiva y de izquierda a derecha. Segun el algoritmo debemos comparar la posicion de inicio de la cadena con el primer constructor, si hay coincidencia avanzar atraves de ambos y repetir esta accion hasta agotar los constructores, la cadena o dejar de encontrar coincidencias. De estas tres demandas, derivamos tres acciones:</p>
<ul>
<li>
<p>Si agotamos los constructores, la regexp coincide</p>
</li>
<li>
<p>Si agotamos la cadena, la regexp no coincide</p>
</li>
<li>
<p>Si no hay coincidencia, probamos con otra ruta. Si no hay otra ruta iniciamos de nuevo en la siguiente posicion de la cadena</p>
</li>
</ul>
<p>Necesario es que el motor pueda <q>caminara</q> atraves de la cadena, es decir, avanzar en caso de coincidencia, retroceder en el caso contrario y continuar la busqueda en la siguiente posicion de la cadena. Podemos implementar todo lo anterior mediante aritmetica de punteros... o crear una estructura que almacene la posicion de inicio (un puntero), la posicion actual (el recorrido del motor) y la longitud de nuestra cadena (para saber cuando parar):</p>
<pre class="code" ><code class="chroma" ><span class="k">struct</span> <span class="n">TEXT</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">pos</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">len</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
<p>Al Dialogo |⌐■_■|=&gt;</p>
<p>Sin importar de cuanta recurisividad haga uso el motor, este siempre opera de forma secuencial, primero entre rutas y luego entre los constructores, como pues, ha de gestionarse la obtencion de constructores?</p>
<p>(ﾟヮﾟ)=&gt; realizando comparaciones con el contenido de la cadena. Si el constructor de turno no coincide la obtecion termina e intentamos con otra ruta, si no hay mas rutas la busqueda falla.</p>
<p>De los tres constructores que podemos optener (alternacion, agrupacion y caracteres) cual se puede comparar con la cadena?</p>
<p>(ﾟヮﾟ)=&gt; Los constructores alternacion y agrupacion, son indicadores para el motor sobre el orden de evaluacion, por si mismos no contienen ningun patron a localizar en la cadena. La cadena esta compuesta por valores concretos, de momento el unico constructor que contiene este tipo de informacion son los caracteres o secuencias de estos (cadenas de caracteres).</p>
<p>⌐■_■ Ohhh, asi que la comparacion ocurre hasta que optenemos constructores de tipo caracter?</p>
<p>(ﾟヮﾟ)=&gt; Si, la coordinacion ocurre al comparar estos constructores, de ello depende continuar con la optecion de constructores y avanzar por la cadena o abortar el recorrido por la ruta/expresion</p>
<p>Al Codigo |⌐■_■|=&gt;</p>
<p>(Esta ocacion solo mostrare las funciones a modificar, sera tu labor realizar los cambios. Comienza por agregar la estructura <code>TEXT</code> (y una instancia global de esta, llamada <code>text</code>) en la posicion del codigo que consideres conveniente, ya el compilador te dira si la ubicacion es correcta o no.)</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">txt</span><span class="p">;</span>            <span class="c1">// ➊
</span><span class="c1"></span>  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>  <span class="c1">// ➋
</span><span class="c1"></span>  <span class="n">text</span><span class="p">.</span><span class="n">pos</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>              <span class="c1">// ➌
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre>
<p>Inicializamos los valores de la instancia global de la estructura <code>TEXT</code>. El punto de inicio apunta al inicio de la cadena ➊, la longitud abarca toda la cadena ➋ y la posicion inicial de comparacion con el primer constructor, es el inicio de la cadena ➌.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   INIT&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
  <span class="k">for</span><span class="p">(</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">oPos</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span> <span class="n">trackByType</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span><span class="p">,</span> <span class="n">PATH</span> <span class="p">);</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">oPos</span> <span class="p">){</span> <span class="c1">// ➊
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;walker   PATH&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>  <span class="c1">// ➋
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>                            <span class="c1">// ➌
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p><code>walker</code> se encarga de recorrer las rutas de la expresion. Cuando una ruta coincida debemos informar la coincidiencia regresando <code>TRUE</code> ➋. Cuando se agoten las rutas regresamos <code>FALSE</code> ➌.</p>
<p>Ahora la busqueda atraves de las rutas mueve el punto de comparacion en la cadena, por ello, antes de realizar ninguna busqueda almacenamos la posicion original, asi, cuando una ruta falle, podemos restaurar la posicion de origen para el siguiente recorrido ➊.</p>
<p>Veamos el recorrido por los constructores de la ruta</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking GROUP&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>    <span class="c1">// ➊
</span><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOOK</span> <span class="p">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking HOOK&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">track</span> <span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>    <span class="c1">// ➋
</span><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span>   <span class="o">:</span>
      <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%-20s &gt;&gt;%.*s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;trekking SIMPLE&#34;</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="n">match</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>    <span class="c1">// ➌
</span><span class="c1"></span>        <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>                        <span class="c1">// ➍
</span><span class="c1"></span>      <span class="k">else</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>                              <span class="c1">// ➎
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>La ruta es su cojunto genera una coincidencia, solo si se agotan los constructores que la conforman. Si uno solo de sus constructores no esta presente dentro de la cadena, el recorrido falla ➊➋➎.</p>
<p>Vamos al caso mas sencillo, el constructor caracter (<code>SIMPLE</code>) agrupado en <code>default</code>.</p>
<p>Tenemos una evaluacion con dos evaluaciones booleanas ➌. Primero, antes de realizar la busqueda, la posicion en la cadena tiene que ser menor a su longitud, es decir, la cadena no ha llegado al final. Segundo la busqueda debe regresar un valor distinto de cero (el numero de caracteres de la coincidencia).</p>
<p>Bien, con esto el motor ya coordina el avance por la regexp, coordinar el avance en la cadena para la siguiente comparacion requiere mover la cadena las <span class="math" >n</span> posiciones de la coincidencia, en este caso, eso es equivalente a sumar a la posicion de la cadena, la longitud del constructor ➍.</p>
<p>En caso de que la comparacion falle terminamos el recorrido con un <code>return FALSE</code> ➎.</p>
<p>Realizar la busqueda por las agrupaciones es mas sencillo, basta con una consulta a <code>walker</code> ➊➋, yo lo llamo <em>la magia de la recursividad</em>.</p>
<p>Pasemos con la funcion que da titulo a esta seccion</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">match</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">strncmp</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// ➊
</span><span class="c1"></span>  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;match    %-11s rexp[%.*s]</span><span class="se">\n</span><span class="s">&#34;</span>
          <span class="sa"></span><span class="s">&#34;         %-11s text[%.*s]</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>
          <span class="n">result</span> <span class="o">?</span> <span class="sa"></span><span class="s">&#34;OK&#34;</span> <span class="o">:</span> <span class="sa"></span><span class="s">&#34;FAIL&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">);</span>
  <span class="k">return</span>  <span class="n">result</span><span class="p">;</span> <span class="c1">// ➋
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p><code>match</code> devuelve el numero de caracteres que coinciden en la posicion actual de la cadena, de 0 (no hay coincidencia) a los <span class="math" >n</span> caracteres que conforman el constructor ➊➋. El resto, es informacion para ver lo que sucede.</p>
<p>Listo! Te preguntaras (o no) si <code>text</code> la instancia de la estructura <code>TEXT</code> debe ser global? ... y la respuesta es no, no deberias tener ninguna variable global modificable en ninguna libreria que escribas, pues de hacerlo asi, quedaria limitada a solo una consulta a la vez. Llamarla de forma simultanea romperia las cosas... pero lo dejo asi por dos buenas razones:</p>
<ol class="num" >
<li>
<p>Una variable global es mas simple de manejar</p>
</li>
<li>
<p>De otra forma, la variable debe &#34;habitar&#34; dentro de la funcion <code>regexp3</code>, luego debe ser enviada por todas las funciones (por toda la recursividad) hasta llegar al punto de comparacion y eso no es gratis.</p>
</li>
</ol>
<p>en fin, una version mas robusta u orientada a objetos, solucianaria este inconveniente enbebiendo todas las variables globales en estructuras/objetos que pasarian a funciones como referencias. Este reto queda pendiente a modo de graduacion para <em>el lector</em>.</p>
<p>Es posible que hayas caido en el camino... veamos si la salida de algunas pruebas ayudan en tu recuperacion.</p>
<p>Modifica (copia o pega) lo siguiente en <span class="file" >test.c</span></p>
<pre class="code" ><code class="chroma" ><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ruta3&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ruta1|ruta2|ruta3&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="n">puts</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;(</span><span class="se">\\</span><span class="s">/)(^-^)(</span><span class="se">\\</span><span class="s">/)&#34;</span> <span class="p">);</span>
  <span class="k">else</span>                                         <span class="n">puts</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;t(-.-t)&#34;</span> <span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>compila y ejecuta (<code class="command" >gcc -Wall test.c &amp;&amp; ./a.out</code>)</p>
<p>esta es la salida</p>
<div class="example-block" >
<pre class="example" >walker   INIT        &gt;&gt;ruta1|ruta2|ruta3&lt;&lt;
walker   PATH        &gt;&gt;ruta1&lt;&lt;
trekking SIMPLE      &gt;&gt;ruta1&lt;&lt;
match    FAIL        rexp[ruta1]
                     text[ruta3] ➊
walker   PATH        &gt;&gt;ruta2&lt;&lt;
trekking SIMPLE      &gt;&gt;ruta2&lt;&lt;
match    FAIL        rexp[ruta2]
                     text[ruta3] ➋
walker   PATH        &gt;&gt;ruta3&lt;&lt;
trekking SIMPLE      &gt;&gt;ruta3&lt;&lt;
match    OK          rexp[ruta3]
                     text[ruta3] ➌
(\/)(^-^)(\/)
</pre>
</div>
<p>magnifico, el motor reestablece la posicion de la ruta en cada comparacion (en realidad solo se modifica en la ultima prueba)</p>
<p>Algo mas complejo</p>
<pre class="code" ><code class="chroma" ><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123gh&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;123(ab|cd|ef|gh)&#34;</span><span class="p">)</span> <span class="p">)</span> <span class="n">puts</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;(</span><span class="se">\\</span><span class="s">/)(^-^)(</span><span class="se">\\</span><span class="s">/)&#34;</span> <span class="p">);</span>
  <span class="k">else</span>                                        <span class="n">puts</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;t(-.-t)&#34;</span> <span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>este es el resultado (modifique la indentacion para mas claridad):</p>
<div class="example-block" >
<pre class="example" >walker   init        &gt;&gt;123(ab|cd|ef|gh)&lt;&lt;     ┌──▶ walker inicial
walker   PATH        &gt;&gt;123(ab|cd|ef|gh)&lt;&lt;     └─┬▶ walker primer ruta
trekking SIMPLE      &gt;&gt;123&lt;&lt;                    ├─┬&gt; primer constructor: caracter
match    OK       rexp[123]                     │ └──▶ comparacion
                  text[123]                     │
trekking GROUP           &gt;&gt;ab|cd|ef|gh&lt;&lt;        └─┬▶ segundo constructor: agrupacion
walker   init            &gt;&gt;ab|cd|ef|gh&lt;&lt;          └┬─▶ walker recursivo
walker   PATH            &gt;&gt;ab&lt;&lt;                    ├─┬▶ walker primer ruta   ➊
trekking SIMPLE          &gt;&gt;ab&lt;&lt;                    │ └─┬&gt; primer constructor: caracter
match    FAIL         rexp[ab]                     │   └──▶ comparacion
                      text[gh]                     │
walker   PATH               &gt;&gt;cd&lt;&lt;                 ├─┬▶ walker segunda ruta  ➋
trekking SIMPLE             &gt;&gt;cd&lt;&lt;                 │ └─┬&gt; primer constructor: caracter
match    FAIL            rexp[cd]                  │   └──▶ comparacion
                         text[gh]                  │
walker   PATH                  &gt;&gt;ef&lt;&lt;              ├─┬▶ walker tercer ruta   ➌
trekking SIMPLE                &gt;&gt;ef&lt;&lt;              │ └─┬&gt; primer constructor: caracter
match    FAIL               rexp[ef]               │   └──▶ comparacion
                            text[gh]               │
walker   PATH                     &gt;&gt;gh&lt;&lt;           └─┬▶ walker cuarta ruta   ➍
trekking SIMPLE                   &gt;&gt;gh&lt;&lt;             └─┬&gt; primer constructor: caracter
match    OK                    rexp[gh]                └──▶ comparacion
                               text[gh]
(\/)(^-^)(\/)
</pre>
</div>
<p>De nuevo el resultado es correcto. Por el registro, parece que todo funciona, en especial el recorrido por las rutas ➊➋➌➍.</p>
<p>Para terminar esta seccion apliquemos una bateria de pruebas mas completa. Modifica el contenido de <code>test.c</code> a esto:</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&#34;regexp3.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">raptorTest</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">errs</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">total</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">#define NTEST( text, re, n )                            \
</span><span class="cp"></span>  <span class="n">result</span> <span class="o">=</span> <span class="n">regexp3</span><span class="p">(</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span> <span class="p">);</span>                         \
  <span class="n">total</span><span class="o">++</span><span class="p">;</span>                                              \
  <span class="k">if</span><span class="p">(</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">n</span> <span class="p">){</span>                                    \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%s:%d Error on N-TEST &gt;%s&lt; &gt;%s&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>        \
            <span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span> <span class="p">);</span>             \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;results %d - %d expected</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">n</span> <span class="p">);</span>  \
    <span class="n">errs</span><span class="o">++</span><span class="p">;</span>                                             \
  <span class="p">}</span>

  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;((a))&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;a&gt;&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;((((((a))))))&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;&lt;&lt;&lt;&lt;a&gt;&gt;&gt;&gt;&gt;&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;c|b|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(b|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(c|b|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(c|b)|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;((&lt;c&gt;|&lt;b&gt;)|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b|raptor&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;c|b|raptor&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(b|raptor)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(c|raptor)|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;((&lt;c&gt;|&lt;raptor&gt;)|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)|A(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)|A(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)|A(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)|A(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;b|c&gt;|A&lt;B|C&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;b|c&gt;|A&lt;B|C&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;b|c&gt;|A&lt;B|C&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;b|c&gt;|A&lt;B|C&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AB&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AC&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AB&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;AC&#34;</span>    <span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1234ea&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1234eb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1234ec&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a(b|c)|A(B|C))|1234(ea|eb|ec)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1234ea&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1234eb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1234ec&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&lt;b|c&gt;|A&lt;B|C&gt;&gt;|1234&lt;ea|eb|ec&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abe&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;acd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ace&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABD&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABE&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ACD&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ACE&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(b|c)(d|e)|A(B|C)(D|E)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;raptor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(c|r)(e|a)(p|q)(t|u)(0|o)(t|r)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TEST %d *** ERRS %d</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">errs</span> <span class="p">);</span>
  <span class="k">return</span> <span class="o">!</span><span class="n">errs</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">raptorTest</span><span class="p">()</span> <span class="p">)</span> <span class="n">puts</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;I am the Raptor&#34;</span> <span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Compila y ejecuta. En mi sistema todas las pruebas fueron correctas.</p>
<p>La macro <code>NTEST</code>, consiste en comprobar que el numero de coincidencias es el esperado, de lo contrario despliega un mensaje de error, con el numero de linea, el fichero, la prueba, el resultado optenido y el esperado.</p>
<p>Ninguna bateria de pruebas es suficiente, siempre pueden presentarse casos imprevistos, por ejemplo, como reaciona el motor ante un conjunto o una ruta vacia? que deberia hacer cuando la cadena o la regexp son apuntadores nulos? despues de una coincidencia deberia consultarse el siguiente caracter de la cadena o continuar al final de la coincidencia?</p>
<p>Las respuestas a estos misterios y mucho mas, en el proximo capitulo!</p>
<div class="about" >
<div class="about-dt" >Nota</div>
<div class="about-dd" >
<p>Apartir de la siguiente seccion, eliminare todos los mensajes que se producen en <span class="file" >regexp3.h</span>, son bastate molestos. Podrian suprimirse colocando el codigo dentro de directivas de compilacion condicional... pero cosidero que esto solo enturbia la estructura del codigo.</p>
<p>Una vez te familiarices con el codigo, no necesitaras mas mensajes que los que se producen en las pruebas.</p>
</div>
</div>
</div>
<h4 id="loops" >loops</h4>
<div class="hBody-4" >
<p>El motor ya puede realizar busquedas reales, pero estas se limitan a la primer posicion de la cadena.</p>
<p>En esta seccion, con unas pocas lineas mas, vamos a extender la busqueda por toda la cadena, ademas se agregara una nueva caracteristica: <em>cuantificadores</em>.</p>
<p>(´・ω・)っ Al codigo</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE            1
</span><span class="cp">#define FALSE           0
</span><span class="cp">#define INF    1073741824 </span><span class="c1">// 2^30
</span><span class="c1"></span>
<span class="k">struct</span> <span class="n">TEXT</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">pos</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="k">static</span> <span class="n">text</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">loopsMin</span><span class="p">,</span> <span class="n">loopsMax</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walker</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trekking</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">looper</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">tracker</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">match</span>      <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">countCharDigits</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">result</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span>
    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>   <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">loops</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>
      <span class="n">result</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">oPos</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span> <span class="n">trackByType</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span><span class="p">,</span> <span class="n">PATH</span> <span class="p">);</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">oPos</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">looper</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">looper</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">HOOK</span><span class="p">:</span> <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span> <span class="k">case</span> <span class="nl">PATH</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span><span class="p">:</span> <span class="k">case</span> <span class="nl">BACKREF</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span> <span class="k">case</span> <span class="nl">SIMPLE</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="n">match</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>
      <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cut</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">HOOK</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">GROUP</span>   <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">PATH</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">cut</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">PATH</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span>
        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span><span class="o">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="k">else</span>         <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
  <span class="p">}</span>

 <span class="nl">getL</span><span class="p">:</span>
  <span class="n">getLoops</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="o">*</span><span class="n">track</span>       <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span>  <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>   <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span>   <span class="mi">1</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;,&#39;</span> <span class="p">){</span>
        <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;}&#39;</span> <span class="p">)</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>
          <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span>
        <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span><span class="p">;</span>

      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">countCharDigits</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">digits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">digits</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">isdigit</span><span class="p">(</span> <span class="o">*</span><span class="n">str</span><span class="o">++</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">digits</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">match</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">return</span> <span class="n">strncmp</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>En primer lugar, se elimino el encabezado <code>&lt;stdio.h&gt;</code> y todas las intrucciones <code>printf</code>.</p>
<p>Un poco mas adelante de declara una nueva constante</p>
<pre class="code" ><code class="chroma" ><span class="cp">#define INF   1073741824 </span><span class="c1">// 2^30
</span><span class="c1"></span></code></pre>
<p>su aparicion esta relacionada con dos nuevas variables que se agregan a la estrucura <code>RE</code></p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">loopsMin</span><span class="p">,</span> <span class="n">loopsMax</span><span class="p">;</span>
</code></pre>
<p>y dos nuevas funciones <code>getLoops</code> y <code>looper</code>.</p>
<p>Examinemos <code>getLoops</code>:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>               <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span>   <span class="mi">1</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// ➋
</span><span class="c1"></span>    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// ➌
</span><span class="c1"></span>    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>                        <span class="c1">// ➎
</span><span class="c1"></span>      <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>                <span class="c1">// ➏
</span><span class="c1"></span>      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;,&#39;</span> <span class="p">){</span>
        <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;}&#39;</span> <span class="p">)</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>                          <span class="c1">// ➐
</span><span class="c1"></span>        <span class="k">else</span> <span class="p">{</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>            <span class="c1">// ➑
</span><span class="c1"></span>          <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span><span class="p">;</span>           <span class="c1">// ➒
</span><span class="c1"></span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>en este documento, los <em>cuantificadores</em> no se consideran un constructor, son una caracteristica (siempre presente) de estos.</p>
<p>Cuando no se especifica ningun cuantificador, el motor debe evaluar el constructor una vez ➊. Para el resto de casos</p>
<ul>
<li>
<p><code>?</code> cero o una vez ➋</p>
</li>
<li>
<p><code>+</code> una o mas veces ➌</p>
</li>
<li>
<p><code>*</code> cero o mas veces ➍</p>
</li>
<li>
<p><code>{n}</code> exactamente <span class="math" >n</span> veces ➏➒</p>
</li>
<li>
<p><code>{n,}</code> al menos  <span class="math" >n</span> veces ➏➐</p>
</li>
<li>
<p><code>{a,b}</code> al menos <span class="math" >a</span> y no mas de <span class="math" >b</span> veces ➏➑</p>
</li>
</ul>
<p>... y asi es como establecemos el numero de repeticiones de un constructor, mediate un rango. He aqui la razon de agregar las nuevas variables <code>loopsMin</code> y <code>loopsMax</code> dentro de la estructura <code>RE</code>.</p>
<p>Ya que la expresion <em>mas veces</em> no es una cifra concreta, lo mas sencillo es recurrir a un valor lo suficientemente grande como para ser improbable (que no imposible) llegar a el, asi se explica la constante <code>INF</code>. El valor de <code>INF</code> es <span class="math" >2</span> elevado a <span class="math" >30</span>. Esta cantidad, equivale en el peor de los casos, a localizar 1 GiB de caracteres, por ejemplo, si el constructor fuese de tipo punto.</p>
<p>En esencia, luego que <code>tracker</code> optiene el constructor llama a <code>getLoops</code> para examinar el resto de la exprecion (<code>rexp</code>) establecer el rango de repeticiones y eliminar la <q>paja</q> en la siguiente iteracion, esa es la funcion de las instrucciones <code>fwrRexp</code>. Veamos como ocurre la coordinacion <code>tracker</code>-<code>getLoops</code>:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>              <span class="c1">// 🅐
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>              <span class="c1">// 🅑
</span><span class="c1"></span>  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span>                                          <span class="c1">// 🅒
</span><span class="c1"></span>        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>          <span class="c1">// 🅓
</span><span class="c1"></span>      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span><span class="o">:</span>                      <span class="c1">// 🅔
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>        <span class="c1">// 🅕
</span><span class="c1"></span>        <span class="k">else</span>         <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>    <span class="c1">// 🅖
</span><span class="c1"></span>        <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>                                                 <span class="c1">// 🅗
</span><span class="c1"></span>      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>                 <span class="c1">// 🅘
</span><span class="c1"></span>  <span class="p">}</span>

 <span class="nl">getL</span><span class="p">:</span>                                                             <span class="c1">// 🅙
</span><span class="c1"></span>  <span class="n">getLoops</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>                                         <span class="c1">// 🅚
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>No hay cambio para los constructores de tipo agrupacion 🅐🅑, se sale del <code>switch</code>, optenemos el rango 🅙 y regresamos verdadero.</p>
<p>Distinto es realizar el corte de secciones tipo <code>SIMPLE</code></p>
<ol class="num" >
<li>
<p>Si encontramos operadores <code>(</code> o <code>&lt;</code> 🅒, cortamos la seccion y <em>saltamos</em> a optener el cuantificador 🅙</p>
<p>｢(ﾟﾍﾟ) con <code>goto</code>!? ejeem, un <code>break</code> romperia el <code>switch</code> pero el bucle segura en ejecucion. Otra solucion seria colocar una <em>bandera</em> en el ciclo pero requiere una comprobacion adicional en cada iteracion, la tercer alternativa es separar el caso <code>default</code> en una una funcion adicional y romper el ciclo con <code>return</code>.</p>
<p>Debemos evitar utilizar <code>goto</code> a toda costa? bueno, en general siempre hay alternativas, pero para casos como este, utilizarlo es razonable, incluso preferible. <code>goto</code> no es el mal, el mal es crear codigo inteligible (por otros humanos).</p>
</li>
<li>
<p>Debemos agregar los signos <code>?</code>, <code>+</code>, <code>*</code> y <code>{</code> como casos de <q>rastreo</q> 🅔. Bien, por que el <code>if</code>-<code>else</code>? respondo a esa pregunta con otra pregunta, en la siguiente expresion, a cual caracter afecta el cuantificador?</p>
<div class="example-block" >
<pre class="example" >abcd+ef
</pre>
</div>
<p><code>+</code> no afecta a toda la cadena, solamente al caracter <code>d</code>, asi que el corte debe ocurrir un caracter antes del cuantificador 🅖, es decir, la region de <code>a</code> a <code>c</code>. Podemos tratar dicha seccion como si fuese una cadena de caracteres, pues todos ellos tiene un cuantificador <code>1</code>-<code>1</code></p>
<p>En la siguiente iteracion (<code>trekking</code>), resiviremos</p>
<div class="example-block" >
<pre class="example" >d+ef
</pre>
</div>
<p>ahora tenemos el caracter al que afecta el cuantificador, asi que el corte tiene una dimencion de un caracter 🅕</p>
<p>en ambos casos se rompe el bucle con un <code>goto</code> 🅗🅙, <code>getLoosp</code> se encarga del resto. Si terminamos el ciclo sin ningun corte, el corte abarca la longitud de la expresion 🅘</p>
</li>
</ol>
<p>Antes mencionamos a <code>trekking</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>                <span class="c1">// ➊
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">looper</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span> <span class="c1">// ➋
</span><span class="c1"></span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p><em>huuu, que recorte!!!</em>. <code>trekking</code> se encarga de verificar que cada constructor ➊ este presente en la cadena, las <span class="math" >n</span> veces que haga falta ➋, en caso contrario regresa <code>FALSE</code>.</p>
<p>Vamos a ver que hace <code>looper</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">looper</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>                                 <span class="c1">// ➊
</span><span class="c1"></span>  <span class="k">case</span> <span class="nl">HOOK</span><span class="p">:</span> <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span> <span class="k">case</span> <span class="nl">PATH</span><span class="p">:</span>                     <span class="c1">// ➋
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>  <span class="c1">// ➌
</span><span class="c1"></span>      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span><span class="p">:</span> <span class="k">case</span> <span class="nl">BACKREF</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span> <span class="k">case</span> <span class="nl">SIMPLE</span><span class="p">:</span>   <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="n">match</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>  <span class="c1">// ➎
</span><span class="c1"></span>      <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>                                                  <span class="c1">// ➏
</span><span class="c1"></span>      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">TRUE</span><span class="p">;</span>          <span class="c1">// ➐
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>en esta funcion debemos evaluar un constructor tantas veces como indique su cuantificador, esto se logra enviando la expresion a una funcion segun sea el caso ➊ a <code>walker</code> ➋➌ o a <code>match</code> ➍➎, un numero no mayor de ocaciones de lo que indica el limite superior <code>loopsMax</code>. El bucle termina cuando la funcion retorna un valor falso o cuando se alcanza el limite superior (en caso de los constructores enviados a <code>match</code>. El bucle tambien termina si la cadena ha llegado a su fin <code>text.pos &lt; text.len</code>).</p>
<p>Al salir del bucle comprobamos que el numero de ciclos sea igual o mayor al limite inferior ➐ y conocemos el resultado.</p>
<p>El avance, por la cadena se logra sumando la longitud de la expresion a la posicion de la cadena ➏. De momento solo el caso <code>SIMPLE</code> entra en esta comparacion, aun asi agrege el resto de casos a modo de anticipo de lo que vendra, ademas esto evita una alarma del compilador, que tambien puede prevenirse colocando un caso <code>defalut</code>, pero creo que esta forma es mucho mas expresiva.</p>
<p>Necesario es, resaltar que las pruebas <code>walker</code> o <code>match</code> pueden fallar y aun asi la funcion <code>looper</code> regresar <code>TRUE</code> siempre y cuando el indice inferior (<code>loopsMin</code>) sea igual a cero, con un avance por la cadena igual a? <em>cero</em>... piensatelo con detenimiento.</p>
<p>Aqui concluye el bucle por los constructores... Continuamos con el bucle por la cadena:</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="kt">int</span> <span class="n">result</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                                 <span class="c1">// ➋
</span><span class="c1"></span>  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span> <span class="c1">// ➌
</span><span class="c1"></span>    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                                 <span class="c1">// ➍
</span><span class="c1"></span>    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                                 <span class="c1">// ➎
</span><span class="c1"></span>    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>   <span class="o">+</span> <span class="n">i</span><span class="p">;</span>                         <span class="c1">// ➏
</span><span class="c1"></span>    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">loops</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>                         <span class="c1">// ➐
</span><span class="c1"></span>
    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>                           <span class="c1">// ➑
</span><span class="c1"></span>      <span class="n">result</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>        <span class="c1">// ➒
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>                                    <span class="c1">// ➓
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>Si queremos conocer cuantas coincidencias hay en la cadena, debemos realizar busquedas en todas las posiciones de esta, es decir, el numero de consultas depende de la longitud de la cadena (<code>loops = text.len</code> ➌), a cada nueva consulta, el inicio y longitud de la cadena se recorre en un caracter ➍➏➐, la posicion de inicio siempre es el primer caracter de la nueva cadena ➎.</p>
<p>Cada coincidencia ➑ incrementa en <span class="math" >1</span> la variable <code>result</code> ➋, una vez termina el bucle se regresa el numero de coincidencias ➓</p>
<p>Gestionar las busquedas por la cadena requiere una variable adicional de avance (<code>forward</code>) ➍. Segun el resto de implementaciones regexp, cuando se localiza un patron, la siguiente busqueda continua al final de la coincidencia... y resulta que podemos conocer la longitud de la coincidencia si vemos la ultima posicion de la cadena <code>text.pos</code>, asi que solo hace falta agregar el valor al indice <code>i</code>, pero entonces, a que se debe la comprobacion ➒? respondo con otra pregunta, que genera esta sentecia?</p>
<pre class="code" ><code class="chroma" ><span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b?&#34;</span> <span class="p">);</span>
</code></pre>
<p>(-᷅_-᷄๑) el retorno del valor 1, con un avance cero?</p>
<p>(^._.^) exacto, si la expresion fuese:</p>
<pre class="code" ><code class="chroma" ><span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b?&#34;</span> <span class="p">);</span>
</code></pre>
<p>que haria el ciclo, <code>for</code>?</p>
<p>(｀_´)ゞ sin la condicion ➒, la suma seria <span class="math" >0</span> y entraria en un bucle infinito comprobando la primer posicion de la cadena una y otra ves. Gracias a la comparacion, y a la instruccion ➍ se asegura continuar la busqueda en la siguiente posicion.</p>
<p>(ง’ω’)و三 ง’ω’)ڡ≡ c-o-r-r-e-c-t-o.</p>
<p>Hay otro <q>problema</q> con los constructores que pueden aparecer cero o mas veces, si se comparan con una cadena vacia, tambien regresan verdadero.</p>
<p>No se cual sea el uso que le des al motor, pero en mi caso si le envio una cadena vacia quiero que me regrese falso sin importar la exprecion que le envie ➊. Obviamente si se resive una expresion vacia, tampoco hay nada que hacer.</p>
<p>Pasemos a las pruebas!</p>
<p>Agrega lo siguiente despues de la ultima prueba <code>NTEST</code> en <span class="file" >test.c</span></p>
<pre class="code" ><code class="chroma" ><span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;o&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;t&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|e|i|o|u&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|e|i|o|u)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|e)|i|(o|u)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|(e))|(i|(o|u))&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa ae ai ao au&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(a|e|i|o|u)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa ae ai ao au&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(1|2|3|4|5)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a1 a2 a3 ao au&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(1|2|3|4|5)&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a1 a2 a3 a4 a5&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(1|2|3|4|5)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa ae ai ao au&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a(a|e|i|o|u) &#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa ae Ai ao au&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A(a|e|i|o|u)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa ae Ai ao au&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A|a)(a|e|i|o|u)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aae aei Aio aoa auu&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A|a)(a|e|i|o|u)(a|e|i|o|u)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">10</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaaa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span>  <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span><span class="p">,</span>   <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?&#34;</span> <span class="p">,</span> <span class="mi">40</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span> <span class="p">,</span> <span class="mi">40</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1}&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1}&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{5}&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{5,}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,5}&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{5,5}&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{10}&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{10,}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,100}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{001,00100}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{0001,}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{021,}&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{001}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{001,}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b{1}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b{1,}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b{001}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b{001,}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,1}&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,1}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{001,000001}&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{20}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|b){1}&#34;</span> <span class="p">,</span> <span class="mi">40</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|b){1,}&#34;</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|b){1,1}&#34;</span> <span class="p">,</span> <span class="mi">40</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab+c&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+bc&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc aabc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+bc&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab abcc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac abbc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab*c&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*bc&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;bc abcc aabc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*bc&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab abcc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac abbc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab{2}c&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,}bc&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc aabc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,2}bc&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab abcc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc{01,03}&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac abbc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc{01,03}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab{000,}c&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab accc abbc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{000}bc&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;bc abcc aabc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{000,5}bc&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ab abcc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc{0,}&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ac abbc abcc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc{0,0100}&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a{1,2}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+b&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*b&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?b&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+b?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*b?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?b?&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+b+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*b+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?b+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+b*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*b*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?b*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(b)?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(b)*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;b&gt;c&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;b&gt;c&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;(a|b)|c&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aa&gt;&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;x&gt;&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;x&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b&gt;x&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;a|b&gt;x|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&lt;a|b&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c&gt;&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;(a|b|c)(a|b|c)(a|b|c)&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;(a|b|c)(a|b|c)(a|b|c)&gt; &#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span>     <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raaaaptor TFest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;CaptorTest&#34;</span><span class="p">,</span>      <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Cap CaptorTest&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Rap Captor Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
</code></pre>
</div>
<h4 id="SET-&amp;-META-&amp;-POINT" ><code>SET</code> &amp; <code>META</code> &amp; <code>POINT</code></h4>
<div class="hBody-4" >
<p>Los conjuntos (o corchetes) son un constructor especialmente complejo (o no), ya que en sus entrañas es posible encontrar tres sintaxis distintas: caracteres, rangos y metaracteres, por si no fuera suficiente, encima, es posible <em>negar</em> el contenido de un conjunto, si este inicia con el caracter <code>^</code>.</p>
<p>Intentando simplificar el asunto, este nuevo elemento sera una combinacion de los constructores <code>SIMPLE</code> (el mismo que ya utilizamos), <code>META</code> y <code>RANGEAB</code>.</p>
<p>Con todo, el codigo no se modifica en exeso asi que tambien se agrega el constructor punto, esto significa que al termino de la seccion tendremos operativos todos los constructores basicos!</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE            1
</span><span class="cp">#define FALSE           0
</span><span class="cp">#define INF    1073741824 </span><span class="c1">// 2^30
</span><span class="c1"></span>
<span class="k">struct</span> <span class="n">TEXT</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">pos</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="k">static</span> <span class="n">text</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>     <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>       <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">TYPE</span> <span class="n">type</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">loopsMin</span><span class="p">,</span> <span class="n">loopsMax</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walker</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trekking</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">looper</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">tracker</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">match</span>      <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchSet</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchMeta</span>  <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span>   <span class="n">chr</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchText</span>  <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walkMeta</span>       <span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walkSet</span>        <span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">countCharDigits</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">result</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span>
    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>   <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">loops</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>
      <span class="n">result</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">oPos</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span> <span class="n">trackByType</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span><span class="p">,</span> <span class="n">PATH</span> <span class="p">);</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">oPos</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">looper</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">looper</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">HOOK</span><span class="p">:</span> <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span> <span class="k">case</span> <span class="nl">PATH</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span><span class="p">:</span> <span class="k">case</span> <span class="nl">BACKREF</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span> <span class="k">case</span> <span class="nl">SIMPLE</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">forward</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">))</span> <span class="p">){</span>
      <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">forward</span><span class="p">;</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cut</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="n">walkMeta</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="p">))</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">walkSet</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">HOOK</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">GROUP</span>   <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">SET</span>     <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span>              <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">PATH</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">cut</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">PATH</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">META</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">POINT</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">SET</span>   <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span>
        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span><span class="o">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">){</span>
          <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span> <span class="p">)</span> <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">RANGEAB</span> <span class="p">);</span>
          <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
  <span class="p">}</span>

 <span class="nl">getL</span><span class="p">:</span>
  <span class="n">getLoops</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="o">*</span><span class="n">track</span>       <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span>  <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>   <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walkSet</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="n">walkMeta</span><span class="p">(</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span> <span class="p">))</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span> <span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walkMeta</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span> <span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span>   <span class="mi">1</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;,&#39;</span> <span class="p">){</span>
        <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;}&#39;</span> <span class="p">)</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>
          <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span><span class="p">;</span>

      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">countCharDigits</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">digits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">digits</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">isdigit</span><span class="p">(</span> <span class="o">*</span><span class="n">str</span><span class="o">++</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">digits</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">match</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">POINT</span>  <span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">&amp;&amp;</span>
                       <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">2</span> <span class="p">];</span>
  <span class="k">case</span> <span class="nl">SET</span>    <span class="p">:</span> <span class="k">return</span> <span class="n">matchSet</span> <span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
  <span class="k">case</span> <span class="nl">META</span>   <span class="p">:</span> <span class="k">return</span> <span class="n">matchMeta</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">]</span>  <span class="p">);</span>
  <span class="k">default</span>     <span class="o">:</span> <span class="k">return</span> <span class="n">matchText</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchText</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span> <span class="p">){</span>
  <span class="k">return</span> <span class="n">strncmp</span><span class="p">(</span> <span class="n">txt</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchMeta</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;a&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalpha</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;A&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalpha</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;d&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isdigit</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;D&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isdigit</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;w&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalnum</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;W&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalnum</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;s&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isspace</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;S&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isspace</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">default</span>  <span class="o">:</span> <span class="k">return</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">chr</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">strnchr</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">];</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="n">chr</span> <span class="p">)</span> <span class="k">return</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchSet</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">reverse</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">strnchr</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">],</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span>  <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span> <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">TRUE</span> <span class="p">:</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Primero, recompila, luego, realiza las pruebas... todo 0K?</p>
<p>Pasamos a examinar como se realizan los nuevos cortes en la funcion <code>tracker</code>:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>                                    <span class="c1">// ➊
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">META</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>   <span class="c1">// ➋
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">POINT</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>   <span class="c1">// ➌
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">SET</span>   <span class="p">);</span> <span class="k">break</span><span class="p">;</span>   <span class="c1">// ➍
</span><span class="c1"></span>  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span>    <span class="c1">// ➎
</span><span class="c1"></span>        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span><span class="o">:</span>    <span class="c1">// ➏
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">){</span>                                      <span class="c1">// ➐
</span><span class="c1"></span>          <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span> <span class="p">)</span> <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">RANGEAB</span> <span class="p">);</span>      <span class="c1">// ➑
</span><span class="c1"></span>          <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>      <span class="c1">// ➒
</span><span class="c1"></span>        <span class="p">}</span> <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>  <span class="c1">// ➓
</span><span class="c1"></span>        <span class="k">goto</span> <span class="n">getL</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
  <span class="p">}</span>

 <span class="nl">getL</span><span class="p">:</span>
  <span class="n">getLoops</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>El <code>switch</code> principal ➊ no oculta su proposito, cada caso muestra de forma evidente nuestra intencion. Conocemos la sintaxis del constructor, la constante que prepresenta su tipo y la accion: cortar por longitud (<code>trackByLen</code>) o por tipo (<code>trackByType</code>), los nuevos constructores no son una exepcion ➋➌➍.</p>
<p>(Recuerda que la sintaxis de <code>regexp3</code> difiere de la de otros motores, los metacaracteres no inician con el prefijo <code>\</code>, en su lugar se utiliza <code>:</code>)</p>
<p>Σ(-᷅_-᷄๑) ? Bueno el caso <code>default</code> no es tan claro como el resto, sobre todo porque aqui es donde se realiza el corte de los rangos, pero veremos que no es inaccesible.</p>
<p>Agregamos los operadores <code>:</code> y <code>.</code> al codigo que establece el limite de la seccion de caracteres ➎</p>
<p>Gestionar el corte de los rangos requiere otro enfoque, aunque no es muy distinto al de los cuantificadores, asi que ponemos el caso junto a estos ➏.</p>
<p>Si aparece una exprecion como</p>
<div class="example-block" >
<pre class="example" >abc1-9
</pre>
</div>
<p>hasta donde abarca la seccion <code>SIMPLE</code>? Del caracter <code>a</code> al caracter <code>c</code>, o lo que es lo mismo, la posicion del operador <code>-</code> menos <span class="math" >1</span> ➓.</p>
<p>en la siguiente iteracion quedaria</p>
<div class="example-block" >
<pre class="example" >1-9
</pre>
</div>
<p>cuando el operador <code>-</code> esta en la posicion <span class="math" >1</span> ➐ la seccion abarca tres caracteres ➑. Para la misma posicion, si el operador no es <code>-</code>, significa que tenemos un cuantificador, asi que la seccion afecta a un solo caracter ➒.</p>
<p>La inclusion de los metacaracteres obliga a tomar consideraciones extra cuado se analiza el contenido de la expresion, de otra forma expresiones como</p>
<div class="example-block" >
<pre class="example" >:||:a
</pre>
</div>
<p>o</p>
<div class="example-block" >
<pre class="example" >(abc:))
</pre>
</div>
<p>o</p>
<div class="example-block" >
<pre class="example" >:[[123]
</pre>
</div>
<p>provocarian resultados erroneos y en el peor de los casos, un error de segmentacion si se recorre el arreglo que contiene la expresion, mas alla de su limite.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cut</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="n">walkMeta</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="p">))</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span> <span class="c1">// ➊
</span><span class="c1"></span>    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">walkSet</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>                    <span class="c1">// ➋
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">HOOK</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">GROUP</span>   <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">SET</span>     <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span>              <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>                     <span class="c1">// ➌
</span><span class="c1"></span>    <span class="k">case</span> <span class="nl">PATH</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">cut</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">PATH</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>La funcion <code>walkMeta</code> ➊ regresa el numero de caracteres consecutivos con <q>apariencia</q> de metacaracter. Desde luego, su ubicacion dentro de la condicion del bucle <code>for</code> no es accidental, sumamos la cantidad de metacaracteres a la ubicacion actual y luego se comprueba que sigamos dentro de la expresion (comparacion con <code>rexp-&gt;len</code>).</p>
<p>Ya dentro del bucle, no hay metacaracteres que interfieran o confundan la validez de los operadores a evaluar... a menos que crusemos el inospito territorio del constructor conocido como <em>conjunto</em>, recondemos que dentro de un conjunto signos como <code>(</code>, <code>)</code>, <code>|</code>, <code>?</code>, etc. no necesitan escaparse, la solucion? algo similar a <code>walkMeta</code>, en este caso la funcion se llama <code>walkSet</code> ➋.</p>
<p><code>walkSet</code> a diferencia de <code>walkMeta</code>, regresa la <em>posicion de cierre</em> del constructor, que deberia corresponderse con el operador <code>]</code>. Opera de esta forma para coincidir con la forma en que se realiza el corte de las agrupaciones <code>SET</code> ➌, con lo que el codigo que realiza el corte no requiere ninguna modificacion.</p>
<p>Aqui estan las definicion de <code>walkMeta</code> y <code>walkSet</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">walkSet</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="n">walkMeta</span><span class="p">(</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span> <span class="p">))</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span> <span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walkMeta</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span> <span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Primero <code>walkMeta</code>. La funcion aunque un poco rebuscada, dice, si la posicion actual tiene una sintaxis de metacaracter (es igual a <code>:</code>) avanza a la siguiente posicion (<code>i += 2</code>) de otra forma, regresa la posicion actual. Simple y eficaz! a menos que nos envien una expresion como</p>
<div class="example-block" >
<pre class="example" >:a:b:
</pre>
</div>
<p>donde el ultimo <code>:</code> probocaria la revision de un indice fuera de los limites del arreglo... como este motor es para <b>gente seria</b> tal error jamas se presentara...</p>
<p>Veamos <code>walkSet</code>, esquivamos los metacacteres y si encontramos el operador de cierre regresamos su posicion. Como medida preventiva, si termina el bucle sin coincidencia, regresamos la longitud de la seccion, de hay la variable <code>len</code>.</p>
<p>En alguna version <code>walkSet</code> tenia este aspecto</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">walkSet</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">TRUE</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span>    <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>funcionaba? claro, incluso era mas eficiente, en fin, un poco de seguridad tampoco biene mal.</p>
<p>En este punto ya tenemos los nuevos constructores, necesario es confrontarlos con el contenido de la cadena.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">looper</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">HOOK</span><span class="p">:</span> <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span> <span class="k">case</span> <span class="nl">PATH</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span><span class="p">:</span> <span class="k">case</span> <span class="nl">BACKREF</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span> <span class="k">case</span> <span class="nl">SIMPLE</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">forward</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">))</span> <span class="p">){</span>
      <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">forward</span><span class="p">;</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>tres cosas cambian en <code>looper</code></p>
<ol class="num" >
<li>
<p>se declara la variable <code>forward</code>. Hasta el momento solo comprobabamos cadenas de caracteres, asi que conociamos la cantidad de posiciones coincidentes de antemano. Con los nuevos agregados, esto deja de ser posible y ha de informarse este dato explicitamente, de hay su necesidad</p>
</li>
<li>
<p><code>forward</code> se establece con el valor devuelto por <code>match</code>, que regresa el numero de caracteres que coinciden, mayor a cero para verdadero o 0 para falso</p>
</li>
<li>
<p>movemos la posicion de la cadena los <span class="math" >n</span> caracteres coincidentes</p>
</li>
</ol>
<p>mientras tanto <code>match</code> adquiere nuevos poderes</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">match</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">POINT</span>  <span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>                        <span class="c1">// ➊
</span><span class="c1"></span>  <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">&amp;&amp;</span>   <span class="c1">// ➋
</span><span class="c1"></span>                       <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">2</span> <span class="p">];</span>
  <span class="k">case</span> <span class="nl">SET</span>    <span class="p">:</span> <span class="k">return</span> <span class="n">matchSet</span> <span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>                         <span class="c1">// ➌
</span><span class="c1"></span>  <span class="k">case</span> <span class="nl">META</span>   <span class="p">:</span> <span class="k">return</span> <span class="n">matchMeta</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">]</span>  <span class="p">);</span>     <span class="c1">// ➍
</span><span class="c1"></span>  <span class="k">default</span>     <span class="o">:</span> <span class="k">return</span> <span class="n">matchText</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">);</span>     <span class="c1">// ➎
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>(」゜ロ゜)」 momento! en <code>looper</code> ya conociamos el tipo de constructor, efectuar un <code>switch</code> adicional, dentro de <code>match</code> no es redundante?</p>
<p>[-┏ω┓-] quiza, sin enbargo colocar codigo en cada caso de <code>looper</code> al estilo:</p>
<pre class="code" ><code class="chroma" ><span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">steps</span> <span class="o">=</span> <span class="n">matchCASO</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">))</span> <span class="p">){</span>
  <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">;</span>
  <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre>
<p>donde <code>matchCASO</code> es la llamada especializada de cada costructor, me parece exesivo, ademas segun una prueba para ver el rendimiento, la llamada <q>intermedia</q> a <code>match</code> y su <code>switch</code> ofrecen un mejor desempeño respecto a la velocidad.</p>
<p>Resuelto el dilema, analicemos el primer caso. En nuestro motor <code>POINT</code> coincide con cualquier caracter, por lo tanto si no se ha alcanzado el final de la cadena, tenemos una coincidencia ➊.</p>
<p>Los rangos, faciles tambien son ➋. Mediante una evaluacion booleana comprobamos que el valor del caracter en la posicion actual de la cadena sea mayor o igual al limite inferior del rango (primer elemento del rango, indice 0) y a su vez menor o igual al limite superior (tercer elemento del rango, indice 2). Recordemos que la cadena que define un rango de caracteres esta forrmada por tres caracters y el segundo elemento es el signo <code>-</code>.</p>
<p>ʕ´•ᴥ•`ʔ y para este constructor no verificamos antes, estar dentro del limite da la cadena?</p>
<p>＼_(￣、￣ 彡 ￣ー￣)_／ －☆・　・　・　‥……━━● (magia) no esperaba menos, en efecto, podriamos colocar un <code>if</code> antes del <code>switch</code> que verifique el limite. y una instruccion <code>return FALSE</code> al final de la funcion... o dentro de <code>looper</code> ☜(ﾟ∀ﾟ✌) colocar esta condicion antes de realizar la cosulta, como hemos venido haciendo desde que aparecio <code>match</code> en el codigo, fumm!.</p>
<p>Por orden de complejidad, seguiria el caso <code>default</code> donde cae la busqueda de texto, tal cual aparece en el constructor:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">matchText</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span> <span class="p">){</span>
  <span class="k">return</span> <span class="n">strncmp</span><span class="p">(</span> <span class="n">txt</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>en esencia es el <code>match</code> de la seccion previa con un nombre distinto. Se emplea <code>defualt</code> en lugar de <code>SIMPLE</code> para suprimir advertencias del compilador.</p>
<p>Continuemos con los metacaracteres</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">matchMeta</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">){</span>                 <span class="c1">// ➊
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;a&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalpha</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➋
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;A&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalpha</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➌
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;d&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isdigit</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➍
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;D&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isdigit</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➎
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;w&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalnum</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➏
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;W&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalnum</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➐
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;s&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isspace</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➑
</span><span class="c1"></span>  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;S&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isspace</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➒
</span><span class="c1"></span>  <span class="k">default</span>  <span class="o">:</span> <span class="k">return</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">chr</span><span class="p">;</span>  <span class="c1">// ➓
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>En nuestro motor un meta caracter esta formado por dos caracteres, el indicador de metacaracter (<code>:</code>) y el metacaracter en si. El primer paso es averiguar el metacarater ➊, luego deacuerdo a el caso, realizamos una accion especifica segun los metacracteres que deseemos implementar. En este motor son:</p>
<ul>
<li>
<p>(<code>a</code>) cualquier caracter en el rango a-z o A-Z ➋.</p>
</li>
<li>
<p>(<code>A</code>) cualquier caracter que no este en el rango a-z o A-Z ➌.</p>
</li>
<li>
<p>(<code>d</code>) cualquier caracter en el rango 0-9 ➍.</p>
</li>
<li>
<p>(<code>D</code>) cualquier carácter que no este en el rango 0-9 ➎.</p>
</li>
<li>
<p>(<code>w</code>) cualquier carácter alfanumérico ➏ (a-z, A-Z o 0-9, por motivos fuera de mi comprension, los motores de las grandes ligas tambien incluien como alfanumerico, el caracter <code>_</code>, regexp3 no sigue este comportamiento).</p>
</li>
<li>
<p>(<code>W</code>) cualquier carácter no alfanumérico ➐.</p>
</li>
<li>
<p>(<code>s</code>) cualquier caracter que sea un espacio en blanco ➑.</p>
</li>
<li>
<p>(<code>S</code>) cualquier carácter que no sea un espacio en blanco ➒.</p>
</li>
</ul>
<p>Afortunadamente, la libreria <code>ctype</code> incluye funciones para evaluar estos casos. Lamentablemente el valor que retornan en caso de acierto es demasiado ambiguo, segun se lee en el manual</p>
<blockquote>
<p>Los valores devueltos son no-cero si el carácter cae dentro de la clase pedida, y cero si no.</p>
</blockquote>
<p>Es decir, exepto cuando el caracter no cae dentro de la clasificacion, nos puede regresar el valor que le venga en gana. Haran uso de un generador de numeros aleatorios y luego una verificacion de que el valor no sea cero para cumplir la especificacion? Ni idea. La solucion mas sencilla es aplicar una evaluacion booleana al retorno.</p>
<p>Los casos no definidos (<code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, ..., etc.), se tratan como simples caracteres ➓.</p>
<p>Por cierto, esta funcion (como el resto de las tipo <code>match</code>) regresa la cantidad de caracteres que coinciden, es decir, nos permite implementar metacaracteres que comparen mas de un caracter, podrian ser dos, tres o de la longitud que se nos ocurra, incluso si lo gestionamos bien, expresiones regulares!</p>
<p>Regresando a <code>match</code>, el caso <code>SET</code> para los constructores conjunto ➌, es de lejos el mas complejo. La expresion que almacena aun sigue sin procesar, sumado a esto, posee un modificador que no tiene ningun otro constructor, <em>la negacion</em>.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">matchSet</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>               <span class="c1">// ➊
</span><span class="c1"></span>  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span><span class="p">;</span>        <span class="c1">// ➋
</span><span class="c1"></span>
  <span class="k">if</span><span class="p">(</span> <span class="n">reverse</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>                 <span class="c1">// ➌
</span><span class="c1"></span>
  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>                 <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>               <span class="c1">// ➎
</span><span class="c1"></span>    <span class="k">default</span><span class="o">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">strnchr</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">],</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span>  <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➏
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span> <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">result</span><span class="p">;</span>    <span class="c1">// ➐
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">TRUE</span> <span class="p">:</span> <span class="n">FALSE</span><span class="p">;</span>                     <span class="c1">// ➑
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>Es interesante desde el argumento. Al igual que <code>walker</code> opera con una copia de la estructura <code>RE</code> ➊. Necesitamos optener los componentes de la exprecion, no obstante estos se descartan de la expresion original a medida que se optinen ➍. Si manejaramos un puntero en lugar de una copia y el constructor requiriera mas de un ciclo de repeticion, para el segundo ciclo la exprecion origen, estaria imcompleta o vacia y el resultado seria incorrecto.</p>
<p>Ya que es valido que existan metacaracteres dentro de los conjuntos y el numero de caracteres con el que pueden coincider es arbitrario, necesitamos almacenar el resultado, ademas debemos activar el modificador de negacion (<code>reverse</code>) si el primer caracter del conjunto es el signo <code>^</code> ➋ y descartarlo de la expresion avanzando un caracter ➌.</p>
<p>Una vez que tenemos los constructores, hace falta verificar uno a uno, hasta optener una coincidencia o terminal el bucle <code>while</code>.</p>
<p>Si terminamos el bucle <code>while</code> sin ninguna coincidencia se devuelve <code>FALSE</code> a menos que <code>reverse</code> este activo, en ese caso devolvemos <code>TRUE</code> ➑.</p>
<p>Si hay una coincidencia devolvemos <code>TRUE</code> a menos que <code>reverse</code> este activo, en ese caso devolvemos <code>FALSE</code> ➐.</p>
<p>La evalucion de cada componente depende de su tipo... alucinantes recursiones, echamos mano de <code>match</code> ➎ al examinar rangos, metacaracteres y <em>punto</em>? (ha, por que no?).</p>
<p>Las secuencias de caracteres requieren un trato especial. Debe compararse caracter a caracter de la secuencia, contra el caracter de la posicion actual en cadena. Dos opciones surgen, un <code>for</code> o invocar de entre los muertos a una funcion antes descartada <code>strnchr</code>! ➏</p>
<p>(!#&amp;)┘? utilizar <em>tracker</em> para optener (casi) todos los constructores, no hace necesario aplicar escapes a cada signo relevante en los conjuntos... alto, no, no solo eso, tambien proboca que existan rangos fuera de las agrupaciones, wtf?</p>
<p>♨(⋆‿⋆)♨ je, es una <q>caracteristica</q> o un inconveniente de facil solucion. Solo hay que eliminar el reconocimiento de rangos de <code>tracker</code> e implementar un <code>tracker</code> especifico para los conjuntos.</p>
<p>(っ◕‿◕)っ (づ｡◕‿‿◕｡)づ (ノಠ益ಠ)ノ (ノ・∀・)ノ (Todos: ¡Felicidades (Shinji)!)</p>
<p>Ya esta listo nuestro motor regexp 100% funcional (con caracteristicas especiales incluidas)</p>
<p>Algunas pruebas (ya sabes, al final del ultimo <code>NTEST</code> dentro de <span class="file" >test.c</span>):</p>
<pre class="code" ><code class="chroma" ><span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; &#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:A+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:d+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:D+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:w+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:W+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:s+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34; </span><span class="se">\n\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:S+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;(((&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:(&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;)))&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:)&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;&lt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:&lt;&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&gt;&gt;&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;:::&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;::&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;|||&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:|&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;###&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:#&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;:#()|&lt;&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:::#:(:):|:&lt;:&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;:#()|&lt;&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(::|:#|:(|:)|:||:&lt;|:&gt;)&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;(test1)(test2)&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;:(test:d:)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;.&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;...&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;...&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.aa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa.&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.t&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.z&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a.&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34; .&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z.&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.{1}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.?&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.{1}&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a.?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a.+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a.*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a.{1}&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|.&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|.?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|.+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|.*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|.)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|.?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|.+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|.*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.?|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.+|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.*|a)&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.?)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.+)|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.*)|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.)?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.)+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(.)*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.)?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.)+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.)*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;.&#34;</span> <span class="p">,</span> <span class="mi">40</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a.)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.a)&#34;</span> <span class="p">,</span> <span class="mi">19</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(:a.)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.:a)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(.{5}:a{5})&#34;</span> <span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;a-z&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Z&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Z&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;0-9&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;0-9&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;0-9&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-za-za-z&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a bcd efg&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a bcd efg&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-za-za-z&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a baa eaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-zaa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aad aag&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa-z&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Za&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-zt&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-zz&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa-z&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34; A-Z&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;za-z&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z{1}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a bcd efg&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z?&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a bcd efg&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z+&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a bcd efg&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z*&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a bcd efg&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z{1}&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa-z?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa-z+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa-z*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa-z{1}&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|a-z&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|a-z?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|a-z+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|a-z*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a-z*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|a-z)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|a-z?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|a-z+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|a-z*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z?|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z+|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z*|a)&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z?)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z+)|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z*)|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z)?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z)+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|(a-z)*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z)?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z)+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z)*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2a3a4a5a6a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;1-6a&#34;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2a3a4a5a6a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;1-3a&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2b3c4d5e6f&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;1-6a-z&#34;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2b3c4d5e6f&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;1-3a-z&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(aa-z)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-za)&#34;</span> <span class="p">,</span> <span class="mi">19</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(:aa-z)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z:a)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a-z{5}:a{5})&#34;</span> <span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;[a]&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[.]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[.]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[1]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:a]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:D]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z][a-z][a-z]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[ a-z]&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z][a-z][a-z]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]aa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa[a-z]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:w]a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:w]t&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]z&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[a-z]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34; [A-Z]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z[a-z]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]{1}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]?&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]+&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]*&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a-z]{1}&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[a-z]?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[a-z]+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[a-z]*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[a-z]{1}&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[aeiou]&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[aeiou]?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[aeiou]+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[aeiou]*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[aeiou]|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[aeiou]?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[aeiou]+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[aeiou]*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[aeiou])&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[aeiou]?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[aeiou]+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[aeiou]*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]?|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]+|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]*|a)&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou])&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou]?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou]+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou]*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou])|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]?)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]+)|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou]*)|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou])&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou])?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou])+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([aeiou])*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou])|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou])?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou])+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([aeiou])*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2a3a4a5a6a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[1-6]a&#34;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2a3a4a5a6a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[1-3]a&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2b3c4d5e6f&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[123456][abcdef]&#34;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2b3c4d5e6f&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[123][abcdef]&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:.]&#34;</span><span class="p">,</span>  <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:.b]&#34;</span><span class="p">,</span>  <span class="mi">40</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a[ab])&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([ab]a)&#34;</span> <span class="p">,</span> <span class="mi">19</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(:a[ab])&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([ab]:a)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([ab]{5}:a{5})&#34;</span> <span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;()&lt;&gt;[]{}*?+&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[:(:):&lt;:&gt;:[:]:{:}:*:?:+]&#34;</span><span class="p">,</span> <span class="mi">11</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;)&gt;}&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[)&gt;}]&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;[^a]&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^1]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^a]&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^a]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^1]&#34;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^A]&#34;</span><span class="p">,</span>  <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:a]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:A]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^z]&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^z][^z][^z]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ a]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:d]&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:d:s]&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:d:s][^:d:s][^:d:s]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:d:s]aa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa[^:d:s]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:d:s]a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^A-Z]t&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:s]z&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[^ ]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34; [^t]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z[^a]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^z]?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^z]+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^z]*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^z]{1}&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]?&#34;</span><span class="p">,</span> <span class="mi">9</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]+&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]*&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]{1}&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[^ ]?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[^ ]+&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[^ ]*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a[^ ]{1}&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[^ ]&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[^ ]?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[^ ]+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|[^ ]*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^ ]*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[^ ])&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[^ ]?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[^ ]+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|[^ ]*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]?|a)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]+|a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]*|a)&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ])&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ]?)&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ]+)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ]*)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ])|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]?)|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]+)|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ]*)|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ])&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ])?&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ])+&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a|([^ ])*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ])|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ])?|a&#34;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ])+|a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aeiou&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^ ])*|a&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2a3a4a5a6a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:a]a&#34;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2a3a4a5a6a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^4-6]a&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2b3c4d5e6f&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:a][^:d]&#34;</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1a2b3c4d5e6f&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^4-6][^:d]&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a[^a])&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^a]a)&#34;</span> <span class="p">,</span> <span class="mi">19</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(:a[^a])&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^b]:a)&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;([^x]{5}:a{5})&#34;</span> <span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;()&lt;&gt;[]{}*?+&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[^:w]&#34;</span><span class="p">,</span> <span class="mi">11</span> <span class="p">);</span>
</code></pre>
</div>
<h4 id="mods" >mods</h4>
<div class="hBody-4" >
<p>Esta prehistorica creacion ya puede conseguir presas por su cuenta, aun asi requiere un poco mas de entrenamiento antes de ascender a las grades ligas de los motores RegExp.</p>
<p>La kata de esta seccion nos trasmite una tecnica prohibida en los dojos regexp mas ortodoxos, el <em>agua control</em>, la habilidad de adaptarse facilmente a distintas situaciones.</p>
<p>Nuestro motor contabiliza todas las coincidencias de la regexp, pero, y si:</p>
<ul>
<li>
<p>quisieramos detener la busqueda tras la primer coincidencia,</p>
</li>
<li>
<p>o indicar que la coincidencia debe aparecer al final de la cadena,</p>
</li>
<li>
<p>o al inicio,</p>
</li>
<li>
<p>o modificar el comportamiento de un constructor,</p>
</li>
<li>
<p>o de la expresion entera,</p>
</li>
<li>
<p>o cualquer otra situacion extravagante y arbitraria?</p>
</li>
</ul>
<p>Habitualmente los motores regexeros ofrecen las siguentes soluciones a este dilema:</p>
<ol class="num" >
<li>
<p>utilizar funciones especializadas</p>
</li>
<li>
<p>extender la sintaxis</p>
</li>
<li>
<p>agregar parametros en la funcion principal</p>
</li>
<li>
<p>o una combinacion con todas las anteriores</p>
</li>
</ol>
<p>De estas, la solucion que mas se utiliza es <em>extender la sintaxis</em>. Supongo, es lo mas sencillo y facil de mantener. Particularmente se aplica a tres casos concretos:</p>
<ul>
<li>
<p>Si el primer signo de la expresion es <code>^</code>, se indica al motor que la busqueda ha de realizarse solo en la primer posicion de la cadena</p>
</li>
<li>
<p>Si el ultimo signo de la expresion es <code>$</code>, se indica al motor que la coincidencia debe <q>emparejarse</q> con el final de la cadena.</p>
</li>
<li>
<p>Si la cadena inicia con <code>^</code> y termina con <code>$</code> se le indica al motor que realice una busqueda solo en la primer posicion de la cadena y que la coincidencia debe abarcar toda la cadena</p>
</li>
</ul>
<p>Extender la sintaxis en nuestro codigo para dar soporte a los signos <code>^</code> y <code>$</code> apenas y requiere una ligera modifacacion en <code>regexp3</code></p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">atTheEnd</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>                     <span class="c1">// ➊
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">loops</span>    <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>             <span class="c1">// ➋
</span><span class="c1"></span>  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">loops</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;$&#39;</span> <span class="p">){</span>    <span class="c1">// ➌
</span><span class="c1"></span>    <span class="n">atTheEnd</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">rexp</span><span class="p">.</span><span class="n">len</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span> <span class="p">){</span>                   <span class="c1">// ➍
</span><span class="c1"></span>    <span class="n">fwrTrack</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="n">loops</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                              <span class="c1">// ➎
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span>
    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>           <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>                                        <span class="c1">// ➏
</span><span class="c1"></span>      <span class="k">if</span><span class="p">(</span> <span class="n">atTheEnd</span> <span class="p">){</span> <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">// ➐
</span><span class="c1"></span>      <span class="k">else</span> <span class="p">{</span>                                                     <span class="c1">// ➑
</span><span class="c1"></span>        <span class="n">result</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Los cambios son sencillos. Para realizar la busqueda en la primer posicion de la cadena (signo <code>^</code> ➍) solo debemos limitar el ciclo de repeticiones a una sola iteraccion ➎. De lo contrario el numero de iteracciones es igual a la longitud de la cadena ➋.</p>
<p>Si debemos verificar que la coincidencia este al final de la cadena (signo <code>$</code> ➌), y ya que la cantidad de caracteres que forman el patron es desconocido realizamos todas las comprobaciones atraves de la cadena, hasta encontrar una coincidencia ➏. Si la longitud de la coincidencia (<code>text.pos</code>) es igual al tamaño (relativo) de la cadena (<code>text.len</code>) tenemos una coincidencia al final de la cadena ➐. En este caso echamos mano de una nueva variable con nombre <code>atTheEnd</code>, si esta encendida caeremos siempre en este caso ➐, de lo contrario, se lleva a cabo el conteo de coincidencias ➑</p>
<p>... y el caso con los dos signos <code>^</code> y <code>$</code>? ¡¡¡ho my glob ꒰--■_■-꒱!!! la solucion se presenta por si sola, solo hay un ciclo (<code>loops == 1</code>) y debe abarcar toda la cadena.</p>
<p>Para probar la eficacia del nuevo cambio intentemos con estas pruebas</p>
<pre class="code" ><code class="chroma" ><span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;^Raptor&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor$&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Test$&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;^Test&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;^Raptor Test$&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
</code></pre>
<p>Ahora bien, como agregar nuevos modificadores? con nuevos signos especiales? con una varible adicional? unimos todos los modificadores en una mascara de bits? con mas <code>if</code>s?</p>
<p>٩꒰･ัεั･꒱۶ si agregaramos nuevos signos a los extremos tendriamos que establecer un orden de evaluacion mas elaborado. Por otra parte el metodo de la varible adicional, nos obligaria a establecer valores adicionales en la llamada, aunque su uso fuese anecdotico. Algo similar ocurre si agrupamos las modificaciones en una varible extra en forma de mascara de bits, con el engorroso inconveniente de tener que recordar nombres de constantes (por lo general extensos).</p>
<p>En cualquier caso estos modificadores operan de forma <em>global</em>, es decir, afectan el comportamiento de toda la expresion. Si quisieramos implementar modificadores a nivel de constructor (como la busqueda inversa en los conjuntos) tendriamos un inconveniente adicional.</p>
<p>Varios motores utilizan la siguiente sintaxis</p>
<ul>
<li>
<p>c[(?i)] hace que la regexp ignore entre minusculas y mayusculas.</p>
</li>
<li>
<p>c[(?c)] hace que la regexp distinga entre mayusculas y minusculas</p>
</li>
<li>
<p>c[(?:)] no capturar coincidencia</p>
</li>
<li>
<p>c[(?s)] <q>modo de una sola linea</q>. Hace que punto coincida con todos los caracteres, incluido el salto de linea.</p>
</li>
</ul>
<p>Estas y otras <q>opciones de busqueda</q> pueden aplicarse a toda la regexp o a parte de ella. No es imposible incorporarla al raptor, pero seria complicado y roperia el flujo de ejecucion!</p>
<p>El raptor no teme romper tabus, menos si estan relacionadas con la sintaxis, con tal de mantener el codigo lo mas sencillo posible, vamos a implementar este esquema:</p>
<div class="example-block" >
<pre class="example" >constructor-cuantificador-modificador
</pre>
</div>
<p>con esto podemos modificar el comportamiento de los constructores de forma individual, los modificadores se especifican luego de los cuantificadores (si lo hacemos bien podemos unificar cuantificadores y modificadores en una sola sintaxis, claro... si lo hacemos bien).</p>
<p>Para indicar modificadores que afecten de forma global tendremos este esquema:</p>
<div class="example-block" >
<pre class="example" >modificador-regexp
</pre>
</div>
<p>el decir el modificador precede a la expresion.</p>
<p>Ambos, modificador local, como global seguiran la misma sintaxis: El signo <code>#</code> le indicar al motor la presencia de una secuencia de uno o mas signos con significado especial <q>los modificadores</q>. La cadena de modificadores termina cuando aparece el primer signo no establecido como modificador:</p>
<div class="art-block" >
<pre class="art" >#mod_1-mod_2-...-mod_nCualquierConstructor
▲
│&lt; modificadores &gt;
└─ signo de modificador
</pre>
</div>
<p>Si queremos aplicar los modificadores <code>^</code> + <code>$</code> la exprecion seria</p>
<div class="example-block" >
<pre class="example" >#^$regexp
</pre>
</div>
<p>para aplicar modificadores a un constructor</p>
<div class="example-block" >
<pre class="example" >[conjunto]*#MODS(agrupacion)#MODS
</pre>
</div>
<p>vamos con el codigo</p>
<pre class="code" ><code class="chroma" ><span class="cp">#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define TRUE                 1
</span><span class="cp">#define FALSE                0
</span><span class="cp">#define INF         1073741824 </span><span class="c1">// 2^30
</span><span class="c1"></span>
<span class="cp">#define MOD_ALPHA            1
</span><span class="cp">#define MOD_OMEGA            2
</span><span class="cp">#define MOD_LONLEY           4
</span><span class="cp">#define MOD_FwrByChar        8
</span><span class="cp">#define MOD_COMMUNISM       16
</span><span class="cp"></span>
<span class="k">struct</span> <span class="n">TEXT</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">pos</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="k">static</span> <span class="n">text</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">TYPE</span> <span class="p">{</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">HOOK</span><span class="p">,</span> <span class="n">BACKREF</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">RANGEAB</span><span class="p">,</span> <span class="n">META</span><span class="p">,</span> <span class="n">POINT</span><span class="p">,</span> <span class="n">SIMPLE</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">RE</span> <span class="p">{</span>
  <span class="kt">char</span>          <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>            <span class="n">len</span><span class="p">;</span>
  <span class="k">enum</span>     <span class="n">TYPE</span>  <span class="n">type</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">mods</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">loopsMin</span><span class="p">,</span> <span class="n">loopsMax</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walker</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trekking</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">looper</span>     <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">tracker</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getMods</span>    <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">match</span>      <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchSet</span>   <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span>  <span class="n">rexp</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchRange</span> <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span>   <span class="n">chr</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchMeta</span>  <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span>   <span class="n">chr</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">matchText</span>  <span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span> <span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walkMeta</span>       <span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">walkSet</span>        <span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="nf">countCharDigits</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">getMods</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rexp</span> <span class="p">);</span>

  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">txtLen</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_ALPHA</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span>
    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>    <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">txtLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>
      <span class="k">if</span>     <span class="p">(</span>  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_OMEGA</span>    <span class="p">){</span> <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span>  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_LONLEY</span>   <span class="p">)</span>                             <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_FwrByChar</span><span class="p">)</span> <span class="o">||</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>          <span class="n">result</span><span class="o">++</span><span class="p">;</span>
      <span class="k">else</span>   <span class="p">{</span>  <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>                                    <span class="n">result</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">oPos</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span> <span class="n">trackByType</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span><span class="p">,</span> <span class="n">PATH</span> <span class="p">);</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">oPos</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trekking</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">looper</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">looper</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">HOOK</span><span class="p">:</span> <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span> <span class="k">case</span> <span class="nl">PATH</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span><span class="p">:</span> <span class="k">case</span> <span class="nl">BACKREF</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span> <span class="k">case</span> <span class="nl">SIMPLE</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">forward</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">))</span> <span class="p">){</span>
      <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">forward</span><span class="p">;</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">trackByType</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="o">*</span><span class="n">track</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cut</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="n">walkMeta</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span> <span class="p">))</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;)&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&gt;&#39;</span><span class="o">:</span> <span class="n">deep</span><span class="o">--</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">walkSet</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">HOOK</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">GROUP</span>   <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">SET</span>     <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span>              <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">PATH</span>    <span class="p">:</span> <span class="n">cut</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;|&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">cut</span> <span class="p">){</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>  <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">PATH</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">META</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">POINT</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">SET</span>   <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span>
        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">goto</span> <span class="n">getLM</span><span class="p">;</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;#&#39;</span><span class="o">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">){</span>
          <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span> <span class="p">)</span> <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">RANGEAB</span> <span class="p">);</span>
          <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="k">goto</span> <span class="n">getLM</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
  <span class="p">}</span>

 <span class="nl">getLM</span><span class="p">:</span>
  <span class="n">getLoops</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="n">getMods</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">trackByLen</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span> <span class="p">){</span>
  <span class="o">*</span><span class="n">track</span>       <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">type</span>  <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">len</span>   <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">len</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">fwrRexp</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walkSet</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+=</span> <span class="n">walkMeta</span><span class="p">(</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span> <span class="p">))</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;]&#39;</span> <span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">walkMeta</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span> <span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getMods</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">inMods</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;#&#39;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">inMods</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="o">++</span><span class="n">pos</span> <span class="p">]</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_ALPHA</span>     <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;$&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_OMEGA</span>     <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_LONLEY</span>    <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;~&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_FwrByChar</span> <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_COMMUNISM</span> <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;/&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MOD_COMMUNISM</span> <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span> <span class="n">inMods</span>       <span class="o">=</span>  <span class="n">FALSE</span>         <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">pos</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">getLoops</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>
    <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span>   <span class="mi">1</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span> <span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span> <span class="o">:</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>
      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;,&#39;</span> <span class="p">){</span>
        <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;}&#39;</span> <span class="p">)</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">);</span>
          <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span>  <span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">=</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">loopsMin</span><span class="p">;</span>

      <span class="n">fwrRexp</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">countCharDigits</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">digits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">digits</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">isdigit</span><span class="p">(</span> <span class="o">*</span><span class="n">str</span><span class="o">++</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">digits</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">match</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">POINT</span>  <span class="p">:</span> <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span>    <span class="p">:</span> <span class="k">return</span> <span class="n">matchSet</span>  <span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">);</span>
  <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">return</span> <span class="n">matchRange</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">]</span>  <span class="p">);</span>
  <span class="k">case</span> <span class="nl">META</span>   <span class="p">:</span> <span class="k">return</span> <span class="n">matchMeta</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">]</span>  <span class="p">);</span>
  <span class="k">default</span>     <span class="o">:</span> <span class="k">return</span> <span class="n">matchText</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">strnChr</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">];</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">==</span> <span class="n">chr</span> <span class="p">)</span> <span class="k">return</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cmpChrCommunist</span><span class="p">(</span> <span class="kt">char</span> <span class="n">a</span><span class="p">,</span> <span class="kt">char</span> <span class="n">b</span><span class="p">){</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">strnChrCommunist</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span> <span class="n">i</span> <span class="p">];</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">cmpChrCommunist</span><span class="p">(</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">chr</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">str</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">strnCmpCommunist</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">){</span>
  <span class="k">for</span><span class="p">(</span> <span class="p">;</span> <span class="n">cmpChrCommunist</span><span class="p">(</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span> <span class="p">);</span> <span class="n">s</span><span class="o">++</span><span class="p">,</span> <span class="n">t</span><span class="o">++</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;\0&#39;</span> <span class="o">||</span> <span class="o">--</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="o">*</span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchText</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_COMMUNISM</span> <span class="p">)</span>
    <span class="k">return</span>    <span class="n">strnCmpCommunist</span><span class="p">(</span> <span class="n">txt</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">return</span> <span class="n">strncmp</span>         <span class="p">(</span> <span class="n">txt</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchRange</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_COMMUNISM</span> <span class="p">){</span>
    <span class="n">chr</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span> <span class="n">chr</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">chr</span> <span class="o">&gt;=</span> <span class="n">tolower</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">chr</span> <span class="o">&lt;=</span> <span class="n">tolower</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span>
    <span class="k">return</span> <span class="n">chr</span> <span class="o">&gt;=</span>          <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span>   <span class="o">&amp;&amp;</span> <span class="n">chr</span> <span class="o">&lt;=</span>          <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">2</span> <span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchMeta</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span> <span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;a&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalpha</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;A&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalpha</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;d&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isdigit</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;D&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isdigit</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;w&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalnum</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;W&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isalnum</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;s&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isspace</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;S&#39;</span> <span class="o">:</span> <span class="k">return</span> <span class="n">isspace</span><span class="p">(</span> <span class="n">chr</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">default</span>  <span class="o">:</span> <span class="k">return</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">chr</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">matchSet</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">reverse</span> <span class="p">)</span> <span class="n">fwrRexp</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_COMMUNISM</span> <span class="p">)</span>
           <span class="n">result</span> <span class="o">=</span> <span class="n">strnChrCommunist</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">],</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span>  <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">else</span> <span class="n">result</span> <span class="o">=</span> <span class="n">strnChr</span>         <span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">],</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span>  <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span> <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">TRUE</span> <span class="p">:</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>ahora todo constructor puede contener modificadores, por tanto, se agrego una nueva varible a la estructura <code>RE</code>:</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mods</span><span class="p">;</span>
</code></pre>
<p>Ya que en esencia un modificador no deja de ser una simple <q>bandera</q>, para economizar almacenamiento utilizaremos <code>mods</code> como una mascara de bits. Esto obliga a declarar la variable como tipo <code>unsigned</code>.</p>
<p>Al declarar <code>mods</code> como <code>char</code> nos proporciona ocho bits, es decir, disponemos de 8 modificaciones, pero de momento solo vamos a utilizar 5.</p>
<p>Para activar o desactivar cada bit de forma independiente, necesitamos conocer el valor que representa la posicion del bit a modificar. Esto se logra elevando 2 a la posicion del bit. Asi el primer bit es <span class="math" >2^0 = 1</span>, el segundo <span class="math" >2^1 = 2</span>, el tercero <span class="math" >2^2 = 4</span> y asi sucesivamente.</p>
<p>Recordar la posicion de cada modificador, no es lo mas conveniete, en su lugar utilizamos constantes de preprocesador:</p>
<pre class="code" ><code class="chroma" ><span class="cp">#define MOD_ALPHA            1
</span><span class="cp">#define MOD_OMEGA            2
</span><span class="cp">#define MOD_LONLEY           4
</span><span class="cp">#define MOD_FwrByChar        8
</span><span class="cp">#define MOD_COMMUNISM       16
</span><span class="cp"></span></code></pre>
<p><code>MOD_ALPHA</code>, signo <code>^</code> sera el modificador <q>busca al inicio</q>.</p>
<p><code>MOD_OMEGA</code>, signo <code>$</code> sera el modificador <q>busca al final</q>.</p>
<p><code>MOD_LONLEY</code>, signo <code>?</code> sera el modificador <q>detener con la primer coincidencia</q>.</p>
<p><code>MOD_FwrByChar</code>, signo <code>~</code> sera el modificador <q>busca caracter a caracter. Si hay una coincidencia no continues al final de esta, prueba con el caracter imediatamente despues del que utilizaste para este ciclo</q>.</p>
<p><code>MOD_COMMUNISM</code>, signo <code>*</code> sera el modificador <q>ignora entre mayusculas y minusculas</q>.</p>
<p>finalmente signo <code>/</code>, apaga el bit <code>MOD_COMMUNISM</code> para decir <q>no ignores entre mayusculas y minusculas</q>, que es el comportamiento por defecto. Tenemos 6 modificadores por el precio de 5!</p>
<p>si los signos que he eligido no son de tu agrado, se pueden modificar sin despeinarse en la funcion <code>getMods</code>. Como su nombre indica, optiene los modificadores... y los asigna a un constructor:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">void</span> <span class="nf">getMods</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">inMods</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;#&#39;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>             <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="k">while</span><span class="p">(</span> <span class="n">inMods</span> <span class="p">)</span>                                      <span class="c1">// ➋
</span><span class="c1"></span>    <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="o">++</span><span class="n">pos</span> <span class="p">]</span> <span class="p">){</span>                      <span class="c1">// ➌
</span><span class="c1"></span>    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_ALPHA</span>     <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;$&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_OMEGA</span>     <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_LONLEY</span>    <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;~&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_FwrByChar</span> <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">|=</span>  <span class="n">MOD_COMMUNISM</span> <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;/&#39;</span><span class="o">:</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MOD_COMMUNISM</span> <span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span> <span class="n">inMods</span>       <span class="o">=</span>  <span class="n">FALSE</span>         <span class="p">;</span> <span class="k">break</span><span class="p">;</span>   <span class="c1">// ➍
</span><span class="c1"></span>    <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">fwrTrack</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">pos</span> <span class="p">);</span>                 <span class="c1">// ➎
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>El funcionamiento se basa en el mismo principio que <code>getLoops</code>, lo que significa que si el constructor posee algun modificador, deberia encontrarse en la posicion inicial de <code>rexp</code> ➊. De ser asi, recorremos y asignamos los valores en la cadena de modificadores ➋➌ hasta que el signo en cuestion no se identifique como un modificador ➍. Una vez que optenemos la informacion, la cadena de mods se descarta ➎.</p>
<p>Por cierto, antes de modificar o agregar nuevos mods, considera la sintaxis actual, mal negocio seria agregar los signos <code>|</code>, <code>(</code>, <code>)</code>, ..., etc.</p>
<p>Como hacemos para otener los mods de los constructores? (¬‿¬) je, recuerdas que vamos a colocar los modificadores despues de los cuantificadores? (pista: en que funcion esta <code>getLoops</code>?)</p>
<pre class="code" ><code class="chroma" > <span class="k">static</span> <span class="kt">int</span> <span class="nf">tracker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">track</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="p">){</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">META</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span> <span class="n">trackByLen</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">POINT</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">GROUP</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">HOOK</span>  <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="n">trackByType</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span>    <span class="n">SET</span>   <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span> <span class="o">:</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="p">){</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;(&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;&lt;&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;[&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;:&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;.&#39;</span><span class="o">:</span>
        <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span> <span class="k">goto</span> <span class="n">getLM</span><span class="p">;</span>
      <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;?&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;+&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;*&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;{&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="sa"></span><span class="sc">&#39;#&#39;</span><span class="o">:</span> <span class="c1">// ➊
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">){</span>
          <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;-&#39;</span> <span class="p">)</span> <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">RANGEAB</span> <span class="p">);</span>
          <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span>                      <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
        <span class="k">goto</span> <span class="n">getLM</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="n">trackByLen</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">SIMPLE</span>  <span class="p">);</span>
  <span class="p">}</span>

 <span class="nl">getLM</span><span class="p">:</span> <span class="c1">// ➋
</span><span class="c1"></span>  <span class="n">getLoops</span><span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="n">getMods</span> <span class="p">(</span> <span class="n">rexp</span><span class="p">,</span> <span class="n">track</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Exacto! agregamos <code>getMods</code> ➋ inmediatamente despues de <code>getLoops</code>, el resto solo es colocar un nuevo signo en los casos de <q>corte</q> ➊➋. Vuala! cada constructor cargara sus mods! o no... Mira bien el comportamiento de las dos funciones <code>get</code>, toma tu tiempo.</p>
<p>Notas la diferencia? <code>getLoops</code> siempre establece valores por defecto. Por su parte <code>getMods</code> se limita a modificar los valores que indiquemos, y como todos los constructores inician como copias de un constructor <em>de orden superior</em> (el primero en <code>regexp3</code>) no puede significar otra cosa mas que los modificadores se heredan. Si establecemos algun modificador en el constructor primigenio sera transmitido a todos sus descendientes.</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="c1">// ➊
</span><span class="c1"></span>  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">getMods</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rexp</span> <span class="p">);</span>  <span class="c1">// ➋
</span><span class="c1"></span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">txtLen</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_ALPHA</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span>  <span class="c1">// ➌
</span><span class="c1"></span>    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>    <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">txtLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>
      <span class="k">if</span>     <span class="p">(</span>  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_OMEGA</span>    <span class="p">){</span> <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">// ➍
</span><span class="c1"></span>      <span class="k">else</span> <span class="k">if</span><span class="p">(</span>  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_LONLEY</span>   <span class="p">)</span>                             <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>    <span class="c1">// ➎
</span><span class="c1"></span>      <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_FwrByChar</span><span class="p">)</span> <span class="o">||</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>          <span class="n">result</span><span class="o">++</span><span class="p">;</span>       <span class="c1">// ➏
</span><span class="c1"></span>      <span class="k">else</span>   <span class="p">{</span>  <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>                                    <span class="n">result</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>     <span class="c1">// ➐
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>El constructor fundamental, inicia con ningun modifidor ➊. Los modificadores que en este sean establecidos ➋, tendran un alcance global, claro, siempre y cuando tengamos codigo para una tarea especifica, por ejemplo, podemos aplicar los modificadores <code>^</code> o <code>$</code> o <code>?</code> o <code>~</code> al primer constructor y luego ignorarlos en todos sus descendientes, al fin y al cabo, solo nos importan para modificar el comportamiento del ciclo por la cadena ➌.</p>
<p>Veamos a detalle las alteraciones principales:</p>
<p>Si tenemos el bit <code>MOD_ALPHA</code> encendido, aplicamos solo un ciclo (primera posicion de la cadena) ➌.</p>
<p>Si hay una coincidencia y el bit <code>MOD_OMEGA</code> esta encendido comprobamos que la coincidencia abarque el resto de la cadena, si es asi tenemos la coincidencia que buscamos ➍.</p>
<p>Si la coincidencia ocurre con el bit <code>MOD_LONLEY</code> activo, detenemos la busqueda con la primer coincidencia ➎.</p>
<p>Si el bit activo es <code>MOD_FwrByChar</code> o la longitud de la captura es de 0 caracteres (que ocacionarian bucles infinitos), la busqueda continuara en la posicion siguiente ➏.</p>
<p>Si no hay ningun modificador, simplemente incrementamos el contador de coincidencias y la sigiente posicion del ciclo por la cadena estara al final de la coincidencia ➐.</p>
<p>Para terminar, tenemos un modificador que afecta el comportamiento de los constructores de formo individual, el <code>MOD_COMMUNISM</code>. Hace que los caracteres alfabeticos coincidan tanto con mayusculas como con minisculas. Cuando asignamos el mod de forma global se transmite a todos los constructores, por ello existe el <b>MOD CAPITALISTA</b>, su funcion es terminar con la igualdad, de hecho este es el comportamiento por defecto.</p>
<p>Naturalmente, dicho mod sera aplicado en las fuciones de busqueda</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">matchText</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_COMMUNISM</span> <span class="p">)</span>     <span class="c1">// ➊
</span><span class="c1"></span>    <span class="k">return</span>    <span class="n">strnCmpCommunist</span><span class="p">(</span> <span class="n">txt</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">return</span> <span class="n">strncmp</span>         <span class="p">(</span> <span class="n">txt</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="nl">len</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">matchRange</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chr</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_COMMUNISM</span> <span class="p">){</span>    <span class="c1">// ➋
</span><span class="c1"></span>    <span class="n">chr</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span> <span class="n">chr</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">chr</span> <span class="o">&gt;=</span> <span class="n">tolower</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">chr</span> <span class="o">&lt;=</span> <span class="n">tolower</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">2</span> <span class="p">]</span> <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span>
    <span class="k">return</span> <span class="n">chr</span> <span class="o">&gt;=</span>          <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span>   <span class="o">&amp;&amp;</span> <span class="n">chr</span> <span class="o">&lt;=</span>          <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">2</span> <span class="p">];</span>
<span class="p">}</span>
</code></pre>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">matchSet</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="o">*</span><span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;^&#39;</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">reverse</span> <span class="p">)</span> <span class="n">fwrTrack</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

  <span class="k">while</span><span class="p">(</span> <span class="n">tracker</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">type</span> <span class="p">){</span>
    <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_COMMUNISM</span> <span class="p">)</span> <span class="c1">// ➌
</span><span class="c1"></span>           <span class="n">result</span> <span class="o">=</span> <span class="n">strnChrCommunist</span><span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">],</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span>  <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">else</span> <span class="n">result</span> <span class="o">=</span> <span class="n">strnChr</span>         <span class="p">(</span> <span class="n">track</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">],</span> <span class="n">track</span><span class="p">.</span><span class="n">len</span>  <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span> <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">reverse</span> <span class="o">?</span> <span class="nl">TRUE</span> <span class="p">:</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Unicamente necesitamos conocer el estado del modificador ➊➋➌, luego, con ayuda de tres nuevas funciones (examinalas por tu cuenta) realizamos la busqueda segun sea el caso.</p>
<p>Como puedes apreciar, ahora los constructores de tipo <code>RANGEAB</code> tienen su propia funcion. Es demasido extensa como para permanecer en <code>match</code>. En cambio <code>matchMeta</code> no fue afectado, ninguno de los metacaracteres definidos requiere cambios.</p>
<p>Antes de concluir verificamos que las prubebas previas no presenten errores y agregamos una cuantas mas:</p>
<pre class="code" ><code class="chroma" ><span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^A&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^AB&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^ABC&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^(b|A)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^A(B|C)(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^(A(B|C))(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$C&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$BC&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$ABC&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$(b|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$A(B|C)(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$(A(B|C))(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$ABC&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$A(c|B)(b|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$A(B|C)(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$(A(B|C))(B|C)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^E&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^EB&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^EBC&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^(b|c)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^A(B|C)(B|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^(A(B|C))(B|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$E&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$BE&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$ABE&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$(b|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$A(B|C)(B|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$(A(B|C))(B|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$ABE&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$A(c|B)(b|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$A(B|C)(B|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;ABC&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^$(A(B|C))(B|E)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b?#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b*#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a#*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*?^$~b&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*?^$~b&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*?^$~b&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*?^$~b?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*?^$~b?&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*?^$~b?&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*?^$~b+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*?^$~b+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*?^$~b+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a+#*?^$~b*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a*#*?^$~b*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a?#*?^$~b*&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*A&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(A)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*[A]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*[a]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*A-Z&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Z#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A)#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*[A-Z]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A-Z]#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*A&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*a&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(A)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(a)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*[A]&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*[a]&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*A-Z&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Z#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A)#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*[A-Z]&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A-Z]#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a#*)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A#*)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A)#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*a|b&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*A|B&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(a|b)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(A|B)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a#*|b#*)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A#*|B#*)&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|b)#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A|B)#*&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;test&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;test#*&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;t#*est#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*test&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*tESt&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*(tESt)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;TesT&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(tESt)#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^aaa&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#$aaa&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?aaa&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~aaa&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^?aaa&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?^aaa&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?$aaa&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^?$aaa&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?$^aaa&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a aaa aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#^?$a aaa aaa&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~a&#34;</span><span class="p">,</span> <span class="mi">10</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~aa&#34;</span><span class="p">,</span> <span class="mi">7</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa aaaa aaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~aaa&#34;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?a+&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?a+&#34;</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaaaaaaaaaaaaaaaaaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~a+&#34;</span><span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abababababababababababababababababababab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~a+&#34;</span> <span class="p">,</span> <span class="mi">20</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;RapTor (tESt)#* fEST&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*rapTor (tESt) fEST&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(RapTor)#* (tESt)#* (fEST)#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;((Rap#*Tor)#* (t#*ESt)#* (fEST)#*)#*&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*a-z#*apTor (tESt) A-Z#*EST&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a#/&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A#/&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/A&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/a&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/(A)&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/(a)&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/[A]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/[a]&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/A-Z&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Z#/&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)#/&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A)#/&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]#/&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]#/&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/[A-Z]&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A-Z]#/&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/A&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/a&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/(A)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/(a)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/[A]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/[a]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/A-Z&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;A-Z#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A)#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[a]#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A]#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/[A-Z]&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[A-Z]#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a#/)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A#/)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a)#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAaA&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A)#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/a|b&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/A|B&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/(a|b)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#/(A|B)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a#/|b#/)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A#/|B#/)&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(a|b)#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aAbB&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;(A|B)#/&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>

<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*rapTor (tESt)#/ fEST&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor tESt Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*rapTor (tESt)#/ fEST&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor TesT Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*rapTor (tE#/S#/t)#* fEST&#34;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">NTEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor tESt Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#*rapTor (tE#/S#/t)#* fEST&#34;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
</code></pre>
</div>
<h4 id="CATCH" ><code>CATCH</code></h4>
<div class="hBody-4" >
<p>Hace mucho, mucho, mucho codigo, casi al inicio del manual, se establecio la sintaxis <q><code>&lt;...&gt;</code></q> como una variante del constructor agrupacion, y supuestamente serviria para indicarle al motor que almacenara la seccion de la cadena que coincidiese con el patron de busqueda.</p>
<p>Ahora pues, el raptor es capaz de identificar dicha sistaxis, mas para hacerla funcional, necesario es sortear las siguientes dificultades:</p>
<ul>
<li>
<p>La &#34;dimencion&#34; de las capturas es desconocido</p>
</li>
<li>
<p>El numero de coincidencias... y capturas, tambien es desconocido</p>
</li>
</ul>
<p>( ︶︿︶) ... ... ... veamos... ... ... como en <code>RE</code> (la estructura que almacena las datos de la RegExp), la forma obvia de almacenar los datos para las capturas (siguiendo el <q>camido de C</q>) es tener variables relacionadas agrupadas en una estructura y asi manejar estas variables como una unidad.</p>
<p>Como hemos aprendido con <code>RE</code>, no hacemos copias de la cadena RegExp que representan a los constructores, pues, necesitariamos gestionar dichas copias (reservar el espacio, hacer la copia y liberar el espacio al terminar). En su lugar utilizamos un puntero a la posicion de inicio de la captura y un entero que registra su extension.</p>
<p>En cuanto al numero de capturas, la cantidad de estas es completamente imprevisible, excepto, si no las hay.</p>
<p>Con un manejo dinamico de memoria, tras terminar el uso del motor tendriamos que liberarla, algo asi</p>
<pre class="code" ><code class="chroma" ><span class="kt">void</span> <span class="nf">regexp3_freeData</span><span class="p">();</span>
</code></pre>
<p>cosa que no deseo hacer. Tambien podriamos pasar la responsabilidad al usuario y obligarlo que nos envie un arreglo y su capacidad</p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span><span class="p">,</span> <span class="k">struct</span> <span class="n">CATch</span> <span class="o">*</span><span class="n">Catch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">catches</span> <span class="p">);</span>
</code></pre>
<p>o podriamos separar la funcion, inicializando antes el motor, asi:</p>
<pre class="code" ><code class="chroma" ><span class="kt">void</span> <span class="n">regexp3_init</span><span class="p">(</span> <span class="k">struct</span> <span class="n">CATch</span> <span class="o">*</span><span class="n">Catch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">catches</span> <span class="p">)</span>
</code></pre>
<p>o poner un arreglo estatico, si, estatico! Por que no... un millon de capturas... sumando por cada una un puntero de 64 bits y un entero de 64 bits para la longitud (el indice viene gratis), serian 122 MiB.... ho, ho, ho, que en un equipo decente (&gt; 4GB) viene a ser calderilla. De momento pongamos 16 para empezar, si hay problemas pues ¯\_(ツ)_/¯</p>
<p>Sorprendentemente los cambios necesarios a aplicar al codigo, son minimos, asi que unicamente veremos dichas modificaciones. Intenta colocarlas de forma armoniosa. Puede que necesites agregar algunos prototipos de funcion, pero tambien puedes optar por colocar todo al inicio del codigo y ver si compila.</p>
<p>Iniciemos con la estructura para almacenar las capturas:</p>
<pre class="code" ><code class="chroma" ><span class="cp">#define MAX_CATCHS 16
</span><span class="cp"></span>
<span class="k">struct</span> <span class="n">CATch</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">[</span> <span class="n">MAX_CATCHS</span> <span class="p">];</span>
  <span class="kt">int</span>   <span class="n">len</span><span class="p">[</span> <span class="n">MAX_CATCHS</span> <span class="p">];</span>
  <span class="kt">int</span>   <span class="n">id</span> <span class="p">[</span> <span class="n">MAX_CATCHS</span> <span class="p">];</span>
  <span class="kt">int</span>   <span class="n">idx</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">index</span><span class="p">;</span>
<span class="p">}</span> <span class="k">static</span> <span class="n">Catch</span><span class="p">;</span>
</code></pre>
<p>He? no es lo que esperabas? En lugar de tener un arreglo de estructuras, la estructura contiene un arreglo de datos para cada captura:</p>
<ul>
<li>
<p><code>ptr</code>, apunta al inicio de la coincidencia en la cadena</p>
</li>
<li>
<p><code>len</code>, la dimencion de la coincidencia.</p>
</li>
<li>
<p><code>id</code>, no es el indice de la captura, en vez de eso representa la posicion donde aparece la captura con respecto a la regexp.</p>
<p>Si recibimos la llamada</p>
<pre class="code" ><code class="chroma" ><span class="n">regexp3</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;uno-dos-uno-dos-uno-dos-uno&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;uno&gt;&lt;dos&gt;&#34;</span> <span class="p">)</span>
</code></pre>
<p>El indice de capturas seria</p>
<div class="example-block" >
<pre class="example" >cadena    &#34;uno-dos-uno-dos-uno-dos-uno&#34;
captura    &lt;1&gt; &lt;2&gt; &lt;3&gt; &lt;4&gt; &lt;5&gt; &lt;6&gt; &lt;7&gt;
</pre>
</div>
<p>pero <em>el identificador</em> de la captura con respecto a la posicion en la regexp seria</p>
<div class="example-block" >
<pre class="example" >cadena    &#34;uno-dos-uno-dos-uno-dos-uno&#34;
captura    &lt;1&gt; &lt;2&gt; &lt;1&gt; &lt;2&gt; &lt;1&gt; &lt;2&gt; &lt;1&gt;
</pre>
</div>
<p>haremos uso de este valor para modificar todas las apariciones de una captura con repecto a su <code>id</code>. Ya veremos los detalles mas adelante.</p>
</li>
</ul>
<p>Utilizo <code>index</code> para que el motor sepa cual es la captura <q>actual</q>, ademas y en conjunto con la constante <code>MAX_CATCHS</code> evita ir mas alla de los limites del arreglo.</p>
<p><code>idx</code> es el indice <q>actual</q> con respecto a la posicion en cadena de cada captura, <em>para cada ciclo</em>. Esto quiere decir que en cada ciclo, el indice se coloca a 1 (indice a partir de 1) y cada vez que aparece una indicacion de captura <code>idx</code> se incrementa en 1. Por su puesto, si la captura falla, se restaura este valor, al valor de inicio.</p>
<p>Tanto <code>idx</code> como <code>index</code> perfectamente podrian estar fuera de la estructura incluso puede que sea mas adecuado:</p>
<pre class="code" ><code class="chroma" ><span class="cp">#define MAX_CATCHS 16
</span><span class="cp"></span>
<span class="k">struct</span> <span class="n">CATch</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">len</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">id</span> <span class="p">;</span>
<span class="p">}</span> <span class="k">static</span> <span class="n">Catch</span><span class="p">[</span> <span class="n">MAX_CATCHS</span> <span class="p">];</span>

<span class="kt">int</span> <span class="n">CatchIdx</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">CatchIndex</span><span class="p">;</span>
</code></pre>
<p>no obstante, mantener todo agrupado bajo un solo <q>nombre</q> por alguna extraña razon se ve mejor en (<s>mi cabeza</s>) el codigo. Puedes sumarlo al resto de filias en cuanto al estilo de codificacion que utilizo</p>
<ul>
<li>
<p>alinear <q>lo que se puede alinear</q></p>
</li>
<li>
<p>instrucciones sencillas (y no tanto) en una sola linea</p>
</li>
<li>
<p>la llave de inicio de cada funcion en la misma linea donde se define</p>
</li>
<li>
<p>espacios a derecha e izquierda de cada argumento</p>
</li>
<li>
<p>dos espacios de indentacion</p>
</li>
</ul>
<p>Regresando al tema, el siguiente cambio ocurre en <code>regexp3</code></p>
<pre class="code" ><code class="chroma" ><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">regexp3</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">re</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span>    <span class="n">rexp</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">text</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">txt</span> <span class="p">);</span>
  <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">txt</span><span class="p">;</span>                <span class="c1">// ➊
</span><span class="c1"></span>  <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>           <span class="c1">// ➋
</span><span class="c1"></span>  <span class="n">Catch</span><span class="p">.</span><span class="n">id</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                  <span class="c1">// ➌
</span><span class="c1"></span>  <span class="n">Catch</span><span class="p">.</span><span class="n">index</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                  <span class="c1">// ➍
</span><span class="c1"></span>  <span class="n">rexp</span><span class="p">.</span><span class="n">ptr</span>     <span class="o">=</span> <span class="n">re</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">PATH</span><span class="p">;</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">re</span> <span class="p">);</span>
  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rexp</span><span class="p">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">getMods</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rexp</span> <span class="p">);</span>

  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">forward</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_ALPHA</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">forward</span> <span class="p">){</span>
    <span class="n">forward</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">Catch</span><span class="p">.</span><span class="n">idx</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                  <span class="c1">// ➎
</span><span class="c1"></span>    <span class="n">text</span><span class="p">.</span><span class="n">pos</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="n">txt</span>          <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">text</span><span class="p">.</span><span class="n">len</span>   <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>   <span class="c1">// ➏
</span><span class="c1"></span>
    <span class="k">if</span><span class="p">(</span> <span class="n">walker</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">)</span> <span class="p">){</span>
      <span class="k">if</span>     <span class="p">(</span>  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_OMEGA</span>    <span class="p">){</span> <span class="k">if</span><span class="p">(</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span>  <span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_LONLEY</span>   <span class="p">)</span>                             <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">rexp</span><span class="p">.</span><span class="n">mods</span> <span class="o">&amp;</span> <span class="n">MOD_FwrByChar</span><span class="p">)</span> <span class="o">||</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>          <span class="n">result</span><span class="o">++</span><span class="p">;</span>
      <span class="k">else</span>   <span class="p">{</span>  <span class="n">forward</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>                                    <span class="n">result</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Con justa razon te preguntaras, ¿que hace este borracho iniciando la primer captura con los datos de la cadena (➊➋)? En efecto, no es necesario, desperdicio la primer posicion (0) para evitar hacer ajustes del estolio estilo <code>index - 1</code> cada vez que el usuario solicite una captura indexada apartir de 1 y no de 0. Visto de esa forma igual y tiene algun sentido. Oh, a la captura 0 tambien le asigno el identificador 0 ➌, para que el usuario no tenga acceso a esta captura. En consecuencia con lo anterior la primer captura disponible estara en la posicion uno ➍.</p>
<p>Ya en el ciclo de busqueda, como antes se explico, la posicion de cada captura con respecto a la regexp esta indicada por la variable <code>id</code>. Esta debe reiniciarse en cada ciclo ➎. La colocamos a uno para mentener la consintencia.</p>
<p>En la vercion anterior, interaccion a iteracion haciamos uso de <code>strlen</code> para establecer la longitud de la cadena; esto no solo es ineficiente, en cadenas de longitud considerable sera una fuente exagerada de lentitud. Ya que la captura cero almacena la longitud del texto, subtituimos <code>strlen</code> por el valor de esta ➏.</p>
<p>La existencia de las capturas acarrea un problema critico. Ahora el motor no solo debe recordar el punto de inicio con respecto a la cadena para cada ruta de ejecucion, tambien ha de recordar el indice de captura y el identificador.</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">walker</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="n">rexp</span> <span class="p">){</span>
  <span class="k">struct</span> <span class="n">RE</span> <span class="n">track</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">oPos</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">oCindex</span> <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">oCidx</span> <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">idx</span><span class="p">;</span> <span class="c1">// ➊
</span><span class="c1"></span>       <span class="n">trackByType</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">rexp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">track</span><span class="p">,</span> <span class="n">PATH</span> <span class="p">);</span>
       <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">oPos</span><span class="p">,</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">oCindex</span><span class="p">,</span> <span class="n">Catch</span><span class="p">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">oCidx</span> <span class="p">)</span>          <span class="c1">// ➋
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">trekking</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">track</span> <span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>easy, agregamos los nuevos puntos de control ➊ y son restablecemos en cada ciclo sin coincidencia ➋.</p>
<p>Establecer el inicio y el final de la captura es quiza lo mas complicado, el motor debe gestionar el inicio y final de cada captura de forma independiente dentro de toda la recursividad. <code>looper</code>, nuestro punto de gestion recursivo y de avance por la cadena tambien sera resposable de la tarea:</p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">int</span> <span class="nf">looper</span><span class="p">(</span> <span class="k">struct</span> <span class="n">RE</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">){</span>
  <span class="kt">int</span> <span class="n">iCatch</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ➊
</span><span class="c1"></span>
  <span class="k">switch</span><span class="p">(</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">type</span> <span class="p">){</span>
  <span class="k">case</span> <span class="nl">HOOK</span><span class="p">:</span>                       <span class="c1">// ➋
</span><span class="c1"></span>    <span class="n">openCatch</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">iCatch</span> <span class="p">);</span>          <span class="c1">// ➌
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&gt;=</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="p">)</span> <span class="n">closeCatch</span><span class="p">(</span> <span class="n">iCatch</span> <span class="p">);</span> <span class="c1">// ➍
</span><span class="c1"></span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">GROUP</span><span class="p">:</span> <span class="k">case</span> <span class="nl">PATH</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">walker</span><span class="p">(</span> <span class="o">*</span><span class="n">rexp</span> <span class="p">)</span> <span class="p">)</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">SET</span><span class="p">:</span> <span class="k">case</span> <span class="nl">BACKREF</span><span class="p">:</span> <span class="k">case</span> <span class="nl">META</span><span class="p">:</span> <span class="k">case</span> <span class="nl">RANGEAB</span><span class="p">:</span> <span class="k">case</span> <span class="nl">POINT</span><span class="p">:</span> <span class="k">case</span> <span class="nl">SIMPLE</span><span class="p">:</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMax</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">text</span><span class="p">.</span><span class="n">len</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">forward</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span> <span class="n">rexp</span> <span class="p">))</span> <span class="p">){</span>
      <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">forward</span><span class="p">;</span>
      <span class="n">loops</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">rexp</span><span class="o">-&gt;</span><span class="n">loopsMin</span> <span class="o">?</span> <span class="nl">FALSE</span> <span class="p">:</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>El gestor <q>independiente</q> de cada captura se llama <code>iCatch</code> ➊, recuerda que aun en medio de la recursividad cada funcion tiene sus propios parametros, por lo que cada llamada se hara cargo de su propio captura.... piensalo un momento...</p>
<p>El caso <code>HOOK</code> ➋, es una copia del codigo en el caso <code>GROUP</code> al que agregamos la apertura de la captura antes de iniciar el ciclo recursivo ➌. Al finalizar, si cumplimos el ciclo correctamente cerramos la captura ➍.</p>
<p>Es posible que la simplesa del codigo muestre las soluciones de forma trivial (de no serlo soy un fracaso), detente a asimilar el proceso, pon musica psicotropica e imagina situaciones recursivas, magicas, misticas y misteriosas.</p>
<p>Aqui estan las funciones auxiliares (<code>open</code>|<code>close</code>)<code>Catch</code></p>
<pre class="code" ><code class="chroma" ><span class="k">static</span> <span class="kt">void</span> <span class="nf">openCatch</span><span class="p">(</span> <span class="kt">int</span> <span class="o">*</span><span class="n">index</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">MAX_CATCHS</span> <span class="p">){</span>               <span class="c1">// ➊
</span><span class="c1"></span>    <span class="o">*</span><span class="n">index</span> <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span><span class="o">++</span><span class="p">;</span>                     <span class="c1">// ➋
</span><span class="c1"></span>    <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="o">*</span><span class="n">index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>  <span class="c1">// ➌
</span><span class="c1"></span>    <span class="n">Catch</span><span class="p">.</span><span class="n">id</span> <span class="p">[</span> <span class="o">*</span><span class="n">index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">idx</span><span class="o">++</span><span class="p">;</span>          <span class="c1">// ➍
</span><span class="c1"></span>  <span class="p">}</span> <span class="k">else</span> <span class="o">*</span><span class="n">index</span> <span class="o">=</span> <span class="n">MAX_CATCHS</span><span class="p">;</span>                   <span class="c1">// ➎
</span><span class="c1"></span><span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">closeCatch</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">MAX_CATCHS</span> <span class="p">)</span>                      <span class="c1">// ➏
</span><span class="c1"></span>    <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">text</span><span class="p">.</span><span class="n">pos</span> <span class="p">]</span> <span class="o">-</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">];</span> <span class="c1">// ➐
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>En ambas funciones antes de hacer nada, verifican que estemos dentro del limite del arreglo ➊➏. En <code>openCatch</code> si se ha llegado al ultimo elemento regresamos un valor <q>seguro</q> ➎, si no hacemos esto, el paramentro <code>index</code> contrendra un valor basura (llamada en <code>looper</code>), que perfectamente podria pasar la prueba inicial de <code>closeCatch</code> probocando resultados escabrosos.</p>
<p>El resto es optener e incrementar el indice actual ➋, establecer el punto de inicio de la captura en la cadena ➌ y optener e incrementar el identificador actual ➍.</p>
<p>Cerramos la captura restando la posicion inicial a la posicion actual de la cadena ➐, esto nos da la longitud en bytes.</p>
<p>Listo, tenemos Capturas funcionales... sin una interfaz de uso.</p>
<p>Que funciones necesita realizar el usuario con las capturas?</p>
<ol class="num" >
<li>
<p>Conocer cuantas capturas existen</p>
<pre class="code" ><code class="chroma" ><span class="kt">int</span> <span class="nf">totCatch</span><span class="p">(){</span> <span class="k">return</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
</code></pre>
</li>
<li>
<p>Recuperar los datos de la captura</p>
<pre class="code" ><code class="chroma" ><span class="kt">char</span> <span class="o">*</span> <span class="nf">gpsCatch</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">){</span>
  <span class="k">return</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span> <span class="p">)</span> <span class="o">?</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lenCatch</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">){</span>
  <span class="k">return</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span> <span class="p">)</span> <span class="o">?</span> <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p><code>gpsCatch</code> nos regeresa la posicion de inicio de la captura, o un puntero nulo</p>
<p><code>lenCatch</code> nos informa la longitud de una captura (o, cero?)</p>
</li>
<li>
<p>Recuperar una captura</p>
<pre class="code" ><code class="chroma" ><span class="kt">char</span> <span class="o">*</span> <span class="nf">cpyCatch</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span> <span class="p">){</span>
    <span class="n">strncpy</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">],</span> <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="p">);</span>
    <span class="n">str</span><span class="p">[</span> <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="sa"></span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="sa"></span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>el usuario nos indica el indice de la captura y nos proporciona la memoria que haga falta para hacer una copia, posiblemente con ayuda de <code>lenCatch</code>. Nosotros amablemente le hacemos una copia que finaliza con el signo de terminacion de cadena, junto con un apuntador, por si desea utilizarlo directamente.</p>
<p>Si el indice es incorrecto, le enviamos una cadena vacia.</p>
</li>
<li>
<p>Reemplazar todas las apariciones de una coincidencia</p>
<p>hey, aqui es donde el identificador <code>id</code> demuestra utilidad</p>
<pre class="code" ><code class="chroma" ><span class="kt">char</span> <span class="o">*</span> <span class="nf">rplCatch</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">newStr</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">rplStr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span> <span class="p">){</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">oNewStr</span> <span class="o">=</span> <span class="n">newStr</span><span class="p">,</span> <span class="o">*</span><span class="n">last</span> <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>                <span class="c1">// 🅐
</span><span class="c1"></span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rpLen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">rplStr</span> <span class="p">);</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">Catch</span><span class="p">.</span><span class="n">index</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span> <span class="p">)</span> <span class="c1">// 🅑
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">id</span> <span class="o">==</span> <span class="n">Catch</span><span class="p">.</span><span class="n">id</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="p">){</span>                               <span class="c1">// 🅒
</span><span class="c1"></span>      <span class="k">if</span><span class="p">(</span> <span class="n">last</span> <span class="o">&gt;</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="p">)</span> <span class="n">last</span> <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">];</span> <span class="c1">// 🅓
</span><span class="c1"></span>
      <span class="n">strncpy</span><span class="p">(</span> <span class="n">newStr</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="o">-</span> <span class="n">last</span> <span class="p">);</span>        <span class="c1">// 🅔
</span><span class="c1"></span>      <span class="n">newStr</span> <span class="o">+=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="o">-</span> <span class="n">last</span><span class="p">;</span>                       <span class="c1">// 🅕
</span><span class="c1"></span>      <span class="n">strcpy</span><span class="p">(</span> <span class="n">newStr</span><span class="p">,</span> <span class="n">rplStr</span> <span class="p">);</span>                                  <span class="c1">// 🅖
</span><span class="c1"></span>      <span class="n">newStr</span> <span class="o">+=</span> <span class="n">rpLen</span><span class="p">;</span>                                           <span class="c1">// 🅗
</span><span class="c1"></span>      <span class="n">last</span>    <span class="o">=</span> <span class="n">Catch</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">Catch</span><span class="p">.</span><span class="n">len</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>             <span class="c1">// 🅘
</span><span class="c1"></span>    <span class="p">}</span>

  <span class="n">strcpy</span><span class="p">(</span> <span class="n">newStr</span><span class="p">,</span> <span class="n">last</span> <span class="p">);</span>                                        <span class="c1">// 🅙
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">oNewStr</span><span class="p">;</span>                                                <span class="c1">// 🅚
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>Los argumentos son los siguientes: <code>newStr</code> es un puntero a una cadena de caracteres que almacena el resultado, <code>rplStr</code> es la cadena que substituira la captura e <code>id</code> el identificador de las capturas a modificar.</p>
<p>Es necesario advertir que la cadena <code>newStr</code> no debe ser la misma que la cadena principal (<code>txt</code> de <code>regexp3</code>). Esto se debe a que:</p>
<ul>
<li>
<p>esta funcion esta diseñada para trabajar con cadenas distintas,</p>
</li>
<li>
<p>no deberaimos alterar los datos de entrada bajo ningun motivo,</p>
</li>
<li>
<p>las demas funciones de manejo de capturas apuntarian a datos erroneos</p>
</li>
<li>
<p>y desconocemos si la cadena principal es modificable.</p>
</li>
</ul>
<p>A la explicacion -&gt; Tenemos dos cadenas, la cadena fuente <code>last</code> y la cadena donde ponemos el resultado de la modificacion <code>newStr</code> 🅐.</p>
<p>Lo que hacemos es recorrer todas las capturas, de la primera a la ultima 🅑, en busca de coincidencias del <code>id</code> que nos solicitan 🅒.</p>
<p>Dentro de la coincidencia, tenemos que hacer una copia de los caracteres entre el final la ultima coincidencia y el inicio de la actual 🅔 (en el primer ciclo, <code>last</code> apunta al inicio de la cadena). Movemos el puntero de la copia el numero de caracteres que fueron copiados 🅕 y hacemos el <q>reemplazo</q> 🅖. Finalmente desplazamos la posicion de <q>la ultima coincidencia</q> al final de la posicion de la captura actual 🅘 y pasamos al siguiente ciclo.</p>
<p>cuando termina el bucle, copiamos <q>el resto de la cadena</q> (desde la ultima captura) en la cadena de copia 🅙, je, m-a-g-i-a!</p>
<p>Al terminar regresamos un puntero a la posicion inicial del resultado 🅚.</p>
<p>Por cierto, para que es el punto 🅓? pues, si tubieramos activo el modificador <code>MOD_FwrByChar</code> (<code>~</code>) podria darse el caso de que la ultima captura, terminara despues del inicio de la actual, si!? y en esa situacion... bueno, descubrelo por tu cuenta.</p>
</li>
<li>
<p>Poder crear una cadena apartir de las capturas</p>
<pre class="code" ><code class="chroma" ><span class="kt">char</span> <span class="o">*</span> <span class="nf">putCatch</span><span class="p">(</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">newStr</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">putStr</span> <span class="p">){</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">oNewStr</span> <span class="o">=</span> <span class="n">newStr</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span> <span class="o">*</span><span class="n">putStr</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">*</span><span class="n">putStr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;#&#39;</span> <span class="p">){</span>                     <span class="c1">// ➊
</span><span class="c1"></span>      <span class="k">if</span><span class="p">(</span> <span class="o">*++</span><span class="n">putStr</span> <span class="o">==</span> <span class="sa"></span><span class="sc">&#39;#&#39;</span> <span class="p">)</span>                  <span class="c1">// ➋
</span><span class="c1"></span>        <span class="o">*</span><span class="n">newStr</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">putStr</span><span class="o">++</span><span class="p">;</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">putStr</span> <span class="p">);</span>           <span class="c1">// ➌
</span><span class="c1"></span>        <span class="n">cpyCatch</span><span class="p">(</span> <span class="n">newStr</span><span class="p">,</span> <span class="n">index</span> <span class="p">);</span>            <span class="c1">// ➍
</span><span class="c1"></span>        <span class="n">newStr</span> <span class="o">+=</span> <span class="n">lenCatch</span><span class="p">(</span> <span class="n">index</span> <span class="p">);</span>          <span class="c1">// ➎
</span><span class="c1"></span>        <span class="n">putStr</span> <span class="o">+=</span> <span class="n">countCharDigits</span><span class="p">(</span> <span class="n">putStr</span> <span class="p">);</span>  <span class="c1">// ➏
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="o">*</span><span class="n">newStr</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">putStr</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>

  <span class="o">*</span><span class="n">newStr</span> <span class="o">=</span> <span class="sa"></span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">oNewStr</span><span class="p">;</span>                             <span class="c1">// ➐
</span><span class="c1"></span><span class="p">}</span>
</code></pre>
<p>Esta funcion esta basada <code>printf</code>, solo que en lugar de desplegar el resultado, lo almacena en una cadena (<code>newStr</code>) y en lugar de subtituir sus secuencias especiales por valores, lo hara por capturas. Nuestra secuencia especial sera el signo <code>#</code> seguido por el indice de una captura, por ejemplo:</p>
<pre class="code" ><code class="chroma" ><span class="n">rplCatch</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;la primer captura es: #1&#34;</span> <span class="p">);</span>
</code></pre>
<p>Colocara dentro de la cadena <code>str</code> el texto <code>la primer captura es: </code> y la secuencia <code>#1</code> sera substituida por el contenido de la primer captura.</p>
<ul>
<li>
<p>Si el indice es incorrecto no colocamos nada y el indicador <q>desaparace</q>.</p>
</li>
<li>
<p>Si en lugar de un indice (numeros) hay una secuencia de caracteres no numerica, en el resultado, desaparace el signo <code>#</code>, pero la secuencia de caracteres seguira precente.</p>
</li>
<li>
<p>Si lo que queremos es colocar un <code>#</code>, ponemos la secuencia <code>##</code>. El primer <code>#</code> <q>escapa</q> al segundo <code>#</code>.</p>
</li>
</ul>
<p>El mecanismo de <code>putCatch</code> es similar al de <code>rplCatch</code>. En lugar de buscar capturas, buscamos secuencias <code>#</code> ➊.</p>
<p>Si la secuencia va seguida de un <code>#</code> ➋, en la cadena resultado dejamos un <code>#</code>, y vamos por el siguiente caracter. De lo contrario, se optiene el indice de la captura ➌, hacemos la copia de esta ➍ y movemos el puntero de la copia y el de la cadena de formato los caracteres <q>respectivos</q> ➎➏.</p>
<p>Al terminar se regresa un puntero al inicio de la cadena ➐ resultado.</p>
</li>
</ol>
<p>Como es costumbre aplicamos un conjunto variado de pruebas.</p>
<pre class="code" ><code class="chroma" >  <span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="cp">#define CATCH_TEST( text, re, n, rtext )                \
</span><span class="cp"></span>  <span class="n">result</span> <span class="o">=</span> <span class="n">regexp3</span><span class="p">(</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span> <span class="p">);</span>                         \
  <span class="n">total</span><span class="o">++</span><span class="p">;</span>                                              \
  <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">cpyCatch</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="n">n</span> <span class="p">),</span> <span class="n">rtext</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">){</span>       \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%s:%d Error on &#34;</span> <span class="n">text</span> <span class="sa"></span><span class="s">&#34;, &#34;</span> <span class="n">re</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>        \
            <span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span> <span class="p">);</span>                       \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;result    &gt;&gt;%s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span>                        \
            <span class="sa"></span><span class="s">&#34;expected  &gt;&gt;%s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">rtext</span> <span class="p">);</span>         \
    <span class="n">errs</span><span class="o">++</span><span class="p">;</span>                                             \
  <span class="p">}</span>

  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aa&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a a a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c|d&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c|d&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c|d&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;c&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c|d&gt;&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;d&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c|d&gt;&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&lt;x&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;x&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b&gt;x&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;a|b&gt;x|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;a|b&gt;x|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&lt;a|b&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&lt;a|b&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c&gt;&#34;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;c&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;(a|b|c)(a|b|c)(a|b|c)&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;(a|b|c)(a|b|c)(a|b|c)&gt; &#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?&lt;(a|b|c)(a|b|c)(a|b|c)&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abc&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?&lt;(a|b|c)(a|b|c)((a|b)|x)&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc abc abx&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#?&lt;(a|b|c)(a|b|c)((a|b)|x)&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abx&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;abc&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;iec&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;i&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;c&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;oeb&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;o&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;b&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abc iecc oeb&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;(a|e)|(i|o)&gt;e&lt;b|c&gt;|abc&gt;&#34;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>

  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;b&gt;?&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;b&gt;*&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a&gt;+&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a&gt;*&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a+&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a*&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a?&gt;&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a+b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a*b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a?b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a+b?&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a*b?&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a?b?&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a+b+&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a*b+&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a?b+&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a+b*&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a*b*&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a?b*&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ab&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a+&gt;&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;a*&gt;&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>

  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span>     <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span>     <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;T&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raaaaptor TFest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raaaaptor TFest&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raaaaptor TFest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;TF&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;CaptorTest&#34;</span><span class="p">,</span>      <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;CaptorTest&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Cap CaptorTest&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Cap CaptorTest&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Cap CaptorTest&#34;</span><span class="p">,</span>  <span class="sa"></span><span class="s">&#34;#~&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;CaptorTest&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Rap Captor Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Rap Captor Fest&#34;</span> <span class="p">);</span>
  <span class="n">CATCH_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Rap Captor Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#~&lt;((C|R)ap C|C|R)(a+p{1}tor) ?((&lt;T|F&gt;+e)(st))&gt;&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor Fest&#34;</span> <span class="p">);</span>

<span class="cp">#define REPLACE_TEST( text, re, n, rtext, ctext )               \
</span><span class="cp"></span>  <span class="n">result</span> <span class="o">=</span> <span class="n">regexp3</span><span class="p">(</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span> <span class="p">);</span>                                 \
  <span class="n">total</span><span class="o">++</span><span class="p">;</span>                                                      \
  <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">rplCatch</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="n">rtext</span><span class="p">,</span> <span class="n">n</span> <span class="p">),</span> <span class="n">ctext</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">){</span>        \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%s:%d Error on &#34;</span> <span class="n">text</span> <span class="sa"></span><span class="s">&#34;, &#34;</span> <span class="n">re</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>                \
            <span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span> <span class="p">);</span>                               \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;result    &gt;&gt;%s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span>                                \
            <span class="sa"></span><span class="s">&#34;expected  &gt;&gt;%s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">ctext</span> <span class="p">);</span>                 \
    <span class="n">errs</span><span class="o">++</span><span class="p">;</span>                                                     \
  <span class="p">}</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;za&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;za&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;za&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;za&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eee&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeeb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeeb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeb&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazb&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaab&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeebeee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeebeee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ebe&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eebe&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeebeee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeeebeee&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ebe&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eebe&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;eeebeee&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;?&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazbzazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;+&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;*&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazbzazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x&gt;{1}&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x?&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazbzazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x+&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x*&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;zazazazbzazaza&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;x{1}&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;z&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaabaaa&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&lt;b&gt;&#34;</span>   <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaebaaa aaebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;?&lt;b&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaebaaa aaebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;+&lt;b&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ebaaa ebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;*&lt;b&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ebaaa ebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;{1}&lt;b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaebaaa aaebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a?&gt;&lt;b&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaebaaa aaebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a+&gt;&lt;b&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ebaaa ebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a*&gt;&lt;b&gt;&#34;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;ebaaa ebaaa&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aaabaaa aaabaaa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a{1}&gt;&lt;b&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;e&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaebaaa aaebaaa&#34;</span> <span class="p">);</span>

  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor Test&#34;</span>   <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor&gt;&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span>   <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor|Test&gt;&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span>   <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor|Test&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor Captor&#34;</span>   <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor|Test&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span>   <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor|&lt;Test&gt;&gt;&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor Fest&#34;</span>   <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Raptors Raptoring&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor:w*&gt;&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Test Test Test&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Raptors Raptoring&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor&gt;:w*&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Test Tests Testing&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Raptors Raptoring&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;&lt;R&gt;a&gt;ptor&gt;:w*&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor Captors Captoring&#34;</span> <span class="p">);</span>
  <span class="n">REPLACE_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Raptors Raptoring&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;&lt;&lt;R&gt;a&gt;ptor&gt;:w*&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;4ptor 4ptors 4ptoring&#34;</span> <span class="p">);</span>

<span class="cp">#define PUT_TEST( text, re, rtext, ctext )              \
</span><span class="cp"></span>  <span class="n">result</span> <span class="o">=</span> <span class="n">regexp3</span><span class="p">(</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span> <span class="p">);</span>                         \
  <span class="n">total</span><span class="o">++</span><span class="p">;</span>                                              \
  <span class="k">if</span><span class="p">(</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">putCatch</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="n">rtext</span> <span class="p">),</span> <span class="n">ctext</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">){</span>   \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;%s:%d Error on &#34;</span> <span class="n">text</span> <span class="sa"></span><span class="s">&#34;, &#34;</span> <span class="n">re</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>        \
            <span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span> <span class="p">);</span>                       \
    <span class="n">printf</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;result    &gt;&gt;%s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span>                        \
            <span class="sa"></span><span class="s">&#34;expected  &gt;&gt;%s&lt;&lt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">ctext</span> <span class="p">);</span>         \
    <span class="n">errs</span><span class="o">++</span><span class="p">;</span>                                             \
  <span class="p">}</span>

  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;a&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#x&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;x&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#xx&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;xx&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;###1##&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#a#&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[#0][#1][#2#3#1000000]&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;[][a][]&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aa&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aa&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;a a a&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#1#2#3&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;aaa&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;a|b|c|d&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#4 #3 #2 #1&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;d c b a&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;1 2 3 4 5 6 7 8 9&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;1|2|3|4|5|6|7|8|9&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#5 #6 #7 #8 #9 #1 #2 #3 #4&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;5 6 7 8 9 1 2 3 4&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#1 F#2&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Captor Fest&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#5 F#2&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C Fest&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#a F#2&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Ca Fest&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#0 F#2&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C Fest&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#43 F#43&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C F&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C##43 ##F#43##&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#43 #F#&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C##43 ##1##2&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;C#43 #1#2&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;aptor|est&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;##Raptor ##Test&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#Raptor #Test&#34;</span> <span class="p">);</span>
  <span class="n">PUT_TEST</span><span class="p">(</span> <span class="sa"></span><span class="s">&#34;Raptor Test Fest&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;&lt;Raptor&gt; &lt;Test&gt;&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;#1_#2&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;Raptor_Test&#34;</span> <span class="p">);</span>
</code></pre>
</div>
<h4 id="backreferences" >backreferences</h4>
<h4 id="Stand-Alone-Complex" >Stand Alone Complex</h4>
<h2 id="Regexp3-(UTF-8)" >Regexp3 (UTF-8)</h2>
<h3 id="utf-8" >utf-8</h3>
<h3 id="codigo" >codigo</h3>
<h3 id="xx.*yy" >xx.*yy</h3>
<h2 id="Regexp4" >Regexp4</h2>
<h3 id="El-raptor-necesita-un-mapa" >El raptor necesita un mapa</h3>
<h3 id="Lista-de-instrucciones" >Lista de instrucciones</h3>
<h3 id="showTable" >showTable</h3>
<h3 id="interprete" >interprete</h3>
<h3 id="goodbye-cruel-regexp" >goodbye cruel regexp</h3>
<h2 id="fuentes" >fuentes</h2>
<div class="hBody-2" >
<p><a href="https://blog.staffannoteberg.com/2013/01/30/regular-expressions-a-brief-history/" >https://blog.staffannoteberg.com/2013/01/30/regular-expressions-a-brief-history/</a></p>
<p><a href="https://en.wikipedia.org/wiki/Regular_expression" >https://en.wikipedia.org/wiki/Regular_expression</a></p>
<p><a href="https://es.wikipedia.org/wiki/Expresi%C3%B3n_regular" >https://es.wikipedia.org/wiki/Expresi%C3%B3n_regular</a></p>
<p><a href="https://es.wikipedia.org/wiki/Grep" >https://es.wikipedia.org/wiki/Grep</a></p>
<p><a href="https://es.wikipedia.org/wiki/ASCII" >https://es.wikipedia.org/wiki/ASCII</a></p>
<p><a href="https://es.wikipedia.org/wiki/UTF-8" >https://es.wikipedia.org/wiki/UTF-8</a></p>
<p><a href="https://es.wikipedia.org/wiki/Byte" >https://es.wikipedia.org/wiki/Byte</a></p>
<p><a href="https://elbauldelprogramador.com/por-que-un-switch-es-mas-rapido-que-su-homologo-if-then-else/" >https://elbauldelprogramador.com/por-que-un-switch-es-mas-rapido-que-su-homologo-if-then-else/</a></p>
<p>Mastering Regular Expressions, 2nd Edition By Jeffrey E. F. Friedl <a href="https://se.ifmo.ru/~ad/Documentation/Mastering_RegExp/mastregex2-CHP-4-SECT-3.html" >https://se.ifmo.ru/~ad/Documentation/Mastering_RegExp/mastregex2-CHP-4-SECT-3.html</a></p>
</div>
</body>
</html>
